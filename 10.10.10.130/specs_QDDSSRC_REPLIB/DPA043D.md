# DPA043D - 歷史檔案整理 螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式名稱 | DPA043D |
| 程式類型 | DSPF (顯示檔案) |
| 系統名稱 | 應收帳款系統 |
| 子系統 | 檔案管理子系統 |
| 作者 | D910121 |
| 建立日期 | 1992/10/01 |
| 更新日期 |  |
| 備註 | 歷史檔案整理 |

## 2. 螢幕規格

### 2.1 螢幕基本設定
- 螢幕大小：24 行 × 80 欄位
- 顯示模式：*DS3 (雙密度)
- 訊息位置：第 24 行
- 支援列印功能
- 支援訊息控制
- 支援功能鍵處理

### 2.2 螢幕特性
- 支援游標定位 (CSRLOC)
- 支援覆蓋模式
- 支援強制資料輸入 (FRCDTA)
- 支援螢幕鎖定 (LOCK)
- 支援多種功能鍵

## 3. 螢幕布局

### 3.1 主要畫面布局 (DSPD1)
```
DPA043                                                  日期: YY/MM/DD
SCR001  歷史檔案整理                                    時間: HH:MM:SS
                                                           USER : XXXXX

          年度: MM/YY-MM/YY

+------------------------------------------+
|                                          |
| 注意:按F14鍵可備份檔案，按F3取消檔案     |
|                                          |
|  說明:將歷史檔案整理到指定設備的指定     |
|       年度目錄下                         |
|                                          |
+------------------------------------------+

F3 =返回前頁  F14=備份檔案
```

## 4. 紀錄格式

### 4.1 主畫面紀錄格式 (DSPD1)
| 欄位名稱 | 欄位代號 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|----------|------|------|------|------|------|
| 程式名稱 | - | 1,2 | 6 | A | O | 顯示 "DPA043" |
| 日期 | $EGMDY | 1,70 | 6,0 | Y | O | 系統日期，格式 YY/MM/DD |
| 畫面編號 | - | 2,2 | 6 | A | O | 顯示 "SCR001" |
| 畫面標題 | - | 2,33 | 6 | A | O | 顯示 "歷史檔案整理" |
| 時間 | TIME | 2,70 | 8 | T | O | 系統時間，格式 HH:MM:SS |
| 使用者 | $USER | 3,70 | 10 | A | O | 登入使用者代號 |
| 年度起 | DMYS | 6,38 | 4,0 | Y | B | 年度起始值，格式 MM/YY |
| 年度迄 | DMYE | 6,46 | 4,0 | Y | B | 年度結束值，格式 MM/YY |

## 5. 明細畫面

### 5.1 說明框區域
- 位置：第 10~18 行，第 17~65 欄
- 大小：9 行 × 49 欄
- 包含邊框設計
- 顯示操作說明和注意事項

### 5.2 錯誤訊息顯示
- ERR1: 程式錯誤訊息
- ERR2: 設備錯誤訊息
- ERR3: 參數錯誤訊息
- ERR4: 檔案錯誤訊息
- ERR5: 權限錯誤訊息

## 6. 功能鍵說明

### 6.1 功能鍵定義
| 功能鍵 | 功能說明 | 處理程式 |
|--------|----------|----------|
| F3 | 返回前頁 | 03 |
| F14 | 備份檔案 | 14 |

### 6.2 功能鍵特性
- F3: 返回前一個畫面，取消檔案整理作業
- F14: 執行檔案備份作業，將歷史檔案整理到指定設備

## 7. 輸入欄位驗證

### 7.1 年度範圍驗證
- 年度起迄 (DMYS, DMYE)：必須為有效的年度格式 MM/YY
- 起始年度不能大於結束年度
- 年度範圍必須合理
- 年度格式必須正確 (MM/YY)

### 7.2 檔案存在性驗證
- 指定年度範圍內必須有歷史檔案存在
- 目標設備必須有足夠的儲存空間
- 使用者必須具有檔案存取權限

### 7.3 參數驗證
- 年度參數必須為有效格式
- 年度範圍不能為空
- 年度值必須在合理範圍內

## 8. 錯誤處理

### 8.1 錯誤訊息處理
- 所有錯誤訊息顯示在第 24 行
- 錯誤訊息以高亮度顯示
- 錯誤發生時游標會定位到錯誤欄位

### 8.2 錯誤類型
- **程式錯誤**：程式執行時發生錯誤
- **設備錯誤**：目標設備不存在或無法存取
- **參數錯誤**：年度參數格式不正確
- **檔案錯誤**：歷史檔案不存在或無法存取
- **權限錯誤**：使用者權限不足

### 8.3 錯誤處理程序
1. 系統檢測到錯誤時，顯示對應錯誤訊息
2. 游標自動定位到錯誤欄位
3. 使用者修正錯誤後可重新執行
4. 按 F3 可返回前頁取消操作

## 9. 使用說明

### 9.1 畫面用途
此畫面用於將歷史檔案整理到指定的設備和年度目錄下，提供檔案備份和整理功能，確保歷史資料的安全保存。與 DPA042D 不同的是，此程式使用 MM/YY 格式的年度範圍。

### 9.2 操作流程
1. 系統顯示年度範圍 (MM/YY 格式)
2. 確認年度範圍正確
3. 按 F14 執行檔案備份作業
4. 等待檔案整理完成
5. 使用功能鍵進行其他操作

### 9.3 檔案整理功能說明
- **年度範圍整理**：依指定年度範圍整理歷史檔案
- **設備備份**：將檔案備份到指定設備
- **目錄管理**：自動建立年度目錄結構
- **檔案搬移**：將歷史檔案搬移到目標位置

### 9.4 系統特色
- 支援 MM/YY 格式年度範圍
- 支援多種設備類型
- 完整的檔案管理功能
- 安全的備份機制
- 完整的錯誤處理機制

### 9.5 使用時機
- 歷史檔案備份時
- 系統維護作業時
- 資料整理時
- 儲存空間管理時
- 檔案歸檔作業時

### 9.6 注意事項
- 年度範圍必須使用 MM/YY 格式
- 年度範圍必須合理
- 確保有足夠的儲存空間
- 注意檔案存取權限
- 大型檔案整理可能需要較長時間
- 使用 F14 可執行檔案備份
- 按 F3 可安全返回前頁 