# ARA0041D 發票作廢重開－重開 螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARA0041D |
| 程式名稱 | 發票作廢重開－重開 |
| 程式類型 | 螢幕格式檔（DSPF） |
| 作者 | A1118 PHILIP TSAI |
| 建立日期 | 81/03/23 |
| 程式名稱 | ARA0041 |
| 系統 | 應收帳款 |
| 子系統 | 應收帳管作業系統 |
| 功能說明 | 發票作廢重開－重開 (A/U/D/I) |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24x80 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印功能 | PRINT |

## 3. 螢幕布局

```
ARA0041                        程式訊息                        日期:MM/DD/YY
SCR003                      發票重開處理                       時間:HH:MM:SS
                                                                USER :XXXXXXX
作業作業別:

    發票編號起 發票月份  發票日期      客戶名稱        單號    金額
(MM/DD/YY)

選項作業項目:
        2=重開      5=發票查詢

A作業請至前畫面先執行作廢功能          發票重開    前畫面將設    發票金額    
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
----   F3 =回到前頁   F12=回前前頁   
發票重開XXX重開成功                                    [錯誤訊息位置]
```

## 4. 紀錄格式

### 4.1 主畫面記錄格式

#### SFLSR1 - 子檔案記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | | 4,0 | N | H | 記錄號碼 |
| HSI02 | | R | A | H | 隱藏欄位-發票號碼 |
| DOPT1 | 10,3 | 1 | A | B | 選項(' ','2','5') |
| SI01 | 10,6 | R | A | O | 客戶編號 |
| SI12 | 10,21 | R | A | O | 發票月份 |
| SI13 | 10,27 | R | A | O | 發票日期 |
| SI02 | 10,33 | R | A | O | 發票號碼 |
| SI11 | 10,47 | R | A | O | 客戶名稱 |
| SI25 | 10,61 | R | N | O | 金額(EDTCDE(1)) |
| DSC08C | 10,73 | 6,0 | N | O | 幣別代碼(EDTCDE(Y)) |
| SI10 | | R | A | H | 隱藏欄位 |

#### SFLCR1 - 子檔案控制記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN1 | | 4,0 | N | H | 子檔案記錄指標 |
| $EGMDY | 1,70 | 6,0 | N | O | 系統日期(EDTCDE(Y)) |
| $USER | 3,70 | 10 | A | O | 使用者代號 |
| DBGN1 | 9,6 | R | A | B | 起始客戶編號 |
| DBGN2 | 9,21 | R | A | B | 起始發票月份 |
| DBGN3 | 9,27 | R | A | B | 起始發票日期 |
| DBGN0 | 9,11 | 6,0 | N | B | 起始發票號碼(EDTCDE(Y)) |

#### DSPD2 - 明細顯示記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| D#ROW | | 3,0 | N | H | 游標列位置 |
| D#COL | | 3,0 | N | H | 游標欄位置 |
| DFUN | 3,2 | 6 | A | O | 功能說明 |
| SI01 | 4,14 | R | A | O | 客戶編號 |
| #B03 | 4,17 | R | A | O | 客戶名稱 |
| SI08 | 4,46 | R | A | O | 客戶代碼1 |
| SI09 | 4,54 | R | A | O | 客戶代碼2 |
| SI11 | 5,14 | R | A | O | 客戶名稱 |
| DME04 | 5,46 | R | A | O | 客戶中文名稱 |
| DSIMM | 6,14 | 4,0 | N | O | 發票月份(EDTWRD('  /  ')) |
| DSI21C | 6,46 | 6,0 | N | B | 發票日期(EDTWRD('  /  /  ')) |
| SI02 | 7,14 | R | A | O | 發票號碼 |
| DSI17 | 7,46 | R | N | B | 發票類別(VALUES(2 3)) |
| DSI22 | 9,46 | R | A | B | 幣別類別(VALUES('D','B','Z')) |
| SC06 | 11,14 | R | A | O | 客戶電話 |
| SI10 | 11,46 | R | A | O | 客戶統編 |
| DSI12 | 13,14 | R | A | O | 發票地址1 |
| DSI13 | 13,20 | R | A | B | 發票地址2 |
| ME031 | 13,25 | R | A | O | 地址中文1 |
| ME051 | 14,15 | R | A | O | 地址中文2 |
| ME061 | 14,48 | R | A | O | 地址中文3 |
| DSI14 | 16,14 | R | A | B | 前畫面地址1 |
| DSI15 | 16,20 | R | A | B | 前畫面地址2 |
| ME032 | 16,25 | R | A | O | 前畫面中文1 |
| ME052 | 17,15 | R | A | O | 前畫面中文2 |
| ME062 | 17,48 | R | A | O | 前畫面中文3 |
| DSI23 | 19,14 | R | A | O | 統一編號(EDTCDE(1)) |
| DSI24 | 19,41 | R | A | O | 營業稅額 |

## 5. 明細畫面

### 5.1 子檔案清單畫面
- **SFLSR1/SFLCR1**: 發票重開清單
  - 顯示發票基本資料
  - 提供選項欄位供使用者選擇作業
  - 支援分頁顯示(SFLPAG(0010), SFLSIZ(0020))

### 5.2 明細資料畫面  
- **DSPD2**: 發票詳細資料畫面
  - 顯示完整的客戶及發票資訊
  - 包含客戶基本資料、發票資料、地址資料
  - 支援游標定位功能

## 6. 功能鍵說明

| 功能鍵 | 說明 |
|--------|------|
| F3 | 回到前頁 |
| F12 | 回前前頁 |
| CF03(03) | 取消作業(SFLCR1) |
| CF12(12) | 回到前面(SFLCR1) |
| CA03(03) | 取消作業(DSPD2) |
| CA12(12) | 回到前面(DSPD2) |
| Enter | 確認執行 |
| Page Up/Down | 子檔案分頁 |

## 7. 輸入欄位驗證

### 7.1 欄位值驗證
- **DOPT1**: VALUES(' ' '2' '5')
  - ' ': 不處理
  - '2': 重開
  - '5': 發票查詢

### 7.2 欄位格式驗證  
- **DSI17**: VALUES(2 3) - 發票類別(2-二聯,3-三聯)
- **DSI22**: VALUES('D' 'B' 'Z') - 幣別(D-台幣,B-港幣,Z-美幣)
- **DSI21C**: 日期格式驗證(MM/DD/YY)
- **DSIMM**: 月份格式驗證(MM/YY)

### 7.3 條件式欄位控制
- 指示器30控制欄位輸入狀態(UL/PR)
- 指示器60/61/62控制欄位保護及強調顯示

## 8. 錯誤處理

### 8.1 錯誤訊息指示器
| 指示器 | 訊息ID | 說明 |
|--------|--------|------|
| 96 | UPT 2150 | 錯誤訊息1 |
| 95 | UPT 2142 | 錯誤訊息2 |
| 94 | UPT 2050 | 錯誤訊息3 |
| 93 | UPT 0010 | 錯誤訊息4 |
| 92 | UPT 2010 | 錯誤訊息5 |
| 91 | UPT 2020 | 錯誤訊息6 |
| 90 | UPT 0040 | 錯誤訊息7 |
| 89 | UPT 0030 | 錯誤訊息8 |
| 98 | CPF5203 | 子檔案訊息 |

### 8.2 特殊處理
- 指示器80: 重開成功訊息顯示
- 指示器97: 一般動態訊息(DMSG)
- 訊息檔案: PTMF, REMF

## 9. 使用說明

### 9.1 作業流程
1. 進入發票重開處理畫面
2. 設定查詢條件(客戶編號、發票月份、發票日期範圍)
3. 系統顯示符合條件的發票清單
4. 在選項欄位輸入作業代碼:
   - '2': 執行重開作業
   - '5': 查詢發票明細
5. 按Enter確認執行
6. 系統處理完成後顯示結果訊息

### 9.2 注意事項
- 必須先在前畫面執行作廢功能
- 重開作業將產生新的發票號碼
- 支援多筆發票同時處理
- 可查詢發票詳細資料確認無誤後再執行重開

### 9.3 欄位說明
- 客戶編號: 必須為有效的客戶主檔編號
- 發票日期: 使用MM/DD/YY格式
- 金額: 自動計算顯示，含稅總金額
- 幣別: D=台幣, B=港幣, Z=美幣 