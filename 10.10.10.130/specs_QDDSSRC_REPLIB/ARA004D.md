# ARA004D 螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | ARA004D |
| 檔案類型 | 螢幕格式檔 (DSPF) |
| 檔案描述 | 發票作廢重開－作廢 |
| 系統名稱 | 應收帳款系統 |
| 子系統 | 應收帳款作業系統 |
| 程式名稱 | ARA004 |
| 作業系統 | AS/400 |
| 建立日期 | 1981/03/20 |
| 作者 | A1118 PHILIP TSAI |
| 參考檔案 | RERF |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24×80 |
| 顯示裝置 | DSPSIZ(24 80 *DS3) |
| 訊息位置 | 第24列 |
| 列印支援 | 支援 (PRINT) |
| 參考檔案 | RERF |
| 子檔案 | 支援 (SFL) |

## 3. 螢幕布局

### 清單畫面 (SFLCR1)
```
第1列： ARA004                    [系統訊息]                   日期:
第2列： SCR001            發票作廢重開                      時間:
第3列：                                                  USER:

第5列： 輸入作業代碼:
第6列：      4=作廢         5=查詢         6=明細查詢

第8列： A 類別 發票日期 發票號碼 客戶代號 廠商編號 發票聯數 統計
第9列： [輸入欄位] [起始日期] [起始發票號碼]

第22列： 操作  F3 =回到前頁  F6 =重開

第24列： [發票號碼] 作廢成功                    [使用者訊息]
```

### 明細查詢畫面 (DSPD2)
```
第1列： ARA004                    [系統訊息]                   日期:
第2列： SCR002            發票作廢確認                      時間:
第3列： [功能]                                          USER:

第4列： 類別代號:              廠商編號:   -
第5列： 客戶代號:              [客戶名稱]
第6列： 發票月份:     (  /  )     發票日期:
第7列： 發票號碼:              發票聯數:    (2-二聯,3-三聯)

第9列：                        統計聯數:    (D-統計,B-便利,Z-不列)

第11列： 廠商地區:             廠商編號:
第13列： 發票地址:
     
第16列： 客戶地址:

第19列： 應納稅額:       營業稅:       發票金額:

第22列： 操作         F3 =回到前頁                F12=回前頁
```

## 4. 紀錄格式

### 子檔案記錄格式：SFLSR1 (SFL)

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | - | 4S | 隱藏 | H | 記錄號碼 |
| DOPT1 | 10,3 | 1A | B | 輸入 | 作業選項 (4/5/6) |
| SI01 | 10,7 | R | O | 輸出 | 類別代號 |
| DSI21C | 10,12 | 6,0 | O | 輸出 | 發票日期 |
| SI02 | 10,22 | R | O | 輸出 | 發票號碼 |
| SI12 | 10,33 | R | O | 輸出 | 客戶代號 |
| SI13 | 10,39 | R | O | 輸出 | 客戶編號 |
| SI11 | 10,44 | R | O | 輸出 | 廠商代號 |
| SI10 | 10,57 | R | O | 輸出 | 廠商編號 |
| SI17 | 10,71 | R | O | 輸出 | 發票聯數 |
| SI18 | 10,76 | R | O | 輸出 | 統計代號 |

### 明細查詢記錄格式：DSPD2

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| SI01 | 4,14 | R | O | 輸出 | 類別代號 |
| SI08 | 4,46 | R | O | 輸出 | 廠商編號起 |
| SI09 | 4,54 | R | O | 輸出 | 廠商編號止 |
| SI11 | 5,14 | R | O | 輸出 | 廠商代號 |
| DME04 | 5,46 | R | O | 輸出 | 客戶名稱 |
| DSIMM | 6,14 | 4Y,0 | O | 輸出 | 發票月份 |
| DSI21C | 6,46 | 6,0 | O | 輸出 | 發票日期 |
| SI02 | 7,14 | R | O | 輸出 | 發票號碼 |
| SI17 | 7,46 | R | O | 輸出 | 發票聯數 |
| SI22 | 9,46 | R | O | 輸出 | 統計聯數 |
| SC06 | 11,14 | R | O | 輸出 | 廠商地區 |
| SI10 | 11,46 | R | O | 輸出 | 廠商編號 |
| SI12 | 13,14 | R | O | 輸出 | 發票地址1 |
| SI13 | 13,20 | R | O | 輸出 | 發票地址2 |
| SI14 | 16,14 | R | O | 輸出 | 客戶地址1 |
| SI15 | 16,20 | R | O | 輸出 | 客戶地址2 |
| SI23 | 19,14 | R | O | 輸出 | 應納稅額 |
| SI24 | 19,41 | R | O | 輸出 | 營業稅 |
| SI25 | 19,68 | R | O | 輸出 | 發票金額 |

## 5. 明細畫面

### 子檔案控制
- **大小**: SFLSIZ(0020) - 最多20筆記錄
- **分頁**: SFLPAG(0010) - 每頁10筆記錄
- **捲動**: ROLLUP(25 '下一頁')
- **覆蓋**: OVERLAY

### 明細查詢功能
- 顯示發票完整資訊
- 包含客戶、廠商地址資訊
- 顯示稅額和金額明細
- 提供作廢確認資訊

## 6. 功能鍵說明

| 功能鍵 | 說明 |
|--------|------|
| F3 | 回到前頁 |
| F6 | 重開發票 |
| F12 | 回前頁 |
| CA03 | 取消作業 |
| CF06 | 重開功能 |
| ROLLUP | 下一頁 |

## 7. 輸入欄位驗證

### DOPT1 欄位驗證 (作業選項)
- **有效值**: ' ', '4', '5', '6'
- **驗證規則**: VALUES(' ' '4' '5' '6')
- **說明**:
  - ' ': 無作業
  - '4': 作廢
  - '5': 查詢
  - '6': 明細查詢

### 查詢條件驗證
- **DBGN1**: 類別代號起始值
- **DBGN2**: 發票日期起始值 (EDTCDE(Y))
- **DBGN3**: 發票號碼起始值

### 日期格式驗證
- **DSI21C**: 發票日期格式 EDTCDE(Y)
- **DSIMM**: 發票月份格式 EDTWRD('  /  ')

## 8. 錯誤處理

### 錯誤訊息定義

| 指示器 | 訊息ID | 說明 |
|--------|--------|------|
| 98 | CPF5203 | 子檔案訊息 |
| 97 | - | 一般訊息 |
| 96 | UPT 2150 | 輸入錯誤 |
| 95 | UPT 2142 | 資料錯誤 |
| 94 | UPT 2050 | 驗證錯誤 |
| 93 | UPT 0010 | 系統錯誤 |
| 92 | UPT 2010 | 作業錯誤 |
| 91 | UPT 2020 | 權限錯誤 |
| 90 | UPT 0040 | 檔案錯誤 |
| 89 | UPT 0030 | 記錄錯誤 |

### 成功訊息
- **指示器80**: 顯示作廢成功訊息
- **格式**: "發票號碼 [XSI02] 作廢成功"

## 9. 使用說明

### 操作流程

#### 發票作廢作業
1. 進入發票作廢重開畫面
2. 輸入查詢條件 (類別、日期、發票號碼)
3. 按 Enter 顯示發票清單
4. 在作業選項欄輸入 '4' 執行作廢
5. 系統顯示作廢成功訊息

#### 發票查詢作業
1. 在作業選項欄輸入 '5' 進行一般查詢
2. 輸入 '6' 進行明細查詢
3. 明細查詢顯示完整發票資訊

#### 發票重開作業
1. 作廢發票後，按 F6 進入重開功能
2. 系統引導進入發票重開處理

### 欄位說明
- **類別代號**: 發票類別識別
- **發票日期**: 發票開立日期
- **發票號碼**: 統一發票號碼
- **客戶代號**: 發票開立對象
- **廠商編號**: 開立發票的廠商
- **發票聯數**: 2-二聯, 3-三聯
- **統計代號**: D-統計, B-便利, Z-不列

### 業務規則
- 只能作廢尚未處理的發票
- 作廢後的發票號碼不可重複使用
- 作廢必須符合稅務法規要求
- 重開發票使用新的發票號碼

### 注意事項
- 發票作廢為不可逆操作，請謹慎確認
- 作廢後請及時進行重開作業
- 注意保持發票序號的連續性
- 作廢發票需妥善保存備查

### 相關程式
- **主程式**: ARA004
- **系統**: 應收帳款系統
- **功能**: 發票作廢與重開管理 