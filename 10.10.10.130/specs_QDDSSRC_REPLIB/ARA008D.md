# ARA008D 銷退折讓處理 螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARA008D |
| 程式名稱 | 銷退折讓處理 |
| 程式類型 | 螢幕格式檔（DSPF） |
| 作者 | A1092 TAYLOR |
| 建立日期 | 81/03/25 |
| 更新日期 | 81/04/17 PHILIP |
| 程式名稱 | ARA008 |
| 系統 | 應收帳款 |
| 子系統 | 應收帳 |
| 功能說明 | 銷退折讓處理 |
| 修改記錄 | M001(Y2K), M002(營業稅法修改) |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24x80 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印功能 | PRINT |

## 3. 螢幕布局

```
ARA008                         程式訊息                        日期:MM/DD/YY
SCR001                       銷退折讓處理                       時間:HH:MM:SS
                                                                USER :XXXXXXX
作業作業項目:
    2=銷退折扣    4=刪除

Ａ客戶頭字尾 發票字頭   品名編號  品名   折讓金額  營業稅額  進項稅額折讓金額
日期(MM/DD/YY)

底線   F3 =回到前頁   
```

## 4. 紀錄格式

### 4.1 第一子檔案記錄格式

#### SFLSR1 - 子檔案記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | | 4,0 | N | H | 記錄號碼 |
| DOPT1 | 10,2 | 1 | A | B | 選項(' ','2','4') |
| SG02 | 10,18 | R | A | O | 發票字頭 |
| SG09 | 10,31 | R | A | O | 品名編號 |
| SG04 | 10,44 | R | A | O | 品名代號 |
| SG05 | 10,50 | R | A | O | 品名 |
| DSG10 | 10,55 | 9,0 | N | O | 折讓金額(EDTCDE(1)) |
| SG14 | 10,69 | R | A | O | 營業稅額 |
| DFLD1 | 10,71 | 10 | A | O | 欄位1 |
| DSG06 | 10,8 | 6,0 | N | O | 日期(EDTWRD('  /  /  ')) |
| SG01 | 10,4 | R | A | O | 客戶編號 |

### 4.2 第二子檔案記錄格式

#### SFLSR2 - 子檔案記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN2 | | 4,0 | N | H | 記錄號碼 |
| DOPT2 | 12,2 | 1 | A | B | 選項(' ','2','5') |
| SH03 | 12,5 | R | A | O | 項目名稱 |
| SH04 | 12,18 | R | N | O | 金額1(EDTCDE(1)) |
| SH05 | 12,27 | R | N | O | 金額2(EDTCDE(1)) |
| DFLD2 | 12,36 | 5,0 | N | O | 數量1(EDTCDE(1)) |
| DFLD3 | 12,45 | 4,0 | N | O | 數量2(EDTCDE(1)) |
| DSH07 | 12,55 | 9,0 | N | O | 進項稅額(EDTCDE(1)) |
| DS207 | 12,67 | 9,0 | N | O | 稅額(EDTCDE(1)) |

#### SFLCR2 - 第二子檔案控制記錄
包含客戶資料、品名資料、日期資料等完整維護功能。

## 5. 明細畫面

### 5.1 雙重子檔案設計
- **SFLSR1/SFLCR1**: 銷退折讓主檔清單
- **SFLSR2/SFLCR2**: 銷退折讓明細處理

### 5.2 特殊功能
- 支援游標定位(CSRLOC)
- 強制輸入資料(FRCDTA)
- 鎖定模式(LOCK)
- 分頁處理支援

## 6. 功能鍵說明

| 功能鍵 | 說明 |
|--------|------|
| F3 | 回到前頁 |
| F12 | 回前前頁(SFLCR2) |
| F4 | 功能4(SFLCR2) |
| F5 | 功能5(SFLCR2) |

## 7. 輸入欄位驗證

### 7.1 欄位值驗證
- **DOPT1**: VALUES(' ' '2' '4')
  - ' ': 不處理
  - '2': 銷退折扣
  - '4': 刪除

- **DOPT2**: VALUES(' ' '2' '5')
  - ' ': 不處理
  - '2': 銷退單位處理
  - '5': 銷退單位查詢

### 7.2 欄位格式驗證
- **DSG06**: 日期格式(EDTWRD('  /  /  '))
- **DSG10**: 金額格式(EDTCDE(1))
- **SH04/SH05**: 金額格式(EDTCDE(1))
- **DSH07/DS207**: 稅額格式(EDTCDE(1))

## 8. 錯誤處理

### 8.1 錯誤訊息指示器
| 指示器 | 訊息ID | 說明 |
|--------|--------|------|
| 97 | | 動態訊息(DMSG) |
| 96-85 | UPT/URE系列 | 各類錯誤訊息 |
| 98 | CPF5203 | 子檔案訊息 |

### 8.2 特殊錯誤訊息
- URE 0063: 銷退相關錯誤
- URE 0025/0026: 金額相關錯誤
- URE 0102: 處理相關錯誤

## 9. 使用說明

### 9.1 作業流程
1. 設定查詢條件(客戶、日期、發票字頭)
2. 顯示銷退折讓清單
3. 選擇作業項目執行相關功能
4. 在明細畫面進行詳細處理

### 9.2 注意事項
- 支援雙重子檔案操作
- 包含Y2K修改(M001)
- 營業稅法修改支援(M002)
- 提供完整的銷退折讓管理功能
- 支援進項稅額計算 