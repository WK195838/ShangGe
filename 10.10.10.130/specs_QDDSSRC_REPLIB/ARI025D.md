# ARI025D 銷貨折讓查詢－依產品螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARI025D |
| 程式名稱 | 銷貨折讓查詢－依產品 |
| 程式類型 | DSPF (Display File) |
| 作者 | A1087 JOYCE |
| 建立日期 | 81/04/06 |
| 修改日期 | M004(00.06.12-營業稅法修改) |
| 對應程式 | ARI025 |
| 系統 | 尚格資訊 |
| 子系統 | 應收帳款作業 |
| 功能說明 | 銷貨折讓查詢（依產品） |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24行 × 80列 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印支援 | PRINT |

## 3. 螢幕布局

### 產品清單畫面 (SFLCR1)
```
 ARI025                  【訊息】                               日期：YY/MM/DD
 SCR001                銷貨折讓查詢                            時間：HH:MM:SS
                                                              USER：XXXXXXXXXX

      5=明細查詢
 A產品代號 客戶代號            客戶
 XXXXXXXXXX XXXXXX XXXXXX XXXXXXXXXXXXXXXXXXXX

 說明  F3 =返回前頁

```

### 明細畫面 (SFLCR2)
```
 ARI025                  【訊息】                               日期：YY/MM/DD
 SCR002                銷貨折讓查詢                            時間：HH:MM:SS
                                                              USER：XXXXXXXXXX

 客戶代號：XXXXXXXXXXXX
 產品代號：XXXXXXXXXX XXXXXXXXXXXXXXXXXXXX
 客戶代號：XXXXXX XXXXXX XXXXXXXXXXXXXXXXXXXX

 折讓編號：
 MM/DD/YY 折讓編號  折讓編號   營業稅 數量 數量 折讓  銷貨折讓營業稅額
 MM/DD/YY XXXXXXXXXX XXXXXXXXXX 999,999 999,999 999,999 999,999

 說明  F3 =返回前頁  F12=返回前面

```

## 4. 紀錄格式

### 子檔案記錄1 SFLSR1 (產品清單)

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | - | 4,0 | N | H | 記錄相對號碼 |
| DOPT1 | 9,2 | 1 | A | B | 選項代碼 |
| AG03 | 9,4 | - | A | O | 產品代號 |
| AG09 | 9,15 | - | A | O | 客戶代號1 |
| AG10 | 9,21 | - | A | O | 客戶代號2 |
| ME04 | 9,26 | - | A | O | 客戶名稱 |
| AG01 | 9,46 | - | A | O | 客戶編號 |

### 子檔案記錄2 SFLSR2 (明細)

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN2 | - | 4,0 | N | H | 記錄相對號碼 |
| AG11 | - | - | A | H | 折讓日期隱藏 |
| DAG11 | 11,2 | 6,0 | N | O | 折讓日期顯示 |
| AG02 | 11,11 | - | A | O | 折讓編號1 |
| SG02 | 11,24 | - | A | O | 折讓編號2 |
| AG04 | 11,37 | - | A | O | 發票號碼 |
| AG12 | 11,48 | - | N | O | 營業稅 |
| AG13 | 11,54 | - | N | O | 數量1 |
| AG06 | 11,59 | - | N | O | 數量2 |
| W0721 | 11,70 | 9,0 | N | O | 銷貨折讓營業稅額 |
| AG21 | 12,68 | 9,0 | N | O | 折讓 |

## 5. 明細畫面

### 雙重子檔案架構
- **SFLSR1/SFLCR1**: 產品清單，每頁12筆記錄
- **SFLSR2/SFLCR2**: 折讓明細，每頁5筆記錄

## 6. 功能鍵說明

| 功能鍵 | 功能說明 |
|--------|----------|
| F3 | 返回前頁 |
| F12 | 返回前面 |
| ROLLUP | 下一頁 |

## 7. 輸入欄位驗證

### 選項驗證

| 欄位名稱 | 驗證規則 | 有效值 |
|----------|----------|--------|
| DOPT1 | 產品清單選項 | ' ', '5' |

### 查詢條件驗證

| 欄位名稱 | 驗證規則 | 錯誤處理 |
|----------|----------|----------|
| DBGN12 | 產品代號格式 | 輸入格式檢查 |
| DBGN13 | 客戶代號1格式 | 輸入格式檢查 |
| DBGN14 | 客戶代號2格式 | 輸入格式檢查 |
| DBGN2 | 明細查詢日期 | 日期格式驗證 |

## 8. 錯誤處理

### 錯誤訊息定義

| 指示器 | 錯誤代碼 | 錯誤訊息來源 | 說明 |
|--------|----------|--------------|------|
| 98 | CPF5203 | PTMF | 檔案操作錯誤 |
| 97 | DMSG | - | 動態訊息顯示 |
| 96-89 | UPT系列 | PTMF | 各種輸入錯誤 |

## 9. 使用說明

### 作業流程
1. 系統顯示銷貨折讓查詢畫面
2. 輸入產品代號等查詢條件
3. 系統顯示符合條件的產品清單
4. 選擇5=明細查詢可查看折讓詳細資訊

### 查詢功能
- **依產品查詢**: 查詢特定產品的所有折讓記錄
- **明細查詢**: 查看折讓的詳細資訊

### 修改歷程
- **M004**: 營業稅法修改，新增銷貨折讓營業稅額欄位

### 注意事項
- 支援雙重子檔案結構
- 明細畫面每頁記錄數由10筆調整為5筆（M004修改）
- 所有金額和數量欄位均使用適當的編輯碼格式化 