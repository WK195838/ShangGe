# ARI024D 折讓查詢－依客戶螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARI024D |
| 程式名稱 | 折讓查詢－依客戶 |
| 程式類型 | DSPF (Display File) |
| 作者 | A1139 JANE |
| 建立日期 | 81/03/27 |
| 修改日期 | M004(00.05.17-營業稅法修改) |
| 對應程式 | ARI024 |
| 系統 | 尚格資訊 |
| 子系統 | 查詢系統 |
| 功能說明 | 折讓查詢 (I) |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24行 × 80列 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印支援 | PRINT |

## 3. 螢幕布局

### 折讓清單畫面 (SFLCR1)
```
 ARI024                  【訊息】                               日期：YY/MM/DD
 SCR001                折讓查詢                                時間：HH:MM:SS
                                                              USER：XXXXXXXXXX

      5=明細查詢
        客戶編號
 A 客戶  MM/DD/YY開單  折讓編號    折讓金額      類別   折讓額
 XXXXXX XXXXXX MM/DD/YY XXXXXXXXXX  999,999      XXXXXX 999,999

 說明  F3 =返回前頁

```

### 折讓明細畫面 (SFLCR2)
```
 ARI024                  【訊息】                               日期：YY/MM/DD
 SCR002                對應發票查詢                            時間：HH:MM:SS
                                                              USER：XXXXXXXXXX

 客戶代號：XXXXXXXXXXXX                    客戶代號：XXXXXXXXXX-XXXXXXXXXX
                                         XXXXXXXXXXXXXXXXXXXX
 折讓編號：XXXXXXXXXXXX                    折讓日期：MM/DD/YY (MM/DD/YY)
 折讓編號：XXXXXXXXXXXX                    折讓額：MM/DD/YY (MM/DD/YY)
 營業稅額：999,999                        營業稅金額：999,999
                                         營業稅額：999,999
      5=對應發票查詢                       系統營業稅額：999,999
 A 產品代號 銷退數量  退回數量 退回總額  銷退數量  銷退稅額  銷退稅額
 XXXXXXXXXX  999,999  999,999  999,999  999,999  999,999  999,999

 說明  F3 =返回前頁  F12=返回前面

```

## 4. 紀錄格式

### 子檔案記錄1 SFLSR1 (折讓清單)

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | - | 4,0 | N | H | 記錄相對號碼 |
| DOPT1 | 9,2 | 1 | A | B | 選項代碼 |
| AH01 | - | - | A | H | 客戶代號隱藏 |
| AH02 | 9,5 | - | A | O | 客戶代號1 |
| AH03 | 9,21 | - | A | O | 客戶代號2 |
| DAH05 | 9,12 | 6,0 | N | O | 開單日期 |
| AH04 | 9,27 | - | A | O | 折讓編號 |
| WAH06 | 9,41 | - | N | O | 折讓金額 |
| KIND | 9,57 | 6 | A | O | 類別 |
| DAH07 | 9,64 | - | N | O | 折讓額 |
| HAH05 | - | 8,0 | N | H | 日期隱藏欄位 |

### 子檔案控制記錄1 SFLCR1

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN1 | - | 4,0 | N | H | 顯示記錄號碼 |
| $EGMDY | 1,70 | 6,0 | N | O | 系統日期 |
| $USER | 3,70 | 10 | A | O | 使用者ID |
| DBGN1 | 8,5 | - | A | B | 起始客戶代號1 |
| DBGN2 | 8,21 | - | A | B | 起始客戶代號2 |
| DBGN3 | 8,12 | 6,0 | N | B | 起始開單日期 |
| DBGN4 | 8,27 | - | A | B | 起始折讓編號 |

### 子檔案記錄2 SFLSR2 (折讓明細)

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN2 | - | 4,0 | N | H | 記錄相對號碼 |
| DOPT2 | 12,2 | 1 | A | B | 選項代碼 |
| SH03 | 12,5 | - | A | O | 產品代號 |
| SH04 | 12,17 | - | N | O | 銷退數量 |
| SH05 | 12,31 | - | N | O | 退回數量 |
| DTOT | 12,42 | 5,0 | N | O | 退回總額 |
| SH07 | 12,50 | - | N | O | 銷退稅額 |
| S207 | 12,65 | 9,0 | N | O | 銷退稅額2 |

### 子檔案控制記錄2 SFLCR2

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN2 | - | 4,0 | N | H | 顯示記錄號碼 |
| AH01 | 4,15 | - | A | O | 客戶代號 |
| D#B03 | 4,18 | 16 | A | O | 分隔符 |
| AH02 | 4,52 | - | A | O | 客戶代號起 |
| AH03 | 4,60 | - | A | O | 客戶代號迄 |
| ME04 | 5,50 | - | A | O | 客戶名稱 |
| AH04 | 6,15 | - | A | O | 折讓編號 |
| DAH05 | 6,52 | 6,0 | N | O | 折讓日期 |
| AH07 | 7,15 | - | N | O | 折讓額 |
| DAH08 | 7,52 | 6,0 | N | O | 折讓額日期 |
| AH06 | 8,52 | - | N | O | 營業稅金額 |
| WTAX | 9,52 | 9,0 | N | O | 營業稅額 |
| WAH06 | 10,52 | 9,0 | N | O | 系統營業稅額 |

## 5. 明細畫面

### 雙重子檔案架構
- **SFLSR1/SFLCR1**: 折讓清單顯示，每頁12筆記錄
- **SFLSR2/SFLCR2**: 折讓明細顯示，每頁8筆記錄

### 功能特色
- 支援依客戶查詢折讓資料
- 包含營業稅額計算功能
- 提供對應發票查詢功能

## 6. 功能鍵說明

### 折讓清單畫面功能鍵

| 功能鍵 | 功能說明 |
|--------|----------|
| F3 | 返回前頁 |
| ROLLUP | 下一頁 |

### 折讓明細畫面功能鍵

| 功能鍵 | 功能說明 |
|--------|----------|
| F3 | 返回前頁 |
| F12 | 返回前面 |
| ROLLUP | 下一頁 |

## 7. 輸入欄位驗證

### 選項驗證

| 欄位名稱 | 驗證規則 | 有效值 |
|----------|----------|--------|
| DOPT1 | 折讓清單選項 | ' ', '5' |
| DOPT2 | 折讓明細選項 | ' ', '5' |

### 查詢條件驗證

| 欄位名稱 | 驗證規則 | 錯誤處理 |
|----------|----------|----------|
| DBGN1 | 客戶代號1格式 | 輸入格式檢查 |
| DBGN2 | 客戶代號2格式 | 輸入格式檢查 |
| DBGN3 | 開單日期格式 | 日期格式驗證 |
| DBGN4 | 折讓編號格式 | 輸入格式檢查 |

## 8. 錯誤處理

### 錯誤訊息定義

| 指示器 | 錯誤代碼 | 錯誤訊息來源 | 說明 |
|--------|----------|--------------|------|
| 98 | CPF5203 | PTMF | 檔案操作錯誤 |
| 97 | DMSG | - | 動態訊息顯示 |
| 96-89 | UPT系列 | PTMF | 各種輸入錯誤 |
| 88 | URE0055 | REMF | 系統查詢錯誤 |

## 9. 使用說明

### 作業流程
1. 系統顯示折讓查詢畫面
2. 輸入客戶代號等查詢條件
3. 系統顯示符合條件的折讓清單
4. 選擇5=明細查詢可查看折讓詳細資訊
5. 在明細畫面可進一步查看對應發票

### 查詢功能
- **依客戶查詢**: 查詢特定客戶的所有折讓記錄
- **明細查詢**: 查看折讓的產品明細資訊
- **對應發票查詢**: 查看折讓相關的發票資料

### 折讓資訊
- **折讓編號**: 折讓單據的編號
- **折讓金額**: 折讓的金額
- **營業稅額**: 折讓相關的營業稅金額
- **類別**: 折讓的類別區分

### 修改歷程
- **M004**: 營業稅法修改，新增營業稅額相關欄位

### 注意事項
- 支援雙重子檔案結構
- 具備完整的錯誤處理機制
- 包含營業稅額計算和顯示功能
- 所有金額和數量欄位均使用適當的編輯碼格式化
- 使用ARAHLF檔案作為欄位參考 