# ARA0083D 銷退折讓處理－發票分配查詢 螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARA0083D |
| 程式名稱 | 銷退折讓處理－發票分配查詢 |
| 程式類型 | 螢幕格式檔（DSPF） |
| 作者 | A1084 JOYCE |
| 建立日期 | 81/03/27 |
| 程式名稱 | ARA008 |
| 系統 | 應收帳款 |
| 子系統 | 應收帳管作業 |
| 功能說明 | 銷退折讓處理－發票分配查詢 |
| 修改記錄 | M001(Y2K), M002(營業稅法修改) |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24x80 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印功能 | PRINT |

## 3. 螢幕布局

```
ARA008                         程式訊息                        日期:MM/DD/YY
SCR003                       銷退折讓處理                       時間:HH:MM:SS
                                                                USER :XXXXXXX
客戶代碼:XXXXXX XXXXXXXXXXXXXXX                   品名編號：XXXXXX XXXXXXX
項目名稱:XXXXXX XXXXXXXXXXXXXXXXXX                            XXXXXXX
發票字頭:XXXXXX                           銷退日期:MM/DD/YY (MM/DD/YY)
                                          折讓日期:MM/DD/YY (MM/DD/YY)
銷退字頭:XXXXXX                           進項稅額：XXXXXXXXX
數量單價:XXXXXXXXX                        折讓銷退數量：XXXXXXXXX
退貨數量:XXXXXXXXX                        折讓銷退數量：XXXXXXXXX

         -發票數量-        -分配數量- 收據日期～銷退金額
發票號碼   數量 退貨  發票金額  數量 退貨   進項稅額     銷項稅額
                                    
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
底線   F3 =回到前頁   F12=回前前頁   
                                                                [錯誤訊息位置]
```

## 4. 紀錄格式

### 4.1 主畫面記錄格式

#### SFLSR1 - 子檔案記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | | 4,0 | N | H | 記錄號碼 |
| DAG04 | 13,4 | R | A | O | 發票號碼 |
| DSJ04A | 13,15 | R | N | O | 數量(EDTCDE(1)) |
| SJ13 | 13,22 | R | N | O | 退貨數量(EDTCDE(1)) |
| DSJ06A | 13,28 | R | N | O | 發票金額(EDTCDE(3)) |
| DSJ06B | 13,39 | R | N | O | 分配數量(EDTCDE(3)) |
| DAG12 | 13,49 | R | N | O | 數量(EDTCDE(3)) |
| DAG13 | 13,55 | R | N | O | 退貨數量(EDTCDE(3)) |
| DAG06 | 13,60 | R | N | O | 發票金額(EDTCDE(3)) |
| DAG07 | 13,71 | R | N | O | 進項稅額(EDTCDE(3)) |
| DSI21 | 14,4 | 6,0 | N | O | 收據日期(EDTCDE(Y)) |
| DAG21 | 14,60 | 6,0 | N | O | 分配金額(EDTCDE(1)) |
| DSI24 | 14,71 | 6,0 | N | O | 銷項稅額(EDTCDE(J)) |

#### SFLCR1 - 子檔案控制記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN1 | | 4,0 | N | H | 子檔案記錄指標 |
| DATA2 | | 6,0 | N | H | 資料欄位2 |
| $EGMDY | 1,70 | 6,0 | N | O | 系統日期(EDTCDE(Y)) |
| $USER | 3,70 | 10 | A | O | 使用者代號 |
| SH01 | 4,14 | R | A | O | 客戶代碼 |
| #B03 | 4,17 | R | A | O | 客戶名稱 |
| SG04 | 4,50 | R | A | O | 品名編號 |
| SG05 | 4,56 | R | A | O | 品名代號 |
| SH03 | 5,14 | R | A | O | 項目名稱 |
| MA03 | 5,24 | R | A | O | 產品代碼 |
| ME04 | 4,61 | R | A | O | 產品中文名稱 |
| SG09 | 6,14 | R | A | O | 發票字頭 |
| DSG06 | 5,57 | 6,0 | N | O | 銷退日期(EDTWRD('  /  /  ')) |
| DSG26 | 6,57 | 6,0 | N | O | 折讓日期(EDTWRD('  /  /  ')) |
| SH02 | 7,14 | R | A | O | 銷退字頭 |
| DSH07 | 7,57 | R | N | O | 進項稅額(EDTCDE(1)) |
| SH04 | 8,14 | R | N | O | 數量單價(EDTCDE(1)) |
| DSH041 | 8,57 | R | N | O | 折讓銷退數量(EDTCDE(1)) |
| SH05 | 9,15 | R | N | O | 退貨數量(EDTCDE(1)) |
| DSH051 | 9,58 | R | N | O | 折讓銷退數量(EDTCDE(1)) |

## 5. 明細畫面

### 5.1 子檔案查詢畫面
- **SFLSR1/SFLCR1**: 發票分配查詢清單
  - 純查詢功能，無選項欄位
  - 顯示發票分配的詳細狀況
  - 支援大容量分頁顯示(SFLPAG(0004), SFLSIZ(0060))
  - 顯示發票與分配數量的對照關係

### 5.2 客戶與產品資訊顯示
- 顯示客戶基本資料(代碼、名稱)
- 顯示產品資訊(品名編號、名稱)
- 顯示銷退與折讓相關日期及稅額

## 6. 功能鍵說明

| 功能鍵 | 說明 |
|--------|------|
| F3 | 回到前頁 |
| F12 | 回前前頁 |
| CA03(03) | 取消作業 |
| CA12(12) | 回到前面 |
| Page Up/Down | 子檔案分頁 |

## 7. 輸入欄位驗證

### 7.1 查詢專用功能
- 本畫面為純查詢功能，無輸入欄位驗證
- 子檔案僅用於顯示，無SFLNXTCHG檢查

### 7.2 欄位格式顯示
- **日期類欄位**: EDTCDE(Y)及EDTWRD('  /  /  ')格式
- **金額類欄位**: EDTCDE(1/3/J)不同精度格式
- **數量類欄位**: EDTCDE(1/3)格式

### 7.3 條件式欄位控制
- 所有資料欄位均為輸出專用(屬性O)
- 隱藏欄位(屬性H)用於內部處理

## 8. 錯誤處理

### 8.1 錯誤訊息指示器
| 指示器 | 訊息ID | 說明 |
|--------|--------|------|
| 97 | | 動態訊息(DMSG) |
| 96 | UPT 2150 | 錯誤訊息1 |
| 95 | UPT 2142 | 錯誤訊息2 |
| 94 | UPT 2050 | 錯誤訊息3 |
| 93 | UPT 0010 | 錯誤訊息4 |
| 92 | UPT 2010 | 錯誤訊息5 |
| 91 | UPT 2020 | 錯誤訊息6 |
| 90 | UPT 0040 | 錯誤訊息7 |
| 89 | UPT 0030 | 錯誤訊息8 |
| 88 | URE 0056 | 銷退分配相關錯誤 |
| 87 | URE 0057 | 分配查詢錯誤 |
| 86 | URE 0025 | 金額相關錯誤 |
| 85 | URE 0062 | 數量相關錯誤 |
| 98 | CPF5203 | 子檔案訊息 |

### 8.2 訊息處理
- 訊息顯示位置: 第24列
- 訊息檔案: PTMF, REMF
- 程式訊息: URE9999 (REMF)
- 一般訊息: UPT9999 (PTMF)

## 9. 使用說明

### 9.1 作業流程
1. 由上層程式傳入銷退折讓基本資料
2. 系統顯示客戶、產品、銷退相關資訊
3. 顯示相關發票的分配狀況查詢結果
4. 可捲動瀏覽所有相關的發票分配記錄
5. 按F3或F12返回上層畫面

### 9.2 查詢功能
- **分配狀況查詢**: 顯示發票分配的詳細狀況
- **數量對照**: 顯示發票原始數量與分配數量
- **金額追蹤**: 顯示發票金額與分配金額對照
- **稅額計算**: 顯示進項稅額與銷項稅額

### 9.3 注意事項
- 本畫面為純查詢功能，不可修改資料
- 支援大容量資料分頁瀏覽(SFLSIZ增大到0060)
- 包含Y2K修改支援(M001)
- 支援營業稅法修改後的稅額顯示(M002)
- 提供完整的發票分配追蹤功能

### 9.4 欄位說明
- **發票號碼**: 分配目標的發票編號
- **數量/退貨**: 發票原始的數量資料
- **發票金額**: 發票的原始金額
- **分配數量**: 已分配的數量
- **進項稅額**: 分配產生的進項稅額
- **銷項稅額**: 分配產生的銷項稅額
- **收據日期**: 相關的收款日期資訊 