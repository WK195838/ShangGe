# ARI021D 發票資料查詢－依客戶螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARI021D |
| 程式名稱 | 發票資料查詢－依客戶 |
| 程式類型 | DSPF (Display File) |
| 作者 | A1139 JANE |
| 建立日期 | 81/03/25 |
| 修改日期 | M004(00.10.16-系統修改), M005(01.01.12-營業稅修改), 00A(2019/10/24-發票金額欄位調整) |
| 對應程式 | ARI021 |
| 系統 | 尚格資訊 |
| 子系統 | 查詢系統 |
| 功能說明 | 發票資料查詢 (I) |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24行 × 80列 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印支援 | PRINT |

## 3. 螢幕布局

### 發票清單畫面 (SFLCR1)
```
 ARI021                  【訊息】                               日期：YY/MM/DD
 SCR001            發票資料查詢(依客戶)                        時間：HH:MM:SS
                                                              USER：XXXXXXXXXX

      5=明細查詢                    6=單據查詢
 A客戶代號 發票日期 發票號碼   發票金額      來源號碼 發票金額  來源 營業稅額
 XXXXXX XXXXXX YY/MM/DD XXXXXXXXXX XXXXXXXXXX 999,999,999 999,999,999  X   999,999

 說明  F3 =返回前頁

```

### 發票明細畫面 (SFLCR2)
```
 ARI021                  【訊息】                               日期：YY/MM/DD
 SCR002                發票資料查詢                            時間：HH:MM:SS
                                                              USER：XXXXXXXXXX

 客戶代號：XXXXXXXXXXXX                    客戶代號：XXXXXXXXXX-XXXXXXXXXX
 發票名稱：XXXXXXXXXXXXXXXXXXXX            客戶名稱：XXXXXXXXXXXXXXXXXXXX
 發票金額：999,999,999                    發票日期：MM/DD/YY (MM/DD/YY)
 系統金額：999,999                        批次統編：XXXXXXXXXXXX
 銷退金額：999,999                        營業稅額：999,999,999

 產品代號   數量  數量     產品金額 數量  單價數量 營業稅額
          單價  單價        銷退    銷退     銷退
 XXXXXXXXXX 999,999 999,999 999,999,999 999,999 999,999 999,999
 XXXXXXXXXXXXXXXXXXXX

```

## 4. 紀錄格式

### 子檔案記錄1 SFLSR1 (發票清單)

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | - | 4,0 | N | H | 記錄相對號碼 |
| DOPT1 | 9,2 | 1 | A | B | 選項代碼 |
| SI12 | 9,4 | - | A | O | 客戶代號1 |
| SI13 | 9,10 | - | A | O | 客戶代號2 |
| DSI21 | 9,15 | 6,0 | N | O | 發票日期 |
| SI25 | 9,48 | - | N | O | 發票金額 |
| DTOT | 9,61 | 9,0 | N | O | 來源金額 |
| SI30 | 9,71 | - | A | O | 來源號碼 |
| SI02 | 9,24 | - | A | O | 發票號碼 |
| SI10 | 9,35 | - | A | O | 發票名稱 |
| SI01 | - | - | A | H | 客戶代號隱藏欄位 |

### 子檔案控制記錄1 SFLCR1

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN1 | - | 4,0 | N | H | 顯示記錄號碼 |
| $EGMDY | 1,70 | 6,0 | N | O | 系統日期 |
| $USER | 3,70 | 10 | A | O | 使用者ID |
| DBGN1 | 8,4 | - | A | B | 起始客戶代號1 |
| DBGN2 | 8,10 | - | A | B | 起始客戶代號2 |
| DBGN3 | 8,15 | 6,0 | N | B | 起始發票日期 |

### 子檔案記錄2 SFLSR2 (發票明細)

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN2 | - | 4,0 | N | H | 記錄相對號碼 |
| SJ03 | 12,3 | - | A | O | 產品代號 |
| D#A | 12,14 | - | N | O | 數量 |
| SJ13 | 12,22 | 4,0 | N | O | 單價數量 |
| PRICE | 12,28 | 9,2 | N | O | 產品金額 |
| DSJ06 | 12,39 | 9,0 | N | O | 銷退數量 |
| SJ14 | 12,50 | 5,0 | N | O | 銷退單價 |
| SJ15 | 12,61 | 4,0 | N | O | 銷退數量2 |
| SJ09 | 12,67 | - | N | O | 營業稅額 |
| MA03 | 13,2 | - | A | O | 產品名稱 |

### 子檔案控制記錄2 SFLCR2

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN2 | - | 4,0 | N | H | 顯示記錄號碼 |
| SI01 | 4,14 | - | A | O | 客戶代號 |
| D#B03 | 4,17 | 16 | A | O | 客戶分隔符 |
| SI08 | 4,52 | - | A | O | 客戶代號起 |
| SI09 | 4,60 | - | A | O | 客戶代號迄 |
| SI02 | 5,14 | - | A | O | 發票名稱 |
| ME04 | 5,52 | - | A | O | 客戶名稱 |
| SI25 | 6,14 | - | N | O | 發票金額 |
| DSI21 | 6,52 | 6,0 | N | O | 發票日期 |
| SI27 | 7,14 | - | N | O | 系統金額 |
| SI11 | 7,52 | - | A | O | 批次統編 |
| SI28 | 8,14 | - | N | O | 銷退金額 |
| SI30 | 8,52 | - | N | O | 營業稅額 |

## 5. 明細畫面

### 雙重子檔案架構
- **SFLSR1/SFLCR1**: 發票清單顯示，每頁12筆記錄
- **SFLSR2/SFLCR2**: 發票明細顯示，每頁4筆記錄

### 功能特色
- 支援下拉式明細顯示 (SFLDROP)
- 具備完整的發票資訊查詢
- 包含產品明細和營業稅額資訊

## 6. 功能鍵說明

### 發票清單畫面功能鍵

| 功能鍵 | 功能說明 |
|--------|----------|
| F3 | 返回前頁 |
| ROLLUP | 下一頁 |

### 發票明細畫面功能鍵

| 功能鍵 | 功能說明 |
|--------|----------|
| F1 | 下拉詳細 |
| F3 | 返回前頁 |
| F12 | 返回前面 |

## 7. 輸入欄位驗證

### 選項驗證

| 欄位名稱 | 驗證規則 | 有效值 |
|----------|----------|--------|
| DOPT1 | 發票清單選項 | ' ', '5', '6' |
| DOPT2 | 明細選項 | ' ', '5' |

### 查詢條件驗證

| 欄位名稱 | 驗證規則 | 錯誤處理 |
|----------|----------|----------|
| DBGN1 | 起始客戶代號1 | 輸入格式檢查 |
| DBGN2 | 起始客戶代號2 | 輸入格式檢查 |
| DBGN3 | 起始發票日期 | 日期格式驗證 |

## 8. 錯誤處理

### 錯誤訊息定義

| 指示器 | 錯誤代碼 | 錯誤訊息來源 | 說明 |
|--------|----------|--------------|------|
| 98 | CPF5203 | PTMF | 檔案操作錯誤 |
| 97 | DMSG | - | 動態訊息顯示 |
| 96 | UPT2150 | PTMF | 日期格式錯誤 |
| 95 | UPT2142 | PTMF | 欄位輸入錯誤 |
| 94 | UPT2050 | PTMF | 資料格式錯誤 |
| 93 | UPT0010 | PTMF | 必要欄位未輸入 |
| 92 | UPT2010 | PTMF | 資料重複 |
| 91 | UPT2020 | PTMF | 資料不完整 |
| 90 | UPT0040 | PTMF | 操作權限錯誤 |
| 89 | UPT0030 | PTMF | 資料狀態錯誤 |
| 88 | URE0055 | REMF | 系統查詢錯誤 |

## 9. 使用說明

### 作業流程
1. 系統顯示發票資料查詢畫面
2. 可輸入客戶代號和發票日期等查詢條件
3. 系統顯示符合條件的發票清單
4. 選擇5=明細查詢可查看發票詳細資訊
5. 選擇6=單據查詢可查看相關單據

### 查詢功能
- **依客戶查詢**: 依客戶代號範圍查詢發票
- **明細查詢**: 查看發票的產品明細資訊
- **單據查詢**: 查看相關的單據資料

### 修改歷程
- **M004**: 系統介面修改
- **M005**: 營業稅相關功能調整
- **00A**: 發票金額欄位顯示位置調整

### 注意事項
- 支援雙重子檔案結構，功能完整
- 具備完整的錯誤處理機制
- 包含營業稅額查詢功能
- 支援分頁瀏覽和下拉詳細顯示 