# ARA0161D 人工發票控制維護子畫面螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARA0161D |
| 程式名稱 | 人工發票控制維護子畫面 |
| 程式類型 | DSPF (Display File) |
| 作者 | TINA |
| 建立日期 | 82/08/25 |
| 修改日期 | 98.11.17 (M001-Y2K修改), 00.05.02 (M004-營業稅修改) |
| 對應程式 | ARA016 |
| 系統 | 尚格資訊 |
| 子系統 | 應收帳款作業系統 |
| 功能說明 | 人工發票控制維護子畫面 (A/U/D/I) |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24行 × 80列 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印支援 | PRINT |

## 3. 螢幕布局

### 清單畫面 (SFLCR1)
```
 ARA016                  【訊息】                               日期：YY/MM/DD
 SCR002               人工發票控制維護                         時間：HH:MM:SS
                                                              USER：XXXXXXXXXX

 輸入作業碼：
      1=新增      5=查詢
  選                                                            數量
 A 客戶代號 發票日期   Ⅰ客戶 發票號碼  客戶名稱      批次金額  總數
 XXXXXXXXXXXX YY/MM/DD XXXXX XXXXX XXXXXXXXXXXXXXXX  999,999,999  XXX

 說明  F3 =返回前頁   F12=返回前頁

```

### 明細維護畫面 (DSPD2)
```
 ARA016                  【訊息】                               日期：YY/MM/DD
 SCR003              人工發票控制維護                          時間：HH:MM:SS
 XXXXXX                                                       USER：XXXXXXXXXX

    配銷商代號：XXXXXXXXXXXX      配銷商名稱：XXXXXXXXXXXXXXXX

    人工發票號碼：XXXXXXXXXXXX      人工發票名稱：XXXXXXXXXXXXXXXX

    配銷商客戶代號：XXXXXXXXXXXX XXXXXXXXXXXXXXX      批次日期：YY/MM/DD

    配銷品牌代號：XXXXXXXXXXXXXXXX

    人工發票日期：YY/MM/DD

 說明

```

## 4. 紀錄格式

### 子檔案記錄 SFLSR1

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | - | 4,0 | N | H | 記錄相對號碼 |
| DOPT1 | 10,3 | 1 | A | B | 選項代碼 |
| SI01 | 10,7 | - | A | O | 客戶代號 |
| DSI21 | 10,12 | 6,0 | N | O | 發票日期 |
| SI12 | 10,21 | - | A | O | 發票序號1 |
| SI13 | 10,26 | - | A | O | 發票序號2 |
| SI02 | 10,32 | - | A | O | 發票號碼 |
| SI11 | 10,44 | - | A | O | 客戶名稱 |
| SI25 | 10,58 | - | N | O | 批次金額 |
| SI17 | 10,74 | - | A | O | 數量總數 |
| SI19 | 10,77 | - | A | O | 狀態標記 |

### 子檔案控制記錄 SFLCR1

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN1 | - | 4,0 | N | H | 顯示記錄號碼 |
| $EGMDY | 1,70 | 6,0 | N | O | 系統日期 |
| $USER | 3,70 | 10 | A | O | 使用者ID |
| DBGN1 | 9,7 | - | A | B | 起始客戶代號 |
| DBGN0 | 9,12 | 6,0 | N | B | 起始發票日期 |
| DBGN2 | 9,21 | - | A | B | 起始發票序號1 |
| DBGN3 | 9,26 | - | A | B | 起始發票序號2 |
| DBGN4 | 9,32 | - | A | B | 起始發票號碼 |

### 明細維護記錄 DSPD2

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| D#ROW | - | 3,0 | N | H | 游標行位置 |
| D#COL | - | 3,0 | N | H | 游標列位置 |
| DFUN | 3,2 | 6 | A | O | 功能代碼 |
| DSS01 | 5,18 | - | A | O | 配銷商代號 |
| #B03A | 5,21 | - | A | O | 配銷商分隔符 |
| DSS02 | 5,60 | - | A | O | 配銷商名稱 |
| DSS03 | 6,18 | - | A | O | 人工發票號碼 |
| #B03B | 6,21 | - | A | O | 發票分隔符 |
| DSS04 | 6,60 | - | A | B | 人工發票名稱 |
| DSS08 | 7,18 | - | A | O | 配銷商客戶代號 |
| DSS09 | 7,24 | - | A | O | 客戶延伸代號 |
| ME04 | 7,29 | - | A | O | 客戶名稱 |
| DSS06C | 7,60 | 6,0 | N | O | 批次日期 |
| DSS16 | 8,18 | - | A | B | 配銷品牌代號 |
| #A03 | 8,22 | - | A | O | 品牌分隔符 |
| DSS22C | 9,18 | 6,0 | N | B | 人工發票日期 |

## 5. 明細畫面

### 子檔案清單畫面
- 顯示人工發票明細清單，每頁最多10筆記錄
- 支援捲動功能 (ROLLUP)
- 提供選項操作：1=新增、5=查詢

### 明細維護畫面
- 單筆資料的詳細維護畫面
- 支援游標定位功能
- 包含人工發票的基本資訊
- 與ARA016D主畫面共用明細維護畫面

## 6. 功能鍵說明

### 清單畫面功能鍵

| 功能鍵 | 功能說明 |
|--------|----------|
| F3 | 返回前頁 |
| F12 | 返回前頁 |
| ROLLUP | 下一頁 |

### 明細畫面功能鍵

| 功能鍵 | 功能說明 |
|--------|----------|
| F3 | 返回前頁 |
| F4 | 確認操作 |
| F5 | 重新整理 |
| F12 | 取消操作 |

## 7. 輸入欄位驗證

### 選項驗證

| 欄位名稱 | 驗證規則 | 有效值 |
|----------|----------|--------|
| DOPT1 | 選項代碼驗證 | ' ', '1', '5' |

### 輸入欄位驗證

| 欄位名稱 | 驗證規則 | 錯誤處理 |
|----------|----------|----------|
| DSS04 | 人工發票名稱 | 指示器61控制 |
| DSS16 | 配銷品牌代號 | 指示器64控制 |
| DSS22C | 人工發票日期 | 指示器65控制，日期格式驗證 |

## 8. 錯誤處理

### 錯誤訊息定義

| 指示器 | 錯誤代碼 | 錯誤訊息來源 | 說明 |
|--------|----------|--------------|------|
| 98 | CPF5203 | PTMF | 檔案操作錯誤 |
| 97 | DMSG | - | 動態訊息顯示 |
| 96 | UPT2150 | PTMF | 日期格式錯誤 |
| 95 | UPT2142 | PTMF | 欄位輸入錯誤 |
| 94 | UPT2050 | PTMF | 資料格式錯誤 |
| 93 | UPT0010 | PTMF | 必要欄位未輸入 |
| 92 | UPT2010 | PTMF | 資料重複 |
| 91 | UPT2020 | PTMF | 資料不完整 |
| 90 | UPT0040 | PTMF | 操作權限錯誤 |
| 89 | UPT0030 | PTMF | 資料狀態錯誤 |

## 9. 使用說明

### 作業流程
1. 由ARA016D主畫面進入此子畫面
2. 顯示特定條件下的人工發票明細清單
3. 可輸入起始條件進行資料過濾
4. 選擇要操作的記錄並輸入選項代碼
5. 根據選項進入對應的處理模式
6. 完成資料維護後返回清單

### 功能說明
- **新增**: 選項1進入新增模式
- **查詢**: 選項5進入查詢模式
- 支援更精細的人工發票管理

### 與主畫面關係
- 此為ARA016D的子畫面
- 共用相同的明細維護畫面 (DSPD2)
- 提供更詳細的人工發票明細操作

### 注意事項
- M001修改記錄：Y2K相容性調整
- M004修改記錄：營業稅相關欄位調整，精簡部分功能
- 子檔案大小為20筆，每頁顯示10筆
- 支援子檔案分頁瀏覽
- 具備完整的錯誤處理機制 