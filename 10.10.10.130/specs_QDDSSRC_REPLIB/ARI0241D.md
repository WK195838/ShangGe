# ARI0241D 折讓查詢－對應發票查詢螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARI0241D |
| 程式名稱 | 折讓查詢－對應發票查詢 |
| 程式類型 | DSPF (Display File) |
| 作者 | A1139 JANE |
| 建立日期 | 81/03/31 |
| 修改日期 | M004(00.05.18-營業稅法修改) |
| 對應程式 | ARI0241 |
| 系統 | 尚格資訊 |
| 子系統 | 查詢系統 |
| 功能說明 | 對應發票查詢－對應發票查詢 (I) |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24行 × 80列 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印支援 | PRINT |

## 3. 螢幕布局

### 主畫面 (SFLCR)
```
 ARI024                  【訊息】                               日期：YY/MM/DD
 SCR003                對應發票查詢                            時間：HH:MM:SS
                                                              USER：XXXXXXXXXX

 客戶代號：XXXXXXXXXXXX
 客戶代號：XXXXXX XXXXXX XXXXXXXXXXXXXXXXXXXX
 產品代號：XXXXXXXXXX XXXXXXXXXXXXXXXXXXXX
 折讓編號：XXXXXXXXXXXX                    折讓日期：MM/DD/YY (MM/DD/YY)
 折讓編號：XXXXXXXXXXXX                    折讓額：MM/DD/YY (MM/DD/YY)
 折讓數量：999,999,999                    營業稅金額：999,999
                                         營業稅額：999,999
                                         系統營業稅額：999,999

            單價  數量      營業稅發票金額  數量  銷退 銷退稅額
 發票號碼    數量  數量        發票金額  銷退  銷退數量  銷退稅額
 XXXXXXXXXX 9,999  999   999.99   999,999,999  999  999  999,999
            999,999,999

 說明  F3 =返回前頁  F12=返回前面

```

## 4. 紀錄格式

### 子檔案記錄 SFLSR

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN | - | 4,0 | N | H | 記錄相對號碼 |
| AG04 | 14,4 | - | A | O | 發票號碼 |
| D#A | 14,15 | - | N | O | 數量 |
| SJ13 | 14,22 | 4,0 | N | O | 單價 |
| DATA1 | 14,28 | 9,2 | N | O | 發票金額 |
| DATA2 | 14,39 | 9,0 | N | O | 營業稅發票金額 |
| AG12 | 14,49 | - | N | O | 數量2 |
| AG13 | 14,55 | - | N | O | 銷退 |
| AG06 | 14,60 | - | N | O | 銷退數量 |
| AG07 | 14,71 | - | N | O | 銷退稅額 |
| DATA3 | 15,39 | 9,0 | N | O | 發票金額2 |
| AG21 | 15,71 | 9,0 | N | O | 銷退稅額2 |

### 子檔案控制記錄 SFLCR

| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN | - | 4,0 | N | H | 顯示記錄號碼 |
| $EGMDY | 1,70 | 6,0 | N | O | 系統日期 |
| $USER | 3,70 | 10 | A | O | 使用者ID |
| SG01 | 4,15 | - | A | O | 客戶代號 |
| D#B03 | 4,18 | 16 | A | O | 分隔符 |
| SG04 | 5,15 | - | A | O | 客戶代號1 |
| SG05 | 5,21 | - | A | O | 客戶代號2 |
| ME04 | 5,26 | - | A | O | 客戶名稱 |
| PRDN | 6,15 | - | A | O | 產品代號 |
| MA03 | 6,25 | - | A | O | 產品名稱 |
| SG09 | 7,15 | - | A | O | 折讓編號 |
| DSG26 | 7,51 | 6,0 | N | O | 折讓日期 |
| SG02 | 8,15 | - | A | O | 折讓編號2 |
| DSG06 | 8,51 | 6,0 | N | O | 折讓額日期 |
| QTY | 9,15 | 9,0 | N | O | 折讓數量 |
| SH07 | 9,51 | - | N | O | 營業稅金額 |
| S207 | 10,51 | 9,0 | N | O | 營業稅額 |
| W207 | 11,51 | 9,0 | N | O | 系統營業稅額 |

## 5. 明細畫面

### 子檔案清單畫面
- 顯示對應發票的詳細資料，每頁最多4筆記錄
- 包含完整的發票和折讓對應資訊
- 支援營業稅額比較功能

### 功能特色
- 顯示折讓與發票的對應關係
- 包含詳細的營業稅額資訊
- 支援多層級的資料顯示

## 6. 功能鍵說明

| 功能鍵 | 功能說明 |
|--------|----------|
| F3 | 返回前頁 |
| F12 | 返回前面 |

## 7. 輸入欄位驗證

此程式主要為顯示查詢結果，無輸入欄位驗證。

## 8. 錯誤處理

### 錯誤訊息定義

| 指示器 | 錯誤代碼 | 錯誤訊息來源 | 說明 |
|--------|----------|--------------|------|
| 98 | CPF5203 | PTMF | 檔案操作錯誤 |
| 97 | DMSG | - | 動態訊息顯示 |
| 96-89 | UPT系列 | PTMF | 各種輸入錯誤 |

## 9. 使用說明

### 作業流程
1. 由ARI024D折讓查詢主程式呼叫
2. 顯示選定折讓的對應發票詳細資料
3. 提供完整的發票和折讓對應資訊瀏覽

### 顯示資訊
- **客戶資訊**: 客戶代號和名稱
- **產品資訊**: 產品代號和名稱  
- **折讓資訊**: 折讓編號、日期、數量
- **發票明細**: 發票號碼、單價、數量、金額
- **營業稅資訊**: 營業稅金額、營業稅額、系統營業稅額

### 對應關係
- 顯示折讓單據與發票的對應關係
- 包含完整的數量和金額比較
- 支援營業稅額的詳細分析

### 修改歷程
- **M004**: 營業稅法修改，調整營業稅相關欄位顯示和計算

### 注意事項
- 此為ARI024D的子程式，專門顯示對應發票資料
- 支援子檔案分頁瀏覽
- 具備完整的錯誤處理機制
- 所有金額和數量欄位均使用適當的編輯碼格式化
- 程式標題顯示為ARI024，與主程式一致
- 每頁顯示記錄數由8筆調整為4筆（M004修改） 