# ARA0051D 收款沖帳處理－沖帳挑選 螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARA0051D |
| 程式名稱 | 收款沖帳處理－沖帳挑選 |
| 程式類型 | 螢幕格式檔（DSPF） |
| 作者 | A1087 JOYCE |
| 建立日期 | 81/03/26 |
| 程式名稱 | ARA005 |
| 系統 | 應收帳款 |
| 子系統 | 應收帳管作業 |
| 功能說明 | 收款沖帳處理－沖帳挑選 |
| 修改記錄 | M001(98.11.09): Y2K修改<br>M004(00.10.16): 修改營業稅額 |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24x80 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印功能 | PRINT |

## 3. 螢幕布局

```
ARA005                         程式訊息                        日期:MM/DD/YY
SCR003                       收款處理                         時間:HH:MM:SS
                                                                USER :XXXXXXX
客戶代碼:XXXXXX XXXXXXXXXXXXXXX         客戶名稱:XXXXXX XXXXX XXXXXXXXXXXXXXX
收款日期:MM/DD/YY (MM/DD/YY)           收款代碼:XXXXX XXXXXX
收款總金額:xxxxxxxxx                    收款系統餘額:xxxxxxxxx.xx
收款號碼:XXXXXXX                       到期日期:MM/DD/YY (MM/DD/YY)

作業作業項目:            5=收款查詢          6=收款           7=發票查詢
        起始發票號碼:MM/DD/YY
A發票日期、發票號碼、客戶名稱、發票金額、收款餘額、沖帳金額  沖對帳別、收益金額
        (MM/DD/YY)                                           營收統計

                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
                                                                        
底線   F3 =回到前頁    F5=收對帳賬           F12=回前前頁   

[錯誤訊息位置]
```

## 4. 紀錄格式

### 4.1 主畫面記錄格式

#### SFLSR1 - 第一子檔案記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN1 | | 4,0 | N | H | 記錄號碼 |
| DOPT1 | 13,2 | 1 | A | B | 選項(' ','5','6','7') |
| DSI21 | 13,4 | 6,0 | N | O | 發票日期(EDTWRD('  /  /  ')) |
| SI02 | 13,13 | R | A | O | 發票號碼 |
| SI11 | 13,24 | R | A | O | 客戶名稱 |
| SI25 | 13,37 | R | N | O | 發票金額(EDTCDE(L)) |
| SI30 | 13,48 | R | N | O | 收款餘額(EDTCDE(L)) |
| HSI30 | | R | A | H | 隱藏欄位-收款餘額 |
| DAD08 | 13,60 | R | N | B | 沖帳金額(EDTCDE(3)) |
| DAD12 | 13,72 | 6,0 | N | B | 沖對帳別(EDTCDE(4)) |
| HAD10 | 13,79 | R | A | O | 收益統計 |
| HAD08 | | R | A | H | 隱藏欄位-沖帳金額 |

#### SFLCR1 - 第一子檔案控制記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN1 | | 4,0 | N | H | 子檔案記錄指標 |
| $EGMDY | 1,70 | 6,0 | N | O | 系統日期(EDTCDE(Y)) |
| $USER | 3,70 | 10 | A | O | 使用者代號 |
| AC01 | 4,14 | R | A | O | 客戶代碼 |
| #B03 | 4,17 | R | A | O | 客戶名稱 |
| AC02 | 4,51 | R | A | O | 客戶代碼2 |
| AC03 | 4,57 | R | A | O | 客戶代碼3 |
| ME04 | 4,62 | R | A | O | 客戶中文名稱 |
| DAC04 | 5,14 | 6,0 | N | O | 收款日期(EDTWRD('  /  /  ')) |
| AC05 | 5,51 | R | A | O | 收款代碼 |
| MTYPE | 5,54 | 6 | A | O | 收款類型 |
| AC08 | 6,14 | R | N | O | 收款總金額(EDTCDE(1)) |
| AC10 | 6,51 | R | N | O | 收款系統餘額(EDTCDE(J)) |
| HAC10 | | R | A | H | 隱藏欄位-收款系統餘額 |
| AC06 | 7,14 | R | A | O | 收款號碼 |
| DAC07 | 7,51 | 6,0 | N | O | 到期日期(EDTWRD('  /  /  ')) |
| DBGN1 | 12,13 | R | A | B | 起始發票號碼 |
| DBGN0 | 12,4 | 6,0 | N | B | 起始日期(EDTCDE(Y)) |

#### SFLSR2 - 第二子檔案記錄  
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN2 | | 4,0 | N | H | 記錄號碼 |
| SJ03 | 12,3 | R | A | O | 項目代號 |
| D#A | 12,14 | R | N | O | 項目數量(EDTCDE(1)) |
| SJ13 | 12,22 | 4,0 | N | O | 規格(EDTCDE(1)) |
| PRICE | 12,29 | 5,0 | N | O | 單價(EDTCDE(1)) |
| DSJ06 | 12,36 | 8,0 | N | O | 小計(EDTCDE(1)) |
| SJ14 | 12,50 | 5,0 | N | O | 稅額(EDTCDE(1)) |
| SJ15 | 12,61 | 4,0 | N | O | 折扣(EDTCDE(1)) |
| SJ09 | 12,67 | 9,0 | N | O | 總額(EDTCDE(1)) |
| MA03 | 13,2 | R | A | O | 項目名稱 |

#### SFLCR2 - 第二子檔案控制記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DRRN2 | | 4,0 | N | H | 子檔案記錄指標 |

## 5. 明細畫面

### 5.1 第一子檔案清單(收款沖帳)
- **SFLSR1/SFLCR1**: 收款沖帳主要清單
  - 顯示待沖帳的發票清單
  - 提供選項欄位供使用者選擇作業
  - 支援分頁顯示(SFLPAG(0008), SFLSIZ(0016))
  - 可輸入沖帳金額進行沖帳處理

### 5.2 第二子檔案清單(發票明細)
- **SFLSR2/SFLCR2**: 發票明細清單
  - 顯示選取發票的明細項目
  - 支援分頁顯示(SFLPAG(0004), SFLSIZ(0016))
  - 使用SFLDROP下拉顯示方式

### 5.3 客戶及收款資訊
- 顯示完整的客戶基本資料
- 顯示收款相關資訊(日期、金額、餘額等)

## 6. 功能鍵說明

| 功能鍵 | 說明 |
|--------|------|
| F3 | 回到前頁 |
| F5 | 收對帳賬 |
| F12 | 回前前頁 |
| CA03(03) | 取消作業 |
| CF05(05) | 收對帳處理 |
| CA12(12) | 回到前面 |
| CF01 | 子檔案下拉功能(SFLDROP) |
| Enter | 確認執行 |
| Page Up/Down | 子檔案分頁 |

## 7. 輸入欄位驗證

### 7.1 欄位值驗證
- **DOPT1**: VALUES(' ' '5' '6' '7')
  - ' ': 不處理
  - '5': 收款查詢  
  - '6': 收款
  - '7': 發票查詢

### 7.2 欄位格式驗證
- **DSI21**: 日期格式驗證(MM/DD/YY)
- **DAD08**: 金額格式驗證(EDTCDE(3))
- **DAD12**: 數值格式驗證(EDTCDE(4))
- **AC08**: 金額格式驗證(EDTCDE(1))
- **AC10**: 金額格式驗證(EDTCDE(J))

### 7.3 條件式欄位控制
- 指示器60/61/62控制欄位保護及強調顯示
- 指示器54控制子檔案異動檢查(SFLNXTCHG)

## 8. 錯誤處理

### 8.1 錯誤訊息指示器
| 指示器 | 訊息ID | 說明 |
|--------|--------|------|
| 97 | | 動態訊息(DMSG) |
| 96 | UPT 2150 | 錯誤訊息1 |
| 95 | UPT 2142 | 錯誤訊息2 |
| 94 | UPT 2050 | 錯誤訊息3 |
| 93 | UPT 0010 | 錯誤訊息4 |
| 92 | UPT 2010 | 錯誤訊息5 |
| 91 | UPT 2020 | 錯誤訊息6 |
| 90 | UPT 0040 | 錯誤訊息7 |
| 89 | UPT 0030 | 錯誤訊息8 |
| 88 | URE 0048 | 收款相關錯誤訊息9 |
| 87 | URE 0124 | 收款相關錯誤訊息10 |
| 86 | URE 0064 | 收款相關錯誤訊息11 |
| 85 | URE 0143 | 收款相關錯誤訊息12 |
| 98 | CPF5203 | 子檔案訊息 |

### 8.2 訊息處理
- 訊息顯示位置: 第24列
- 訊息檔案: PTMF, REMF
- 程式訊息: URE9999 (REMF)
- 一般訊息: UPT9999 (PTMF)

## 9. 使用說明

### 9.1 作業流程
1. 進入收款沖帳處理畫面
2. 系統顯示客戶基本資料及收款資訊
3. 設定起始條件(起始發票號碼、起始日期)
4. 系統顯示符合條件的待沖帳發票清單
5. 在選項欄位選擇作業:
   - '5': 收款查詢
   - '6': 執行收款沖帳
   - '7': 查詢發票明細
6. 若選擇收款('6')，可在沖帳金額欄位輸入要沖帳的金額
7. 按Enter確認執行沖帳作業
8. 使用F5可查看收對帳結果

### 9.2 雙重子檔案功能
- **第一子檔案**: 顯示待沖帳的發票清單
- **第二子檔案**: 顯示選取發票的明細項目
- 支援發票明細的下拉查看功能

### 9.3 注意事項
- 沖帳金額不可超過發票餘額
- 收款餘額會動態更新
- 支援部分沖帳功能
- 可同時處理多筆發票沖帳
- M004修改營業稅額計算方式

### 9.4 欄位說明
- **收款總金額**: 本次收款的總金額
- **收款系統餘額**: 尚未沖帳的收款餘額
- **發票金額**: 發票的原始金額
- **收款餘額**: 發票尚未收款的餘額
- **沖帳金額**: 本次要沖帳的金額
- **沖對帳別**: 沖帳的對象別設定 