# ARA007D 價差折讓處理 螢幕規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 程式代號 | ARA007D |
| 程式名稱 | 價差折讓處理 |
| 程式類型 | 螢幕格式檔（DSPF） |
| 作者 | A1139 JANE |
| 建立日期 | 81/03/26 |
| 程式名稱 | ARA007 |
| 系統 | 應收帳款 |
| 子系統 | 應收帳子系統 |
| 功能說明 | 價差折讓處理 (A/U/D/I) |
| 修改記錄 | M001(Y2K), M004(營業稅法修改), M005(發票性質設定) |

## 2. 螢幕規格

| 項目 | 規格 |
|------|------|
| 螢幕大小 | 24x80 |
| 螢幕類型 | DSPSIZ(24 80 *DS3) |
| 參考檔案 | REF(*LIBL/RERF) |
| 訊息位置 | MSGLOC(24) |
| 列印功能 | PRINT |

## 3. 螢幕布局

```
ARA007                         程式訊息                        日期:MM/DD/YY
SCR001                       價差折讓處理                       時間:HH:MM:SS
                                                                USER :XXXXXXX
作業作業項目:
    2=修改    4=刪除    5=查詢

A客戶MM/DD/YY發票字頭  品名編號  折讓金額  發票性質  營業稅額    價差標號      

                                                                        
底線   F3 =回到前頁   F6 =新增   
```

## 4. 紀錄格式

### 4.1 主畫面記錄格式

#### SFLSR - 子檔案記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| RRN | | 4,0 | N | H | 記錄號碼 |
| DOPT1 | 10,2 | 1 | A | B | 選項(' ','2','4','5') |
| AF01 | 10,5 | R | A | O | 客戶編號 |
| AF02 | 10,17 | R | A | O | 發票字頭 |
| AF03 | 10,30 | R | A | O | 品名編號 |
| AF04 | 10,36 | R | A | O | 品名 |
| W79 | 10,41 | 9,0 | N | O | 折讓金額(EDTCDE(N)) |
| AF06 | 10,54 | R | A | O | 發票性質 |
| DAF05 | 10,8 | 6,0 | N | O | 日期(EDTWRD('  /  /  ')) |
| AF08 | 10,66 | R | A | O | 營業稅額 |
| S#A031 | 10,69 | 12 | A | O | 價差標號 |

#### DSPD2 - 明細維護記錄
| 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|------|------|------|------|------|
| DAF01 | 5,15 | R | A | B | 客戶代碼 |
| DAF03 | 7,15 | R | A | B | 品名編號 |
| DAF04 | 7,21 | R | A | B | 品名 |
| DAF05 | 11,15 | 6,0 | N | B | 折讓日期 |
| DAF06 | 13,15 | R | A | B | 發票性質 |
| DAF10 | 15,16 | R | N | B | 營業稅額(EDTCDE(J)) |
| DAF07 | 16,16 | R | N | O | 進項稅額(EDTCDE(J)) |
| DAF09 | 17,16 | 9,0 | N | B | 價差專屬(EDTCDE(J)) |
| DAF08 | 19,16 | R | A | B | 價差標號 |

## 5. 明細畫面

### 5.1 子檔案清單畫面
- **SFLSR/SFLCR**: 價差折讓清單
- 支援分頁顯示(SFLPAG(0010), SFLSIZ(0020))
- 提供修改、刪除、查詢選項

### 5.2 明細維護畫面
- **DSPD2**: 價差折讓詳細資料維護
- 包含客戶、品名、稅額、標號等完整資料

## 6. 功能鍵說明

| 功能鍵 | 說明 |
|--------|------|
| F3 | 回到前頁 |
| F6 | 新增 |
| F4 | 發票查詢(DSPD2) |
| F5 | 帳戶資料(DSPD2) |
| F12 | 回前前頁(DSPD2) |

## 7. 輸入欄位驗證

### 7.1 欄位值驗證
- **DOPT1**: VALUES(' ' '2' '4' '5')
  - ' ': 不處理
  - '2': 修改
  - '4': 刪除  
  - '5': 查詢

### 7.2 欄位格式驗證
- **DAF05**: 日期格式(EDTWRD('  /  /  '))
- **W79**: 折讓金額(EDTCDE(N))
- **DAF10**: 營業稅額(EDTCDE(J))
- **DAF07**: 進項稅額(EDTCDE(J))
- **DAF09**: 價差專屬(EDTCDE(J))

## 8. 錯誤處理

### 8.1 錯誤訊息指示器
| 指示器 | 訊息ID | 說明 |
|--------|--------|------|
| 97 | | 動態訊息(DMSG) |
| 96-75 | UPT/URE系列 | 各類錯誤訊息 |
| 98 | CPF5203 | 子檔案訊息 |

### 8.2 特殊功能
- 指示器80: 顯示發票字頭新增成功訊息

## 9. 使用說明

### 9.1 作業流程
1. 設定查詢條件(客戶、日期、發票字頭)
2. 顯示價差折讓清單
3. 選擇作業項目執行相關功能
4. 可新增、修改、刪除、查詢價差記錄

### 9.2 注意事項
- 支援營業稅法修改(M004)
- 包含Y2K修改(M001)
- 發票性質設定功能(M005)
- 計算進項稅額及價差專屬金額
- 提供完整的價差折讓管理功能 