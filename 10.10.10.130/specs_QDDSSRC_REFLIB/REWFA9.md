# REWFA9 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | REWFA9 |
| 檔案類型 | 實體檔 (PF) |
| 檔案說明 | 收回主檔明細 |
| 主索引鍵 | (依KEY欄位設計) |
| 參照檔案 | RERF |
| 建立日期 | (依實際建立日期填入) |
| 維護人員 | (依實際維護人員填入) |

## 2. 檔案功能說明

此實體檔案用於管理產品收回主檔與明細資料，整合收回基本資訊與詳細明細，支援完整的產品收回作業流程管理與確認機制。

### 主要功能
- 管理產品收回主檔資料
- 記錄收回明細資訊
- 支援收回確認流程
- 管理多種成本計算

## 3. 系統檔案清單

| 檔案名稱 | 檔案類型 | 說明 | 關聯 |
|----------|----------|------|------|
| REWFA9 | PF | 收回主檔明細 | 主檔案 |
| RERF | PF | 參照檔案 | REF參照 |

## 4. 記錄格式

### 記錄格式名稱：SN0 (主檔)、SO0 (明細)

| 格式說明 | 記錄長度 | 參照檔案 |
|----------|----------|----------|
| 收回主檔明細記錄格式 | (依欄位定義計算) | RERF |

## 5. 欄位規格

### 5.1 產品收回主檔欄位 (SN系列)
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SN01 | 公司編號 | 1 | R | 文字 | | 公司別 |
| SN02 | 收回號 | 2 | R | 文字 | | 收回單號 |
| SN03 | 出貨倉庫代碼 | 3 | R | 文字 | | 出貨倉庫代碼 |
| SN04 | 入貨倉庫代碼 | 4 | R | 文字 | | 入貨倉庫代碼 |
| SN05 | 收回日期 | 5 | R | 日期 | 8 00, B2CHKA | 收回日期 |
| SN06 | 收回入庫日期 | 6 | R | 日期 | 8 00, B2CHKA | 入庫日期 |
| SN07 | 產品人員 | 7 | R | 文字 | | 產品負責人員 |
| SN08 | 產品名稱索引碼 | 8 | R | 文字 | | 產品索引碼 |

### 5.2 收回狀態控制欄位
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SN09 | 結帳年度 | 9 | R | 文字 | | 結帳年度 |
| SN10 | 結帳編號 | 10 | R | 文字 | | 結帳編號 |
| SN11 | 幣別單位 | 11 | R | 文字 | | 幣別單位 |
| SN12 | 收回運費處理 | 12 | R | 數值 | | 收回運費 |
| SN13 | 收回FOB-TOT | 13 | R | 數值 | | FOB總計 |
| SN14 | 收回FHI-TOT | 14 | R | 數值 | | FHI總計 |
| SN15 | 收回DUTY-TOT | 15 | R | 數值 | | DUTY總計 |

### 5.3 收回狀態說明
根據註解資訊，SN09-SN10 欄位相關的狀態控制：
- **'V'**：已確認
- **'T'**：結帳狀態  
- **'N'**：無法結帳(結帳處理時重新)

### 5.4 產品收回明細欄位 (SO系列)
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SO01 | 公司編號 | 16 | R | 文字 | | 公司別 |
| SO02 | 收回號 | 17 | R | 文字 | | 收回單號 |
| SO03 | 產品代碼 | 18 | R | 文字 | | 產品代碼 |
| SO04 | 收回數量彙總計 | 19 | R | 數值 | | 收回總數量 |
| SO05 | 確認數量 | 20 | R | 數值 | | 確認數量 |
| SO06 | 收回數量含內銷 | 21 | R | 數值 | | 內銷收回數量 |
| SO07 | 收回數量含外銷 | 22 | R | 數值 | | 外銷收回數量 |
| SO08 | 收回日期 | 23 | R | 日期 | 8 00, B2CHKA | 收回日期 |
| SO09 | 出貨倉庫代碼 | 24 | R | 文字 | | 出貨倉庫 |
| SO10 | 入貨倉庫代碼 | 25 | R | 文字 | | 入貨倉庫 |
| SO11 | 產品序號 | 26 | R | 文字 | | 產品序號 |
| SO12 | 稅 | 27 | R | 數值 | | 稅額 |

### 5.5 明細成本計算欄位
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SO13 | 結帳FOB-TOT | 28 | R | 數值 | | 結帳FOB總計 |
| SO14 | 結帳FHI-TOT | 29 | R | 數值 | | 結帳FHI總計 |
| SO15 | 結帳DUTY-TOT | 30 | R | 數值 | | 結帳DUTY總計 |
| SO16 | 收回FOB-TOT | 31 | R | 數值 | | 收回FOB總計 |
| SO17 | 收回FHI-TOT | 32 | R | 數值 | | 收回FHI總計 |
| SO18 | 收回DUTY-TOT | 33 | R | 數值 | | 收回DUTY總計 |

## 6. 主鍵欄位

主鍵設計需依據實際的KEY定義確認，建議包含公司編號、收回號等關鍵識別欄位。

## 7. 索引資料

### 檔案特性
- REF(RERF)：欄位定義參照RERF檔案
- B2CHKA：多個日期欄位檢核
- REFFLD：廣泛使用欄位參照

## 8. 備註

### 特殊說明
- 此檔案為產品收回主檔與明細整合檔
- 包含33個欄位，支援完整收回流程
- 整合SN(主檔)與SO(明細)兩大系列欄位
- 支援複雜的收回確認狀態管理

### 收回管理機制
檔案設計支援完整收回作業：
- **主檔管理**：SN系列欄位管理收回基本資訊
- **明細管理**：SO系列欄位管理收回明細
- **狀態管理**：多種確認狀態控制
- **成本管理**：FOB/FHI/DUTY多種成本計算

### 收回確認狀態機制
提供完整的收回確認狀態管理：
- **已確認**：'V' 收回已確認
- **結帳狀態**：'T' 收回結帳狀態
- **無法結帳**：'N' 無法結帳狀態

### 檔案用途
- 用於產品收回作業管理
- 支援收回確認流程
- 提供收回成本計算
- 管理收回倉庫作業

### 參照檔案說明
使用 REF(RERF) 參照：
- 大量使用 REFFLD 參照系統欄位
- 確保與主系統資料一致性
- 便於維護複雜的欄位定義

### 維護注意事項
- 多個日期欄位使用 B2CHKA 檢核
- 收回確認狀態需維護正確性
- 內外銷收回數量需分別管理
- 多種成本計算需確保準確性

### 系統應用
- 用於產品收回管理系統
- 支援庫存調整作業
- 提供成本分析基礎
- 配合庫存管理系統

### 相關作業
- 產品收回建立與維護作業
- 收回確認作業
- 收回成本分析作業
- 收回入庫作業

### 技術特性
- 主檔明細整合設計
- 複雜的狀態管理機制
- 多種成本類型支援
- 完整的收回流程支援

### 業務流程整合
- 與庫存管理流程整合
- 支援收回處理作業
- 配合成本會計系統
- 提供品質管理基礎

### 收回管理特性
- **倉庫管理**：出入庫倉庫管理
- **產品追蹤**：產品人員與索引碼管理
- **數量控制**：多種數量統計與確認
- **日期管控**：收回與入庫日期分別管理

### 成本計算功能
- **FOB成本**：Free On Board 成本計算
- **FHI成本**：運費保險成本計算
- **DUTY成本**：關稅成本計算
- **總計成本**：各種成本總計統計

### 數量管理機制
- **總數量管理**：收回數量彙總計算
- **確認數量**：實際確認收回數量
- **內外銷分類**：內銷外銷數量分別統計
- **數量驗證**：收回數量與確認數量對照

### 收回流程控制
- **收回申請**：收回單建立
- **收回確認**：收回數量確認
- **收回入庫**：收回產品入庫作業
- **收回結帳**：財務結帳處理

### 財務整合功能
- **運費處理**：收回運費計算
- **稅務處理**：收回稅務計算
- **結帳整合**：與財務系統整合
- **成本重算**：結帳時成本重新計算

### 倉庫管理機制
- **出庫管理**：出貨倉庫指定
- **入庫管理**：入貨倉庫指定
- **倉庫轉移**：倉庫間轉移作業
- **庫存調整**：收回後庫存調整

### 產品管理功能
- **產品分類**：產品代碼分類管理
- **產品追蹤**：產品序號追蹤
- **產品責任**：產品負責人員管理
- **產品索引**：產品索引碼查詢

### 品質管控機制
- **收回原因追蹤**：收回原因分析
- **品質確認**：收回產品品質確認
- **處理追蹤**：收回後處理追蹤
- **改善建議**：品質改善建議

### 系統整合特性
- **庫存系統整合**：與庫存管理系統整合
- **財務系統整合**：與財務會計系統整合
- **生產系統整合**：與生產管理系統整合
- **品管系統整合**：與品質管理系統整合 