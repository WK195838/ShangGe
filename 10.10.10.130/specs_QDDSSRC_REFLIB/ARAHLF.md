# ARAHLF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | ARAHLF |
| 檔案類型 | 聯合邏輯檔案 (Union Logical File) |
| 檔案用途 | 折讓資料檔（銷退∣∣價差） |
| 基礎實體檔案 | ARAFPF, SOSGPF |
| 索引鍵 | AH02+AH05(DESCEND)+AH03+AH04 |
| 排序方式 | 混合排序（AH05降序，其他升序） |

## 2. 檔案功能說明

ARAHLF是一個聯合邏輯檔案，整合了兩個不同來源的折讓資料：

1. **價差折讓資料**：來自ARAFPF（價差折讓資料檔）
2. **銷貨退回資料**：來自SOSGPF（銷貨退回檔案）
3. 提供統一的折讓資料檢視，包含銷退和價差兩種類型
4. 支援按客戶代號和折讓金額（降序）進行排序查詢
5. 用於折讓資料的綜合分析與報表處理

## 3. 系統檔案清單

| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| ARAFPF | 實體檔案 | 價差折讓資料檔（第一個基礎檔案） |
| SOSGPF | 實體檔案 | 銷貨退回檔案（第二個基礎檔案） |
| ARAHLF | 聯合邏輯檔案 | 折讓資料檔聯合邏輯檔案 |

## 4. 紀錄格式

| 格式名稱 | 基礎實體檔案 | 說明 |
|----------|--------------|------|
| AF0 | ARAFPF | 價差折讓紀錄格式 |
| SG0 | SOSGPF | 銷貨退回紀錄格式 |

## 5. 欄位代號、名稱、位置、長度、屬性、檢核說明

### 統一欄位對照表

| 統一欄位 | 欄位名稱 | ARAFPF來源欄位 | SOSGPF來源欄位 | 屬性 | 說明 |
|----------|----------|----------------|----------------|------|------|
| AH01 | 公司代號 | AF01 | SG01 | 字元 | 公司代號 |
| AH02 | 客戶代號 | AF03 | SG04 | 字元 | 客戶代號 |
| AH03 | 產品代號 | AF04 | SG05 | 字元 | 產品代號 |
| AH04 | 序號 | AF02 | SG09 | 數值 | 序號 |
| AH05 | 折讓金額 | AF05 | SG26 | 數值 | 折讓金額 |
| AH06 | 折讓類別 | AF07 | SG10 | 字元 | 折讓類別代號 |
| AH07 | 退貨序號 | - | SG02 | 數值 | 退貨序號（僅SOSGPF） |
| AH08 | 退貨日期 | - | SG06 | 日期 | 退貨日期（僅SOSGPF） |

### 欄位重新命名說明

**AF0格式（價差折讓）：**
- AF01 → AH01（公司代號）
- AF03 → AH02（客戶代號）
- AF04 → AH03（產品代號）
- AF02 → AH04（序號）
- AF05 → AH05（折讓金額）
- AF07 → AH06（折讓類別）

**SG0格式（銷貨退回）：**
- SG01 → AH01（公司代號）
- SG04 → AH02（客戶代號）
- SG05 → AH03（產品代號）
- SG09 → AH04（序號）
- SG26 → AH05（折讓金額）
- SG10 → AH06（折讓類別）
- SG02 → AH07（退貨序號）
- SG06 → AH08（退貨日期）

## 6. 主鍵欄位

本聯合邏輯檔案的主要存取鍵值為：
- AH02（客戶代號）
- AH05（折讓金額）- 降序排列
- AH03（產品代號）
- AH04（序號）

## 7. 索引資料

| 索引名稱 | 索引鍵 | 排序 | 用途說明 |
|----------|--------|------|----------|
| 主索引 | AH02+AH05(DESC)+AH03+AH04 | 混合排序 | 客戶別折讓金額分析 |

### 索引特性：
- **AH02（客戶代號）**：第一層排序，按客戶分組
- **AH05（折讓金額）**：第二層排序，**降序排列**，優先顯示高金額折讓
- **AH03（產品代號）**：第三層排序，產品別細分
- **AH04（序號）**：第四層排序，確保記錄順序

### 聯合檔案特性：
- 整合兩種不同類型的折讓資料
- 提供統一的欄位名稱和排序方式
- 支援銷退和價差的綜合分析

## 8. 備註

1. **聯合邏輯檔案**：這是AS/400系統中的高級功能，能將多個實體檔案合併為單一檢視
2. **資料來源整合**：
   - ARAFPF：價差折讓資料
   - SOSGPF：銷貨退回資料
3. **欄位重新命名**：使用RENAME關鍵字將不同來源的欄位統一命名
4. **降序排序**：AH05（折讓金額）採用DESCEND關鍵字，優先顯示高金額項目
5. **業務應用**：適用於折讓資料的綜合分析、客戶折讓統計、高金額折讓監控等
6. **資料完整性**：SG0格式包含額外的退貨相關欄位（AH07, AH08）
7. **報表功能**：為折讓相關報表提供統一的資料來源 