# POPCPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | POPCPF |
| 檔案類型 | 實體檔案 (PF) |
| 檔案用途 | 採購明細檔 |
| 作業系統 | AS/400 |
| 建立日期 | - |
| 最後修改日期 | - |

## 2. 檔案功能說明

POPCPF 為採購明細檔實體檔案，儲存採購單的明細資料，包含產品代碼、採購數量、價格、進貨數量等詳細資訊。此檔案為採購管理系統的核心明細檔案，記錄每筆採購單中各項產品的詳細資訊，支援採購執行追蹤、進貨管理、結案控制等功能。

## 3. 系統檔案清單

- **實體檔案**: POPCPF (本檔案)
- **邏輯檔案**: POPCLF01, POPCLF02 等相關邏輯檔案
- **參照檔案**: RERF (欄位定義參照檔)

## 4. 記錄格式

### 記錄格式 PC0
- **記錄識別**: PC0
- **記錄類型**: 實體檔記錄格式
- **唯一鍵值**: PC02 + PC03 (採購單編號 + 產品代碼)

## 5. 欄位規格

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| PC01 | 序號 | 1 | - | R | 參照RERF | 明細序號 |
| PC02 | 採購單編號 | 2 | - | R | 參照RERF | 主要鍵值 |
| PC03 | 產品代碼 | 3 | - | R | 參照RERF | 主要鍵值 |
| PC04 | 採購日期 | 4 | 8 | R | 參照RERF | 日期格式，標記為B2CHKA |
| PC05 | 供應商代碼 | 5 | - | R | 參照RERF | 外部鍵值 |
| PC06 | 採購數量 | 6 | - | R | 參照RERF | 數值欄位 |
| PC07 | 單價 | 7 | - | R | 參照RERF | 金額欄位 |
| PC08 | 折扣 | 8 | - | R | 參照RERF | 百分比 |
| PC09 | 採購金額 | 9 | - | R | 參照RERF | 計算金額 |
| PC10 | 稅額 | 10 | - | R | 參照RERF | 稅金計算 |
| PC11 | 已進數量 | 11 | - | R | 參照RERF | 實際進貨數量 |
| PC12 | 結案記號 | 12 | - | R | 參照RERF | 狀態控制 |
| PC13 | 幣別 | 13 | - | R | 參照RERF | 貨幣代碼 |
| PCXX | 採購日期 | - | 8 | R | 參照RERF | 備用日期欄位，標記為B2CHKA |
| PCYY | 採購時間 | - | - | R | 參照RERF | 時間戳記 |
| PCZZ | 採購者 | - | - | R | 參照RERF | 採購人員代碼 |

## 6. 主鍵欄位

| 順序 | 欄位代號 | 欄位名稱 | 說明 |
|------|----------|----------|------|
| 1 | PC02 | 採購單編號 | 第一主鍵 |
| 2 | PC03 | 產品代碼 | 第二主鍵 |

## 7. 索引資料

### 存取路徑設定
- **排序方式**: 升序
- **重複鍵值**: 不允許
- **索引類型**: 唯一索引 (UNIQUE)

### 索引鍵值
- 主要索引: PC02 + PC03 (採購單編號 + 產品代碼)

### 檔案特性
- UNIQUE：保證主鍵唯一性
- REF(RERF)：欄位定義參照外部檔案

## 8. 備註

1. **檔案特性**: 
   - 實體檔案，為採購明細主檔
   - 採用 UNIQUE 約束保證主鍵唯一性
   - 參照 RERF 檔案進行欄位定義

2. **欄位特性**:
   - **結案記號 (PC12)**: 控制採購明細是否結案，空白表示未結案
   - **幣別 (PC13)**: 可能值為 'V' 或空白，影響計算邏輯
   - **已進數量 (PC11)**: 與採購數量 (PC06) 比較用於結案判斷

3. **業務應用場景**:
   - 採購明細資料維護
   - 進貨數量追蹤
   - 採購執行監控
   - 結案狀態管理
   - 供應商績效分析

4. **關聯檔案**:
   - POPBPF: 採購單主檔 (一對多關係)
   - 供應商主檔: 透過 PC05 關聯
   - 產品主檔: 透過 PC03 關聯

5. **使用注意事項**:
   - PC04 和 PCXX 都是日期欄位，可能有不同用途
   - B2CHKA 標記可能用於特殊檢核或處理
   - 結案控制依賴 PC12 欄位的狀態值
   - 數量和金額欄位需注意小數位精度
   - 幣別控制會影響相關計算邏輯 