# W2BAPF 檔案規格書

## 1. 基本資料
- **檔案名稱**: W2BAPF
- **檔案描述**: 後台銷售主檔
- **檔案類型**: 實體檔案 (PF)
- **記錄格式**: BA0
- **主鍵**: BA01 + BA02 + BA03 (UNIQUE約束)
- **用途**: 記錄後台銷售主要交易資料
- **相關系統**: 後台銷售管理系統

## 2. 檔案功能說明
W2BAPF檔案主要用於：
- 記錄後台銷售交易主檔資料
- 管理銷售編號、營業點與發貨號對應關係
- 追蹤銷售金額、狀態與會員資訊
- 維護VIP客戶聯絡資料

## 3. 系統檔案清單
### 主檔案
- W2BAPF: 後台銷售主檔

### 邏輯檔案
- W2BALF01: 後台銷售主檔邏輯檔01 (B類及空白狀態)
- W2BALF02: 後台銷售主檔邏輯檔02 (O類及P類狀態)
- W2BALF03: 後台銷售主檔邏輯檔03 (B類及O類狀態)
- W2BALF04: 後台銷售主檔邏輯檔04 (E類異常狀態)

## 4. 紀錄格式

### 記錄: BA0
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| BA01 | 銷售編號 | 1-8 | 8 | S 0 | 主鍵1 | 必填，不可重複 |
| BA02 | 營業點 | 9-13 | 5 | A | 主鍵2 | 必填，不可重複 |
| BA03 | 銷售發貨號 | 14-25 | 12 | A | 主鍵3 | 必填，不可重複 |
| BA04 | 總金額 | 26-36 | 11 | S 2 | - | 銷售總金額，支援小數2位 |
| BA05 | 狀態 | 37 | 1 | A | - | 銷售狀態(B/O/P/E/' ') |
| BA06 | 備註 | 38-39 | 2 | A | - | 銷售備註 |
| BA07 | 數量 | 40-167 | 128 | O | - | 包裝數量，OPEN型態 |
| BA08 | 配送日期 | 168-169 | 2 | A | - | 配送日期 |
| BA09 | 確認人員 | 170-179 | 10 | A | - | 確認人員代號 |
| BA10 | 會員碼 | 180 | 1 | A | - | 會員識別碼 |
| BA11 | VIP號-電話 | 181-195 | 15 | A | - | VIP客戶電話 |
| BA12 | VIP號-分機 | 196-200 | 5 | A | - | VIP客戶分機 |
| BAXX | 異動日期 | 201-208 | 8 | S 0 | - | YYYYMMDD格式 |
| BAYY | 異動時間 | 209-214 | 6 | S 0 | - | HHMMSS格式 |
| BAZZ | 異動人員 | 215-224 | 10 | A | - | 異動者代號 |

## 5. 主鍵欄位
- **主鍵組合**: BA01 + BA02 + BA03
- **唯一性約束**: UNIQUE
- **索引**: 三重複合索引 (銷售編號 + 營業點 + 銷售發貨號)

## 6. 索引資料
### 主要索引
- **索引1**: BA01 + BA02 + BA03 (主鍵，唯一性)

### 索引結構
```
KEY: BA01 (銷售編號) + BA02 (營業點) + BA03 (銷售發貨號)
```

## 7. 使用說明
### 新增作業
1. 指定銷售編號(BA01)
2. 設定營業點(BA02)
3. 輸入銷售發貨號(BA03)
4. 記錄銷售金額與狀態
5. 設定VIP客戶資訊(如適用)
6. 系統自動記錄異動資訊

### 查詢作業
1. 可依銷售編號查詢
2. 可依營業點分類查詢
3. 可依銷售發貨號查詢
4. 支援狀態別分類查詢
5. 可查詢VIP客戶銷售記錄

### 維護作業
1. 銷售編號+營業點+發貨號組合不可重複
2. 可修改狀態與金額資訊
3. 營業點代號須為有效代碼
4. 狀態值限定為：B/O/P/E/空白
5. 系統記錄完整異動軌跡

### 狀態管理
- **B**: 特定狀態/初始狀態
- **O**: 已處理狀態
- **P**: 部分處理狀態  
- **E**: 異常狀態
- **空白**: 未分類狀態

## 8. 備註
- 檔案具有UNIQUE約束，確保銷售記錄唯一性
- 支援四個邏輯檔案提供不同狀態視圖
- 總金額欄位支援小數2位，適用於精確金額計算
- 數量欄位為128位元OPEN型態，支援大容量包裝資料
- 整合VIP客戶管理功能，支援客戶關係管理 