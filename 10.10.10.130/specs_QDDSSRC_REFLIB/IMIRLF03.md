# IMIRLF03 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案代號 | IMIRLF03 |
| 檔案名稱 | 庫存異動明細檔 |
| 檔案類型 | LF (邏輯檔案) |
| 資料庫 | REFLIB |
| 記錄格式 | PE0, PG0, PG0#, PI0, SD0, SF0, SF0#, SH0, SO0, SO0#, IF0, IH0, IH0#, IJ0, IJ0#, IL0, IB0, IU0 |
| 基礎實體檔案 | POPEPF, POPGPF, POPIPF, SOSDPF, SOSFPF, SOSHPF, SOSOPF, IMIFPF, IMIHPF, IMIJPF, IMILPF, IMIBPF, IMIUPF |

## 2. 檔案功能說明

此大型聯結邏輯檔案整合多達13個實體檔案，提供完整的庫存異動資料統一存取介面。與IMIRLF01的主要差異在於排序方式：採用產品項次代號、月份、產品代號、日期降序、單據號碼的排序。這種排序方式特別適用於按照產品別進行庫存異動分析，在相同產品內按照最新日期優先顯示，便於產品別的庫存異動追蹤和分析。

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|----------|------|
| IMIRLF03 | 庫存異動明細檔 | LF | 邏輯檔案 |
| POPEPF | 進貨單據主檔 | PF | 基礎實體檔案1 |
| POPGPF | 進貨訂購主檔 | PF | 基礎實體檔案2 |
| POPIPF | 年內進貨主檔 | PF | 基礎實體檔案3 |
| SOSDPF | 託運單據檔 | PF | 基礎實體檔案4 |
| SOSFPF | 送貨單據檔 | PF | 基礎實體檔案5 |
| SOSHPF | 託貨退回檔 | PF | 基礎實體檔案6 |
| SOSOPF | 產品退貨檔 | PF | 基礎實體檔案7 |
| IMIFPF | 產品發料檔 | PF | 基礎實體檔案8 |
| IMIHPF | 調整單據檔 | PF | 基礎實體檔案9 |
| IMIJPF | 新品調整檔 | PF | 基礎實體檔案10 |
| IMILPF | 物料需求檔 | PF | 基礎實體檔案11 |
| IMIBPF | 產品庫存調整檔 | PF | 基礎實體檔案12 |
| IMIUPF | 其他檔案 | PF | 基礎實體檔案13 |

## 4. 紀錄格式

### 主要記錄格式（18種）
與IMIRLF相同，包含18種記錄格式，涵蓋所有庫存異動類型

### 排序方式（與IMIRLF01不同）
所有記錄格式採用相同的排序鍵值：
- **IR02**：產品項次代號（索引欄位1）
- **IR05**：月份（索引欄位2）
- **IR03**：產品代號（索引欄位3）
- **IR04**：日期（索引欄位4，降序排列）
- **IR06**：單據號碼（索引欄位5）

### 統一選擇條件
- **IR051 LT '0'**：月份第四碼小於'0'

## 5. 欄位代號、名稱、位置、長度、屬性、檢核說明

### 共通欄位 (所有記錄格式)
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|----------|----------|
| IR011 | 單據編號第一碼 | - | 1 | A | I | 單據編號第1碼，產品類別識別 |
| IR012 | 單據編號第二碼 | - | 1 | A | I | 單據編號第2碼 |
| IR02 | 產品項次代號 | - | - | - | R,K | 索引欄位1 |
| IR03 | 產品代號 | - | - | - | R,K | 索引欄位3 |
| IR04 | 日期 | - | - | - | R,K | 索引欄位4(降序) |
| IR05 | 月份 | - | 2 | A | I,K | 單據號碼第3-4碼，索引欄位2 |
| IR051 | 月份第四碼 | - | 1 | A | I,O | 單據號碼第4碼，選擇條件欄位 |
| IR06 | 單據號碼 | - | - | - | R,K | 索引欄位5 |
| IR071 | 數量1 | - | 6 | S | 0 | 第一種數量 |
| IR072 | 數量2 | - | 6 | S | 0 | 第二種數量（部分記錄格式） |
| IR101 | 金額1 | - | 11 | P | 2 | FOB/成本金額 |
| IR102 | 金額2 | - | 11 | P | 2 | FHI/運費金額 |
| IR103 | 金額3 | - | 11 | P | 2 | DUTY/其他金額 |
| IR121 | 確認數量1 | - | 6 | S | 0 | 第一種確認數量 |
| IR122 | 確認數量2 | - | 6 | S | 0 | 第二種確認數量（部分記錄格式） |

### 特殊欄位
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|----------|----------|
| IR11 | 相關項次代號 | - | - | - | R | 部分記錄格式的相關項次 |
| IR13 | 異動日期 | - | - | - | R | 部分記錄格式的異動日期 |

## 6. 主鍵欄位

| 主鍵順序 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | IR02 | 產品項次代號 | ASC |
| 2 | IR05 | 月份 | ASC |
| 3 | IR03 | 產品代號 | ASC |
| 4 | IR04 | 日期 | DESC |
| 5 | IR06 | 單據號碼 | ASC |

## 7. 索引資料

### 主要索引
- **索引鍵值**：IR02 + IR05 + IR03 + IR04(DESC) + IR06
- **索引類型**：複合索引
- **排序方式**：項次代號、月份、產品代號遞增，日期降序，單據號碼遞增
- **用途**：支援產品別的最新異動記錄優先查詢

### 選擇條件
- **條件**：IR051 LT '0' (月份第四碼小於'0')
- **說明**：限制特定時期的異動記錄

### 特殊選擇條件（部分記錄格式）
- **SD0記錄格式**：IR05 EQ 'S2' OR 'S3' (特定月份代號)
- **SF0記錄格式**：IR02 NE ' ' (項次代號不為空白)

## 8. 備註

1. 此檔案為大型聯結邏輯檔案，整合13個實體檔案
2. 與IMIRLF01的主要差異在於產品代號和日期的排序位置
3. 採用產品代號分組，日期降序排列
4. 適用於產品別的庫存異動分析
5. 在相同產品內按照最新日期優先顯示
6. 支援產品項次別和月份別的分組查詢
7. 提供完整的庫存異動資料統一存取介面
8. 便於產品別的庫存異動追蹤和分析
9. 具有統一的月份選擇條件限制
10. 提供完整的成本資訊（FOB、FHI、DUTY） 