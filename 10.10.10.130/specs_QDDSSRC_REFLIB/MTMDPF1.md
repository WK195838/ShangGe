# MTMDPF1 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | MTMDPF1 |
| 檔案描述 | 客戶分類資料檔 |
| 檔案類型 | PF (Physical File) |
| 記錄格式 | MD10 |
| 主鍵 | MD011 (客戶分類代號) |
| 檔案屬性 | UNIQUE |
| Reference檔案 | RERF |

## 2. 檔案功能說明

MTMDPF1 為客戶分類資料檔，用於管理客戶分類相關資訊，包括：
- 客戶分類定義
- 分類屬性設定
- 業務規則配置
- 分類統計資料

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 說明 |
|----------|----------|------|
| MTMDPF1 | 客戶分類資料檔 | 主檔 |
| MTMDPF | 客戶基本資料檔 | 關聯主檔 |
| RERF | 參考檔案 | 欄位定義參考 |

## 4. 紀錄格式

### 記錄格式：MD10

## 5. 欄位規格

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| MD011 | 客戶分類代號 | 1-5 | 5 | A | R | 主鍵，分類識別碼 |
| MD012 | 分類名稱 | 6-25 | 20 | A | R | 客戶分類名稱 |
| MD013 | 英文名稱 | 26-45 | 20 | A | R | 分類英文名稱 |
| MD014 | 分類說明 | 46-85 | 40 | A | R | 分類詳細說明 |
| MD015 | 上級分類 | 86-90 | 5 | A | R | 上級分類代號 |
| MD016 | 分類層級 | 91-92 | 2 | N | R | 分類層級 |
| MD017 | 排序序號 | 93-95 | 3 | N | R | 顯示排序 |
| MD018 | 使用狀態 | 96 | 1 | A | R | 'A'-有效，'I'-停用 |
| MD019 | 預設折扣 | 97-99 | 3 | N | R | 預設折扣率，百分比 |
| MD020 | 信用額度 | 100-110 | 11 | N | R | 預設信用額度 |
| MD021 | 收款條件 | 111-115 | 5 | A | R | 預設收款條件代號 |
| MD1XX | 建立日期 | 116-123 | 8 | N | R | 格式：YYYYMMDD |
| MD1YY | 建立時間 | 124-129 | 6 | N | R | 格式：HHMMSS |
| MD1ZZ | 建立者 | 130-139 | 10 | A | R | 操作人員 |

## 6. 主鍵欄位

| 鍵值序號 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | MD011 | 客戶分類代號 | 升序 |

## 7. 索引資料

### 主要索引
- **索引名稱**：主鍵索引
- **索引欄位**：MD011
- **索引類型**：UNIQUE
- **說明**：確保分類代號唯一性

### 輔助索引
1. **層級索引**：MD015 + MD016 (上級分類 + 層級)
2. **排序索引**：MD017 (排序序號)
3. **狀態索引**：MD018 (使用狀態)

### 階層結構索引
- **父子關聯**：MD015 (上級分類)
- **層級控制**：MD016 (分類層級)

## 8. 備註

### 設計考量
1. 支援階層式客戶分類結構
2. 提供分類預設業務參數
3. 靈活的分類管理機制

### 階層結構
- **第1層**：大分類 (MD016=1)
- **第2層**：中分類 (MD016=2)  
- **第3層**：小分類 (MD016=3)
- **關聯方式**：透過 MD015 建立父子關係

### 參考關聯
- **客戶檔案**：MTMDPF (客戶所屬分類)
- **上級分類**：MTMDPF1 (MD015 = MD011)
- **參考檔案**：RERF (欄位定義)

### 業務規則
1. 分類代號必須唯一
2. 上級分類必須存在且層級小於當前層級
3. 有下級分類的節點不可刪除
4. 停用分類不影響既有客戶資料

### 資料完整性
1. MD015 (上級分類) 需對應有效的分類代號
2. MD016 (層級) 需與階層結構一致
3. 預設參數需符合業務規則範圍
4. 循環引用檢核

### 維護注意事項
1. 分類結構異動影響客戶歸屬
2. 預設參數變更影響新客戶設定
3. 分類停用需確認無客戶使用
4. 階層調整需考慮完整性 