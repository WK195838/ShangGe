# SOSGLF3 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSGLF3
- **檔案類型**: LF (聯結邏輯檔案)
- **基底檔案**: SOSGPF (銷貨退回主檔), SOSHPF (銷貨退回明細檔), MTMAPF (產品主檔)
- **檔案說明**: 銷退資料檔聯結檔 - REWF08 程式專用三檔聯結
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此聯結邏輯檔案將銷貨退回主檔 (SOSGPF)、銷貨退回明細檔 (SOSHPF) 與產品主檔 (MTMAPF) 進行聯結，專門為 REWF08 程式提供完整的銷退資料查詢，支援動態選擇。

### 主要功能
- REWF08 程式專用銷退資料查詢
- 三檔聯結資料整合
- 動態選擇資料篩選

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSGPF | PF | 銷貨退回主檔 (主要檔案) |
| SOSHPF | PF | 銷貨退回明細檔 (次要檔案) |
| MTMAPF | PF | 產品主檔 (次要檔案) |
| SOSGLF3 | LF | 銷退資料聯結邏輯檔案 |

## 4. 紀錄格式

### 4.1 聯結檔案設定
```
JFILE(SOSGPF SOSHPF MTMAPF)    // 三檔聯結
JOIN(SG02 SH02)                // 第一聯結：退貨單號
JOIN(SH03 MA01)                // 第二聯結：產品編號
DYNSLT                          // 動態選擇
```

### 4.2 關鍵欄位 (Key Fields)
無特定排序（動態選擇）

### 4.3 選擇條件 (SELECT/OMIT)
| 條件類型 | 欄位代號 | 條件 | 值 | 說明 |
|----------|----------|------|----|----|
| SELECT | SG17 | EQ | ' ' | 選擇相對退貨單號為空白 |
| OMIT | SG01A | EQ | 'K' | 排除客戶編號第一碼為 'K' |

### 4.4 欄位代號、名稱、位置、長度、屬性、檢核說明

#### 銷貨退回主檔欄位 (來自 SOSGPF)
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|----------|
| SG01 | 客戶編號 | A | 10 | - | 客戶基本資料 |
| SG01A | 客戶編號第一碼 | A | 1 | COMP | SST(SG01 1 1) |
| SG02 | 退貨單號 | A | 10 | Join | 聯結關鍵欄位 |
| SG03 | 部門 | A | 5 | - | 業務部門 |
| SG04 | 店代名稱 | A | 20 | - | 店代資訊 |
| SG17 | 相對退貨單號 | A | 10 | Select | 篩選條件欄位 |
| SG26 | 確認日期 | N | 8,0 | - | 確認日期 |

#### 銷貨退回明細檔欄位 (來自 SOSHPF)
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|----------|
| SH02 | 退貨單號 | A | 10 | Join | 聯結關鍵欄位 |
| SH03 | 產品編號 | A | 15 | Join | 聯結關鍵欄位 |
| SH04 | 退貨數量 | P | 15,3 | - | 退貨數量 |
| SH05 | 退貨單價 | P | 15,2 | - | 退貨單價 |
| SH06 | 退貨金額 | P | 15,2 | - | 退貨金額 |
| SH11 | 產品類型編號 | A | 5 | - | 產品分類 |
| SH12 | 批號 | A | 10 | - | 批號資訊 |
| SH13 | 有效日期 | N | 8,0 | - | 有效日期 |

#### 產品主檔欄位 (來自 MTMAPF)
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|----------|
| MA01 | 產品編號 | A | 15 | Join | 聯結關鍵欄位 |
| MA07 | 產品名稱 | A | 40 | - | 產品名稱 |
| MA11 | 規格 | A | 30 | - | 產品規格 |
| MA15 | 單位 | A | 5 | - | 計量單位 |
| MA54 | 產品分類 | A | 10 | - | 產品分類 |

## 5. 主鍵欄位
- **主要鍵值**: 無固定鍵值（動態選擇）
- **排序方式**: 依程式需求動態處理
- **索引類型**: 三檔聯結，REWF08 專用

## 6. 索引資料
- **排序方式**: 無特定排序（動態選擇）
- **索引類型**: 聯結檔案，REWF08 專用
- **特殊屬性**: 動態選擇，三檔聯結

## 7. 使用說明

### 7.1 檔案用途
- REWF08 程式專用銷退資料查詢
- 完整的銷退主檔、明細檔與產品檔聯結資訊
- 銷退資料整合分析

### 7.2 程式存取方式
```rpg
// REWF08 程式專用存取
// 動態選擇讀取
READ SOSGLF3;
// 依條件篩選讀取
READC SOSGLF3;
```

### 7.3 計算欄位說明
**SG01A (客戶編號第一碼)**: SST(SG01 1 1) - 提取客戶編號第一個字元

### 7.4 選擇邏輯說明
- **僅顯示相對退貨單號為空白的記錄** (SG17 = ' ')
- **排除特定客戶類型** (SG01A ≠ 'K')

## 8. 備註
- 此聯結檔案專門服務 REWF08 程式需求
- 提供完整的銷退資料整合查詢功能
- 支援複雜的銷退業務分析需求
- 使用動態選擇功能提升查詢效率 