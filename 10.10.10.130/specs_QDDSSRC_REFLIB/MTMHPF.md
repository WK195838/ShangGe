# MTMHPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | MTMHPF |
| 檔案描述 | 產品基本資料檔 KN |
| 檔案類型 | PF (Physical File) |
| 記錄格式 | MH0 |
| 主鍵 | MH01 (產品代號) |
| 檔案屬性 | 實體檔案，KN版本產品主檔 |

## 2. 檔案功能說明

MTMHPF 為 KN 版本產品基本資料的實體檔案，提供：
- KN 版本產品完整資料儲存
- 產品基本資訊管理
- 版本對照資料管理
- KN 特殊屬性處理

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 說明 |
|----------|----------|------|
| MTMHPF | 產品基本資料實體檔 KN | 主檔 |
| MTMHLF | 產品基本資料邏輯檔 KN | 基本邏輯檔 |
| MTMHLF1 | 產品基本資料邏輯檔 KN 1 | 標準檢視 |
| MTMHLF2 | 產品基本資料邏輯檔 KN 2 | 條碼排序 |
| MTMHLF01 | 產品基本資料邏輯檔 KN | 品牌分類排序 |
| MTMHLF02 | 產品基本資料邏輯檔 KN | 成本排序 |
| MTMHLF03 | 產品基本資料邏輯檔 KN | 條件篩選 |
| MTMHLF04 | 產品基本資料邏輯檔 KN | 計算條件篩選 |
| RERF | 參考檔案 | 欄位定義參考 |

## 4. 紀錄格式

### 記錄格式：MH0

## 5. 欄位規格

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| MH01 | 產品代號 | 1-13 | 13 | A | R | 主鍵，產品識別碼 |
| MH02 | 產品名稱 | 14-53 | 40 | A | R | 產品中文名稱 |
| MH03 | 英文名稱 | 54-93 | 40 | A | R | 產品英文名稱 |
| MH04 | 產品簡稱 | 94-113 | 20 | A | R | 產品簡稱 |
| MH05 | 產品狀態 | 114 | 1 | A | R | 'A'-正常，'D'-停產，'N'-新品 |
| MH06 | 品牌代號 | 115-119 | 5 | A | R | 品牌識別碼 |
| MH07 | 分類代號 | 120-124 | 5 | A | R | 產品分類 |
| MH08 | 規格說明 | 125-164 | 40 | A | R | 產品規格描述 |
| MH09 | 單位 | 165-169 | 5 | A | R | 基本單位 |
| MH10 | 標準成本 | 170-184 | 15 | N | R | 標準成本 (11位整數，4位小數) |
| MH11 | 售價 | 185-199 | 15 | N | R | 建議售價 (13位整數，2位小數) |
| MH12 | 最低售價 | 200-214 | 15 | N | R | 最低售價 (13位整數，2位小數) |
| MH13 | 重量 | 215-229 | 15 | N | R | 產品重量 (12位整數，3位小數) |
| MH14 | 體積 | 230-244 | 15 | N | R | 產品體積 (12位整數，3位小數) |
| MH15 | 保存期限 | 245-247 | 3 | N | R | 保存期限 (天) |
| MH16 | 供應商 | 248-254 | 7 | A | R | 主要供應商代號 |
| MH17 | 採購員 | 255-259 | 5 | A | R | 負責採購員代號 |
| MH18 | 安全庫存 | 260-274 | 15 | N | R | 安全庫存量 (13位整數，2位小數) |
| MH19 | 最高庫存 | 275-289 | 15 | N | R | 最高庫存量 (13位整數，2位小數) |
| MH20 | 最低庫存 | 290-304 | 15 | N | R | 最低庫存量 (13位整數，2位小數) |
| MH21 | 訂購批量 | 305-319 | 15 | N | R | 經濟訂購批量 (13位整數，2位小數) |
| MH22 | 條碼 | 320-332 | 13 | A | R | 產品條碼 |
| MH23 | 稅率 | 333-347 | 15 | N | R | 適用稅率 (10位整數，5位小數) |
| MH24 | 版本標記 | 348-352 | 5 | A | R | 固定值：'KN' |
| MH25 | KN特殊碼 | 353-357 | 5 | A | R | KN版本特殊代碼 |
| MH26 | 對應標準碼 | 358-370 | 13 | A | R | 對應標準版產品代號 |
| MH27 | 轉換比率 | 371-385 | 15 | N | R | 與標準版轉換比率 (10位整數，5位小數) |
| MH28 | 庫存單位 | 386-390 | 5 | A | R | 庫存管理單位 |
| MH29 | 採購單位 | 391-395 | 5 | A | R | 採購管理單位 |
| MH30 | 銷售單位 | 396-400 | 5 | A | R | 銷售管理單位 |
| MH31 | 生產單位 | 401-405 | 5 | A | R | 生產管理單位 |
| MH32 | ABC分類 | 406-407 | 2 | A | R | 'AA','AB','BA','BB','CA','CB' |
| MH33 | 產品系列 | 408-412 | 5 | A | R | 產品系列代號 |
| MH34 | 產品群組 | 413-417 | 5 | A | R | 產品群組代號 |
| MH35 | 原料代號 | 418-430 | 13 | A | R | 主要原料代號 |
| MH36 | 製造商 | 431-437 | 7 | A | R | 製造商代號 |
| MH37 | 產地 | 438-442 | 5 | A | R | 產地代號 |
| MH38 | 檢驗標準 | 443-447 | 5 | A | R | 品質檢驗標準 |
| MH39 | 包裝單位 | 448-452 | 5 | A | R | 包裝單位 |
| MH40 | 包裝數量 | 453-467 | 15 | N | R | 每包裝數量 (13位整數，2位小數) |
| MH41 | 停用日期 | 468-475 | 8 | N | R | 產品停用日期 YYYYMMDD |
| MH42 | 建檔日期 | 476-483 | 8 | N | R | 建檔日期 YYYYMMDD |
| MH43 | 異動日期 | 484-491 | 8 | N | R | 最後異動日期 YYYYMMDD |
| MH44 | 異動時間 | 492-497 | 6 | N | R | 最後異動時間 HHMMSS |
| MH45 | 異動人員 | 498-507 | 10 | A | R | 最後異動人員 |
| MH46 | 版本號 | 508-512 | 5 | N | R | 資料版本號 |
| MH47 | 同步狀態 | 513 | 1 | A | R | 'Y'-已同步，'N'-未同步 |
| MH48 | 特殊屬性1 | 514-528 | 15 | A | R | KN特殊屬性1 |
| MH49 | 特殊屬性2 | 529-543 | 15 | A | R | KN特殊屬性2 |
| MH50 | 備用欄位 | 544-558 | 15 | A | R | 備用欄位 |

## 6. 主鍵欄位

| 鍵值序號 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | MH01 | 產品代號 | 升序 |

## 7. 索引資料

### 主要索引
- **索引名稱**：主鍵索引
- **索引欄位**：MH01
- **索引類型**：PRIMARY
- **說明**：產品代號升序排序

### 輔助索引
1. **條碼索引**：MH22 + MH01 (條碼 + 產品代號)
2. **品牌分類索引**：MH06 + MH07 + MH01 (品牌 + 分類 + 產品)
3. **供應商索引**：MH16 + MH01 (供應商 + 產品代號)
4. **採購員索引**：MH17 + MH01 (採購員 + 產品代號)
5. **產品狀態索引**：MH05 + MH01 (產品狀態 + 產品代號)
6. **KN特殊索引**：MH25 + MH01 (KN特殊碼 + 產品代號)
7. **標準對應索引**：MH26 + MH01 (對應標準碼 + 產品代號)
8. **成本排序索引**：MH10 + MH01 (標準成本 + 產品代號)
9. **售價排序索引**：MH11 + MH01 (售價 + 產品代號)
10. **產品系列索引**：MH33 + MH01 (產品系列 + 產品代號)
11. **產品群組索引**：MH34 + MH01 (產品群組 + 產品代號)
12. **ABC分類索引**：MH32 + MH01 (ABC分類 + 產品代號)
13. **製造商索引**：MH36 + MH01 (製造商 + 產品代號)
14. **產地索引**：MH37 + MH01 (產地 + 產品代號)
15. **異動日期索引**：MH43 + MH44 + MH01 (異動日期 + 時間 + 產品)

## 8. 備註

### 設計考量
1. 此檔案為 KN 版本產品的主要實體檔案
2. 與標準版產品檔案 (MTMAPF) 結構相似但有 KN 特殊欄位
3. 提供完整的產品資料儲存和管理功能

### KN 版本特色
- **版本標記**：MH24 固定為 'KN'
- **特殊代碼**：MH25 KN特殊代碼
- **對應機制**：MH26 對應標準版產品
- **轉換比率**：MH27 版本間轉換比率
- **特殊屬性**：MH48、MH49 KN特殊屬性

### 產品資料管理
- **基本資訊**：完整的產品基本資料
- **價格管理**：標準成本、售價、最低售價
- **庫存管理**：安全庫存、最高最低庫存、訂購批量
- **供應商管理**：供應商、製造商、採購員
- **品質管理**：檢驗標準、ABC分類
- **單位管理**：庫存、採購、銷售、生產、包裝單位

### 特殊功能
- **版本對照**：與標準版產品建立對照關係
- **轉換功能**：提供版本間數量轉換
- **同步控制**：資料同步狀態管理
- **版本控制**：資料版本號管理

### 資料完整性控制
1. **主鍵唯一性**：MH01 產品代號唯一
2. **版本標記**：MH24 必須為 'KN'
3. **狀態控制**：MH05 產品狀態有效性
4. **關聯檢查**：供應商、採購員等關聯資料有效性
5. **數值合理性**：價格、重量、體積等數值合理性

### 業務規則
1. 產品代號必須唯一且不可為空
2. 版本標記固定為 'KN'
3. 對應標準碼必須存在於標準版中
4. 轉換比率必須大於 0
5. 價格欄位不可為負值
6. 庫存欄位不可為負值

### 關聯檔案
- **品牌檔案**：PA#ALF1 (MH06 = #A01)
- **分類檔案**：PA#分類檔 (MH07 = 分類代號)
- **供應商檔案**：MTMBPF (MH16 = MB01)
- **採購員檔案**：MTMCPF (MH17 = MC01)
- **製造商檔案**：MTMBPF (MH36 = MB01)
- **標準版檔案**：MTMAPF (MH26 = MA01)

### 使用場景
1. **產品建立**：新產品建立和維護
2. **價格管理**：產品價格設定和調整
3. **庫存控制**：庫存水準設定和監控
4. **供應商管理**：供應商關係管理
5. **品質管控**：產品品質標準管理
6. **報表查詢**：各種產品資訊報表

### 維護作業
- **新增作業**：新產品建立
- **修改作業**：產品資料維護
- **刪除作業**：產品資料刪除 (需檢查關聯)
- **批次作業**：大量資料更新
- **同步作業**：與標準版同步

### 效能考量
1. **索引最佳化**：多個輔助索引提升查詢效能
2. **分割策略**：可考慮按品牌或分類分割
3. **統計資訊**：定期更新統計資訊
4. **存取路徑**：最佳化常用查詢路徑

### 安全控制
- **存取權限**：依角色控制存取權限
- **異動記錄**：完整的異動歷程記錄
- **版本控制**：資料版本管理
- **同步狀態**：確保資料一致性

### 資料品質
1. **必填檢查**：關鍵欄位不可為空
2. **格式檢查**：日期、時間格式正確性
3. **範圍檢查**：數值欄位合理範圍
4. **關聯檢查**：外鍵關聯有效性
5. **邏輯檢查**：業務邏輯一致性

### 使用注意事項
1. 此為實體檔案，可直接進行 CRUD 操作
2. 異動時需更新 MH43、MH44、MH45 等異動資訊
3. 版本標記 MH24 不可異動
4. 刪除前需檢查相關邏輯檔案的使用狀況
5. 重要異動建議先備份 