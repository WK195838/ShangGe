# IMIBPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | IMIBPF |
| 檔案類型 | 實體檔案 (Physical File) |
| 檔案用途 | 產品成本調整資料檔 |
| 紀錄格式 | IB0 |
| 參考檔案 | RERF |
| 主鍵欄位 | IB01+IB02+IB03+IB04+IBYY |
| 檔案屬性 | UNIQUE |
| 特殊用途 | 產品成本調整主檔，支援多種邏輯檔案存取 |

## 2. 檔案功能說明

IMIBPF是產品成本調整資料檔的實體檔案，為系統中所有成本調整邏輯檔案的基礎：

1. **主要功能**：儲存產品成本調整的完整資料
2. **檔案特性**：具有UNIQUE屬性，確保記錄唯一性
3. **系統用途**：作為所有IMIBLF系列邏輯檔案的基礎實體檔案
4. **參考檔案**：使用REF(RERF)定義欄位屬性
5. **資料內容**：包含調整前後的成本資料、數量、日期時間等完整資訊
6. **支援功能**：為庫存異動明細檔（IMIRLF）提供資料保留功能

## 3. 系統檔案清單

| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| IMIBPF | 實體檔案 | 產品成本調整資料檔實體檔案（本檔案） |
| IMIBLF | 邏輯檔案 | 產品成本調整資料檔邏輯檔案（標準排序） |
| IMIBLF01 | 邏輯檔案 | 產品成本調整資料檔邏輯檔案（時間序列排序） |
| IMIBLF02 | 邏輯檔案 | 產品成本調整資料檔邏輯檔案（客戶產品排序） |
| IMIBLF03 | 邏輯檔案 | 產品成本調整資料檔邏輯檔案（日期客戶排序） |
| IMIBLF1 | 邏輯檔案 | 產品成本調整資料檔邏輯檔案（特定客戶範圍） |
| RERF | 參考檔案 | 欄位定義參考檔案 |

## 4. 紀錄格式

| 格式名稱 | 說明 |
|----------|------|
| IB0 | 產品成本調整主記錄格式 |

## 5. 欄位代號、名稱、位置、長度、屬性、檢核說明

本實體檔案使用REF(RERF)參考檔案定義欄位屬性：

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|----------|------|------|------|------|------|
| IB01 | 調整單號 | 1 | - | - | 主鍵 | 成本調整單號 |
| IB02 | 客戶代號 | 2 | - | - | 主鍵 | 客戶代號 |
| IB03 | 產品代號 | 3 | - | - | 主鍵 | 產品代號 |
| IB04 | 調整日期 | 4 | 8 | 數值 | 主鍵 | 調整日期（YYYYMMDD） |
| IB05 | BEF-FOB-TOT | 5 | - | - | - | 調整前FOB總額 |
| IB06 | BEF-FHI-TOT | 6 | - | - | - | 調整前FHI總額 |
| IB07 | BEF-DUTY-TOT | 7 | - | - | - | 調整前關稅總額 |
| IB08 | 產品庫存數量 | 8 | - | - | - | 產品庫存數量 |
| IB09 | 總計成本 | 9 | - | - | - | 總計成本 |
| IB10 | ADJ-FOB-TOT | 10 | - | - | - | 調整後FOB總額 |
| IB11 | ADJ-FHI-TOT | 11 | - | - | - | 調整後FHI總額 |
| IB12 | ADJ-DUTY-TOT | 12 | - | - | - | 調整後關稅總額 |
| IB13 | 調整庫存數量 | 13 | - | - | - | 調整庫存數量 |
| IB14 | 總計成本 | 14 | - | - | - | 調整後總計成本 |
| IB15 | 數量 | 15 | - | - | - | 調整數量 |
| IB16 | 保留欄位 | 16 | - | - | - | 保留欄位（FOR IMIRLF） |
| IB17 | 調整原因 | 17 | - | - | - | 調整原因代碼 |
| IB18 | 確認標記 | 18 | - | - | - | 確認標記 |
| IB19 | BEF-FOB-UNIT | 19 | - | - | - | 調整前FOB單價 |
| IB20 | BEF-FHI-UNIT | 20 | - | - | - | 調整前FHI單價 |
| IB21 | BEF-DUTY-UNIT | 21 | - | - | - | 調整前關稅單價 |
| IB22 | 保管庫存數量 | 22 | - | - | - | 保管庫存數量 |
| IB23 | 託管庫存數量 | 23 | - | - | - | 託管庫存數量 |
| IB24 | AFT-FOB-UNIT | 24 | - | - | - | 調整後FOB單價 |
| IB25 | AFT-FHI-UNIT | 25 | - | - | - | 調整後FHI單價 |
| IB26 | AFT-DUTY-UNIT | 26 | - | - | - | 調整後關稅單價 |
| IBXX | 異動日期 | 27 | 8 | 數值 | - | 異動日期（YYYYMMDD） |
| IBYY | 異動時間 | 28 | - | - | 主鍵 | 異動時間 |
| IBZZ | 異動人員 | 29 | - | - | - | 異動人員代碼 |

*註：詳細欄位長度和型態定義請參考參考檔案RERF*

## 6. 主鍵欄位

本實體檔案的主鍵欄位為：
- IB01（調整單號）
- IB02（客戶代號）
- IB03（產品代號）
- IB04（調整日期）
- IBYY（異動時間）

### 主鍵特性：
- **IB01（調整單號）**：第一層分類，調整單號
- **IB02（客戶代號）**：第二層分類，客戶代號
- **IB03（產品代號）**：第三層分類，產品代號
- **IB04（調整日期）**：第四層分類，調整日期
- **IBYY（異動時間）**：第五層分類，異動時間（確保唯一性）

## 7. 索引資料

| 索引名稱 | 索引鍵 | 排序 | 用途說明 |
|----------|--------|------|----------|
| 主索引 | IB01+IB02+IB03+IB04+IBYY | 升序 | 主要存取路徑 |

### 索引特性：
- **複合索引**：五個欄位組成的複合主鍵
- **UNIQUE屬性**：確保記錄唯一性
- **完整排序**：單號→客戶→產品→日期→時間

## 8. 備註

1. **實體檔案特性**：
   - 具有UNIQUE屬性，確保記錄唯一性
   - 使用REF(RERF)參考檔案定義欄位屬性
   - 作為所有IMIBLF系列邏輯檔案的基礎
2. **成本調整功能**：
   - 記錄調整前後的完整成本資料
   - 包含FOB、FHI、關稅等多種成本項目
   - 支援總額和單價的調整記錄
3. **資料結構設計**：
   - 五層主鍵設計確保記錄唯一性
   - 包含29個欄位，涵蓋完整的成本調整資訊
   - 支援調整前後的對比分析
4. **成本項目分類**：
   - **調整前成本**：IB05-IB09（FOB、FHI、關稅總額、庫存數量、總計成本）
   - **調整後成本**：IB10-IB14（FOB、FHI、關稅總額、庫存數量、總計成本）
   - **單價資料**：IB19-IB26（調整前後的FOB、FHI、關稅單價）
5. **庫存管理整合**：
   - IB16保留欄位專為IMIRLF（庫存異動明細檔）使用
   - 支援保管庫存和託管庫存的分別記錄
   - 與庫存系統緊密整合
6. **異動追蹤功能**：
   - IBXX：異動日期記錄
   - IBYY：異動時間（主鍵之一）
   - IBZZ：異動人員代碼
7. **邏輯檔案支援**：
   - IMIBLF：標準排序存取
   - IMIBLF01：時間序列排序存取
   - IMIBLF02：客戶產品排序存取
   - IMIBLF03：日期客戶排序存取
   - IMIBLF1：特定客戶範圍存取
8. **資料完整性**：
   - UNIQUE屬性確保記錄不重複
   - 五層主鍵提供完整的資料識別
   - 參考檔案確保欄位定義一致性
9. **業務應用**：
   - 產品成本調整作業
   - 成本變動歷史追蹤
   - 調整前後成本對比分析
   - 庫存成本管理
10. **系統整合**：
    - 與庫存管理系統（IMI系列）整合
    - 支援庫存異動明細檔（IMIRLF）
    - 提供完整的成本調整資料基礎
11. **檔案維護**：
    - 作為實體檔案，需要定期維護
    - 資料變更會影響所有相關邏輯檔案
    - 需要考慮備份和復原策略
12. **效能考量**：
    - 五層主鍵提供高效的資料存取
    - UNIQUE索引確保查詢效能
    - 支援多種邏輯檔案的不同存取模式
13. **成本管理功能**：
    - FOB（Free On Board）成本管理
    - FHI（Freight, Handling, Insurance）成本管理
    - 關稅（DUTY）成本管理
    - 總額和單價的雙重管理
14. **調整作業支援**：
    - 調整原因記錄（IB17）
    - 確認標記功能（IB18）
    - 調整數量記錄（IB15）
    - 完整的調整流程支援
15. **時間維度管理**：
    - 調整日期（IB04）：業務日期
    - 異動日期（IBXX）：系統處理日期
    - 異動時間（IBYY）：精確時間戳記
16. **數量管理**：
    - 產品庫存數量（IB08）
    - 調整庫存數量（IB13）
    - 保管庫存數量（IB22）
    - 託管庫存數量（IB23）
    - 調整數量（IB15）
17. **資料保留機制**：
    - IB16欄位專為IMIRLF保留
    - 支援庫存異動明細的資料關聯
    - 確保資料追蹤的完整性
18. **成本計算支援**：
    - 調整前後總額對比
    - 調整前後單價對比
    - 支援多種成本要素的獨立調整
19. **系統價值**：
    - 作為成本調整系統的核心檔案
    - 提供完整的成本調整資料基礎
    - 支援多維度的成本分析需求
20. **特殊設計**：
    - 五層主鍵設計在AS/400系統中較為罕見
    - 體現了複雜的業務需求
    - 確保在多維度條件下的記錄唯一性
</rewritten_file>