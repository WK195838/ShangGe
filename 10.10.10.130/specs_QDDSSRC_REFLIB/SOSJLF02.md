# SOSJLF02 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSJLF02
- **檔案類型**: LF (邏輯檔案)
- **基底檔案**: SOSJPF (發票明細檔)
- **檔案說明**: 發票明細檔邏輯檔案 - 轄區產品時序查詢
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此邏輯檔案提供客戶編號、轄區編號、產品編號、發票日期降序、發票號碼降序的複合排序，適用於轄區產品銷售的時序分析與統計。

### 主要功能
- 轄區產品銷售查詢
- 客戶產品購買時序分析
- 雙重時序排序 (日期+發票號碼)
- 產品銷售統計支援

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSJPF | PF | 發票明細檔 (基底檔案) |
| SOSJLF02 | LF | 發票明細檔邏輯檔案 |

## 4. 紀錄格式

### 4.1 邏輯檔案設定
```
PFILE(SOSJPF)      // 基底實體檔案
```

### 4.2 關鍵欄位 (Key Fields)
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SJ01 | 客戶編號 | A | 10 | ASC | 主要排序鍵 |
| 2 | SJ11 | 轄區編號 | A | 5 | ASC | 次要排序鍵 |
| 3 | SJ03 | 產品編號 | A | 15 | ASC | 第三排序鍵 |
| 4 | SJ16 | 發票日期 | N | 8,0 | DESC | 第四排序鍵 (降序) |
| 5 | SJ02 | 發票號碼 | A | 10 | DESC | 第五排序鍵 (降序) |

### 4.3 選擇條件 (SELECT/OMIT)
無特殊選擇條件設定

### 4.4 雙重降序設計
此檔案採用雙重降序設計：
- **SJ16 (發票日期)**: 降序排列，最新日期優先
- **SJ02 (發票號碼)**: 降序排列，最新發票優先

## 5. 主鍵欄位
- **主要鍵值**: SJ01 + SJ11 + SJ03 + SJ16 + SJ02
- **排序方式**: 客戶、轄區、產品升序，日期、發票號碼降序
- **索引類型**: 複合索引，五層排序

## 6. 索引資料
- **排序方式**: SJ01 + SJ11 + SJ03 + SJ16(DESC) + SJ02(DESC)
- **索引類型**: 復合索引，支援轄區產品時序查詢
- **特殊屬性**: 雙重降序，最新交易優先

## 7. 使用說明

### 7.1 檔案用途
- 客戶轄區產品銷售查詢
- 產品銷售時序分析
- 最新交易記錄優先檢視
- 轄區產品統計報表

### 7.2 程式存取方式
```rpg
// 依客戶查詢轄區產品銷售
SETLL (客戶編號) SOSJLF02;
READ SOSJLF02;
// 依客戶轄區查詢產品銷售
CHAIN (客戶編號:轄區編號) SOSJLF02;
// 依客戶轄區產品查詢最新交易
CHAIN (客戶編號:轄區編號:產品編號) SOSJLF02;
```

### 7.3 查詢層級優勢
- **客戶層級**: 查詢客戶所有轄區產品銷售
- **轄區層級**: 查詢特定轄區產品銷售
- **產品層級**: 查詢特定產品銷售明細
- **時序層級**: 雙重降序確保最新交易優先

### 7.4 時序分析特色
- **最新優先**: 雙重降序設計
- **精確排序**: 日期+發票號碼雙重保證
- **統計支援**: 便於時序統計與趨勢分析

### 7.5 業務應用場景
- **客戶分析**: 客戶在不同轄區的購買行為
- **轄區統計**: 轄區內產品銷售績效
- **產品分析**: 產品在不同轄區的銷售表現
- **時序追蹤**: 產品銷售時間軌跡分析

## 8. 備註
- 此邏輯檔案專為轄區產品時序分析設計
- 提供客戶-轄區-產品三層分類結構
- 採用雙重降序設計，確保最新交易優先顯示
- 適用於產品銷售統計與客戶購買行為分析 