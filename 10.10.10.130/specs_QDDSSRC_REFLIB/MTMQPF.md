# MTMQPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | MTMQPF |
| 檔案描述 | 產品基本資料檔 --> 有問題的產品 KN |
| 檔案類型 | PF (Physical File) |
| 記錄格式 | MQ0 |
| 主鍵 | MQ01 (產品代號) |
| 檔案屬性 | 實體檔案，問題產品管理檔 |

## 2. 檔案功能說明

MTMQPF 為 KN 版本問題產品管理的實體檔案，提供：
- 問題產品資料記錄
- 品質異常產品追蹤
- 問題產品處理狀況
- 品質管控記錄

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 說明 |
|----------|----------|------|
| MTMQPF | 問題產品管理實體檔 KN | 主檔 |
| MTMHPF | 產品基本資料實體檔 KN | 關聯檔案 |
| MTMAPF | 產品基本資料實體檔 | 標準版關聯檔 |
| RERF | 參考檔案 | 欄位定義參考 |

## 4. 紀錄格式

### 記錄格式：MQ0

## 5. 欄位規格

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| MQ01 | 產品代號 | 1-13 | 13 | A | R | 主鍵，關聯MTMHPF.MH01 |
| MQ02 | 問題序號 | 14-16 | 3 | N | R | 問題記錄序號 |
| MQ03 | 問題類型 | 17-21 | 5 | A | R | 問題分類代號 |
| MQ04 | 問題等級 | 22 | 1 | A | R | '1'-輕微，'2'-中等，'3'-嚴重，'4'-危急 |
| MQ05 | 問題狀態 | 23 | 1 | A | R | 'O'-開放，'P'-處理中，'C'-已關閉，'H'-暫停 |
| MQ06 | 發現日期 | 24-31 | 8 | N | R | 問題發現日期 YYYYMMDD |
| MQ07 | 發現時間 | 32-37 | 6 | N | R | 問題發現時間 HHMMSS |
| MQ08 | 發現者 | 38-47 | 10 | A | R | 問題發現人員 |
| MQ09 | 發現來源 | 48-52 | 5 | A | R | 'PROD'-生產，'QC'-品管，'SALE'-銷售，'CUST'-客戶 |
| MQ10 | 問題描述 | 53-152 | 100 | A | R | 問題詳細描述 |
| MQ11 | 影響範圍 | 153-157 | 5 | A | R | 影響範圍代號 |
| MQ12 | 影響數量 | 158-172 | 15 | N | R | 影響產品數量 (13位整數，2位小數) |
| MQ13 | 影響金額 | 173-187 | 15 | N | R | 影響金額 (13位整數，2位小數) |
| MQ14 | 批號 | 188-200 | 13 | A | R | 相關批號 |
| MQ15 | 供應商 | 201-207 | 7 | A | R | 相關供應商代號 |
| MQ16 | 製造日期 | 208-215 | 8 | N | R | 製造日期 YYYYMMDD |
| MQ17 | 有效期限 | 216-223 | 8 | N | R | 有效期限 YYYYMMDD |
| MQ18 | 儲存條件 | 224-228 | 5 | A | R | 儲存條件代號 |
| MQ19 | 檢驗結果 | 229-233 | 5 | A | R | 檢驗結果代號 |
| MQ20 | 不合格項目 | 234-283 | 50 | A | R | 不合格項目說明 |
| MQ21 | 標準值 | 284-298 | 15 | N | R | 標準值 (11位整數，4位小數) |
| MQ22 | 實測值 | 299-313 | 15 | N | R | 實測值 (11位整數，4位小數) |
| MQ23 | 偏差值 | 314-328 | 15 | N | R | 偏差值 (11位整數，4位小數) |
| MQ24 | 偏差率 | 329-343 | 15 | N | R | 偏差率 (10位整數，5位小數) |
| MQ25 | 處理方式 | 344-348 | 5 | A | R | 處理方式代號 |
| MQ26 | 處理說明 | 349-448 | 100 | A | R | 處理說明 |
| MQ27 | 處理人員 | 449-458 | 10 | A | R | 處理人員 |
| MQ28 | 處理日期 | 459-466 | 8 | N | R | 處理日期 YYYYMMDD |
| MQ29 | 處理時間 | 467-472 | 6 | N | R | 處理時間 HHMMSS |
| MQ30 | 預計完成日 | 473-480 | 8 | N | R | 預計完成日期 YYYYMMDD |
| MQ31 | 實際完成日 | 481-488 | 8 | N | R | 實際完成日期 YYYYMMDD |
| MQ32 | 處理費用 | 489-503 | 15 | N | R | 處理費用 (13位整數，2位小數) |
| MQ33 | 責任單位 | 504-508 | 5 | A | R | 責任單位代號 |
| MQ34 | 責任人員 | 509-518 | 10 | A | R | 責任人員 |
| MQ35 | 根本原因 | 519-618 | 100 | A | R | 根本原因分析 |
| MQ36 | 預防措施 | 619-718 | 100 | A | R | 預防措施說明 |
| MQ37 | 客戶通知 | 719 | 1 | A | R | 'Y'-已通知，'N'-未通知 |
| MQ38 | 通知日期 | 720-727 | 8 | N | R | 客戶通知日期 YYYYMMDD |
| MQ39 | 通知方式 | 728-732 | 5 | A | R | 通知方式代號 |
| MQ40 | 召回標記 | 733 | 1 | A | R | 'Y'-需召回，'N'-不需召回 |
| MQ41 | 召回數量 | 734-748 | 15 | N | R | 召回數量 (13位整數，2位小數) |
| MQ42 | 召回完成 | 749 | 1 | A | R | 'Y'-已完成，'N'-未完成 |
| MQ43 | 檢驗單號 | 750-762 | 13 | A | R | 相關檢驗單號 |
| MQ44 | 客訴單號 | 763-775 | 13 | A | R | 客訴單號 |
| MQ45 | 報告編號 | 776-788 | 13 | A | R | 問題報告編號 |
| MQ46 | 追蹤編號 | 789-801 | 13 | A | R | 追蹤編號 |
| MQ47 | 成本中心 | 802-806 | 5 | A | R | 相關成本中心 |
| MQ48 | 保險理賠 | 807 | 1 | A | R | 'Y'-申請理賠，'N'-無理賠 |
| MQ49 | 理賠金額 | 808-822 | 15 | N | R | 理賠金額 (13位整數，2位小數) |
| MQ50 | 法規通報 | 823 | 1 | A | R | 'Y'-需通報，'N'-不需通報 |
| MQ51 | 通報日期 | 824-831 | 8 | N | R | 法規通報日期 YYYYMMDD |
| MQ52 | 通報機關 | 832-836 | 5 | A | R | 通報機關代號 |
| MQ53 | 媒體關注 | 837 | 1 | A | R | 'Y'-有關注，'N'-無關注 |
| MQ54 | 風險評估 | 838-842 | 5 | A | R | 風險評估等級 |
| MQ55 | 改善措施 | 843-942 | 100 | A | R | 改善措施說明 |
| MQ56 | 效果驗證 | 943 | 1 | A | R | 'Y'-已驗證，'N'-未驗證 |
| MQ57 | 驗證日期 | 944-951 | 8 | N | R | 效果驗證日期 YYYYMMDD |
| MQ58 | 經驗分享 | 952 | 1 | A | R | 'Y'-已分享，'N'-未分享 |
| MQ59 | 備用欄位1 | 953-967 | 15 | A | R | 備用欄位1 |
| MQ60 | 備用欄位2 | 968-982 | 15 | A | R | 備用欄位2 |
| MQXX | 建立日期 | 983-990 | 8 | N | R | 建立日期 YYYYMMDD |
| MQYY | 建立時間 | 991-996 | 6 | N | R | 建立時間 HHMMSS |
| MQZZ | 建立者 | 997-1006 | 10 | A | R | 建立人員 |
| MQ61 | 異動日期 | 1007-1014 | 8 | N | R | 最後異動日期 YYYYMMDD |
| MQ62 | 異動時間 | 1015-1020 | 6 | N | R | 最後異動時間 HHMMSS |
| MQ63 | 異動者 | 1021-1030 | 10 | A | R | 最後異動人員 |

## 6. 主鍵欄位

| 鍵值序號 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | MQ01 | 產品代號 | 升序 |
| 2 | MQ02 | 問題序號 | 升序 |

## 7. 索引資料

### 主要索引
- **索引名稱**：主鍵索引
- **索引欄位**：MQ01 + MQ02
- **索引類型**：PRIMARY
- **說明**：產品代號 + 問題序號複合升序排序

### 輔助索引
1. **問題類型索引**：MQ03 + MQ04 + MQ01 + MQ02 (問題類型 + 等級 + 產品 + 序號)
2. **問題狀態索引**：MQ05 + MQ06 + MQ01 + MQ02 (問題狀態 + 發現日期 + 產品 + 序號)
3. **發現日期索引**：MQ06 + MQ07 + MQ01 + MQ02 (發現日期 + 時間 + 產品 + 序號)
4. **發現者索引**：MQ08 + MQ06 + MQ01 + MQ02 (發現者 + 發現日期 + 產品 + 序號)
5. **發現來源索引**：MQ09 + MQ04 + MQ01 + MQ02 (發現來源 + 問題等級 + 產品 + 序號)
6. **影響範圍索引**：MQ11 + MQ12 + MQ01 + MQ02 (影響範圍 + 影響數量 + 產品 + 序號)
7. **批號索引**：MQ14 + MQ01 + MQ02 (批號 + 產品代號 + 問題序號)
8. **供應商索引**：MQ15 + MQ06 + MQ01 + MQ02 (供應商 + 發現日期 + 產品 + 序號)
9. **處理方式索引**：MQ25 + MQ28 + MQ01 + MQ02 (處理方式 + 處理日期 + 產品 + 序號)
10. **處理人員索引**：MQ27 + MQ28 + MQ01 + MQ02 (處理人員 + 處理日期 + 產品 + 序號)
11. **責任單位索引**：MQ33 + MQ34 + MQ01 + MQ02 (責任單位 + 責任人員 + 產品 + 序號)
12. **客訴單號索引**：MQ44 + MQ01 + MQ02 (客訴單號 + 產品代號 + 問題序號)
13. **報告編號索引**：MQ45 + MQ01 + MQ02 (報告編號 + 產品代號 + 問題序號)
14. **風險評估索引**：MQ54 + MQ04 + MQ01 + MQ02 (風險評估 + 問題等級 + 產品 + 序號)
15. **異動日期索引**：MQ61 + MQ62 + MQ01 + MQ02 (異動日期 + 時間 + 產品 + 序號)

## 8. 備註

### 設計考量
1. 此檔案為 KN 版本問題產品管理的實體檔案
2. 提供完整的問題產品生命週期管理
3. 支援品質管控和問題追蹤機制

### 問題管理功能
- **問題分類**：依類型、等級、來源分類管理
- **狀態追蹤**：從發現到關閉的完整狀態追蹤
- **影響評估**：數量、金額、範圍影響評估
- **處理追蹤**：處理過程和結果追蹤

### 品質管控
- **檢驗記錄**：檢驗結果、不合格項目記錄
- **標準比對**：標準值與實測值比對
- **偏差分析**：偏差值和偏差率計算
- **根本原因**：根本原因分析記錄

### 處理流程
- **問題發現**：記錄發現時間、人員、來源
- **影響評估**：評估影響範圍、數量、金額
- **處理分派**：指定責任單位和處理人員
- **處理執行**：記錄處理過程和結果
- **效果驗證**：驗證處理效果
- **經驗分享**：分享處理經驗

### 客戶關係
- **客戶通知**：客戶通知機制
- **召回管理**：產品召回流程管理
- **客訴處理**：客訴單關聯處理
- **媒體關注**：媒體關注度監控

### 法規遵循
- **法規通報**：法規要求通報處理
- **通報機關**：相關主管機關通報
- **保險理賠**：保險理賠申請處理
- **風險評估**：法規風險評估

### 成本管理
- **處理費用**：問題處理成本記錄
- **影響金額**：問題造成的損失
- **理賠金額**：保險理賠金額
- **成本中心**：相關成本中心分攤

### 問題等級定義
- **等級1 (輕微)**：不影響使用，內部處理
- **等級2 (中等)**：影響品質，需要改善
- **等級3 (嚴重)**：影響安全，需要召回
- **等級4 (危急)**：危及生命，緊急處理

### 問題狀態管理
- **O (開放)**：問題已確認，待處理
- **P (處理中)**：正在處理中
- **C (已關閉)**：問題已解決並關閉
- **H (暫停)**：暫時停止處理

### 發現來源分類
- **PROD (生產)**：生產過程發現
- **QC (品管)**：品管檢驗發現
- **SALE (銷售)**：銷售過程發現
- **CUST (客戶)**：客戶反映發現

### 資料完整性控制
1. **主鍵唯一性**：MQ01 + MQ02 複合主鍵唯一
2. **外鍵檢查**：MQ01 必須存在於 MTMHPF.MH01
3. **狀態一致性**：問題狀態與處理狀態一致
4. **日期邏輯性**：各種日期邏輯合理性
5. **數值合理性**：數量、金額欄位合理性

### 業務規則
1. 產品代號必須存在於 MTMHPF 中
2. 問題序號依時間順序自動編號
3. 問題等級影響處理優先順序
4. 嚴重問題必須客戶通知
5. 危急問題必須法規通報

### 關聯檔案
- **產品主檔 KN**：MTMHPF (MQ01 = MH01)
- **產品主檔標準版**：MTMAPF (MQ01 = MA01)
- **供應商檔**：MTMBPF (MQ15 = MB01)
- **員工檔**：MTMCPF (MQ08, MQ27, MQ34 = MC01)
- **問題類型檔**：PA#問題類型檔 (MQ03 = 類型代號)

### 報表應用
- **問題統計報表**：依類型、等級、狀態統計
- **處理績效報表**：處理時效和效果分析
- **品質趨勢報表**：品質問題趨勢分析
- **成本分析報表**：問題處理成本分析

### 預警機制
- **逾期預警**：處理逾期自動預警
- **升級預警**：問題升級自動提醒
- **通報預警**：法規通報期限提醒
- **召回預警**：召回完成度監控

### 使用場景
1. **問題登記**：新問題發現時登記
2. **問題追蹤**：問題處理進度追蹤
3. **品質分析**：品質問題趨勢分析
4. **績效評估**：問題處理績效評估

### 維護作業
- **新增作業**：新問題記錄建立
- **修改作業**：問題資料更新維護
- **狀態變更**：問題狀態轉換
- **批次處理**：批次問題資料處理
- **定期清理**：歷史問題資料清理

### 效能考量
1. **索引最佳化**：多個輔助索引提升查詢效能
2. **資料分割**：可考慮按年度或產品類別分割
3. **歷史資料**：定期歸檔歷史問題資料
4. **查詢最佳化**：常用查詢條件索引化

### 安全控制
- **存取權限**：依職務控制存取權限
- **敏感資料**：客戶相關資料加密保護
- **稽核記錄**：完整的問題處理稽核軌跡
- **備份策略**：重要問題資料定期備份

### 資料品質
1. **必填檢查**：關鍵問題資訊不可為空
2. **格式檢查**：日期、時間、編號格式正確
3. **邏輯檢查**：處理流程邏輯一致性
4. **範圍檢查**：數值欄位合理範圍
5. **關聯檢查**：相關檔案關聯有效性

### 整合應用
- **ERP整合**：與ERP系統問題管理整合
- **QMS整合**：與品質管理系統整合
- **CRM整合**：與客戶關係管理系統整合
- **法規系統**：與法規通報系統整合

### 使用注意事項
1. 此為實體檔案，可直接進行 CRUD 操作
2. 異動時需更新 MQ61、MQ62、MQ63 等異動資訊
3. 問題狀態變更需檢查相關業務邏輯
4. 重要問題需要主管授權處理
5. 法規相關問題需要特別注意合規性 