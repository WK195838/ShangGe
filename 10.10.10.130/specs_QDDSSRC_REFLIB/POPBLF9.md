# POPBLF9 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | POPBLF9 |
| 檔案類型 | 邏輯檔案 (LF) |
| 檔案用途 | 採購單主檔邏輯檔 (排除 V 狀態) |
| 作業系統 | AS/400 |
| 建立日期 | - |
| 最後修改日期 | - |

## 2. 檔案功能說明

POPBLF9 為採購單主檔 (POPBPF) 的條件篩選邏輯檔案，提供透過特定鍵值組合與篩選條件存取實體檔資料的路徑。此邏輯檔案使用 PB05+PB04+PB02 作為索引鍵值，並且排除狀態碼為 'V' 的記錄，專門處理有效的採購單資料。

## 3. 系統檔案清單

- **實體檔案**: POPBPF (採購單主檔)
- **邏輯檔案**: POPBLF9 (本檔案)

## 4. 記錄格式

### 記錄格式 PB0
- **記錄識別**: PB0
- **檔案參照**: POPBPF
- **記錄類型**: 邏輯檔記錄格式

## 5. 欄位規格

POPBLF9 邏輯檔案使用 POPBPF 實體檔案的所有欄位，詳細欄位規格請參考 POPBPF 實體檔案規格書。

## 6. 主鍵欄位

| 順序 | 欄位代號 | 欄位名稱 | 排序方向 | 說明 |
|------|----------|----------|----------|------|
| 1 | PB05 | 供應商代碼 | 升序 | 第一排序鍵值 |
| 2 | PB04 | 採購日期 | 降序 | 第二排序鍵值 (DESCEND) |
| 3 | PB02 | 採購單編號 | 升序 | 第三排序鍵值 |

## 7. 索引資料

### 存取路徑設定
- **排序方式**: 混合排序 (升序+降序+升序)
- **重複鍵值**: 不允許
- **索引類型**: 唯一索引

### 索引鍵值
- 第一鍵值: PB05 (供應商代碼) - 升序
- 第二鍵值: PB04 (採購日期) - 降序
- 第三鍵值: PB02 (採購單編號) - 升序

### 篩選條件
- **PB19 ≠ 'V'**: 排除狀態碼為 'V' 的記錄
- **篩選語法**: COMP(NE 'V')

## 8. 備註

1. **檔案特性**: 
   - 邏輯檔案
   - 參照實體檔案 POPBPF
   - 條件篩選設計
   - 混合排序模式

2. **存取特性**:
   - 提供供應商導向的存取路徑
   - 自動排除狀態為 'V' 的無效記錄
   - 支援按供應商→最新日期→採購單編號順序查詢

3. **狀態篩選特色**:
   - 自動過濾掉 PB19 = 'V' 的記錄
   - 確保只顯示有效的採購單資料
   - 減少不必要的資料處理

4. **排序策略**:
   - 供應商優先分組 (PB05 升序)
   - 同一供應商內按最新日期排序 (PB04 降序)
   - 相同日期內按採購單編號排序 (PB02 升序)

5. **使用注意事項**:
   - 適用於需要查看有效採購單的作業程式
   - 自動排除已作廢或無效的採購單 (狀態 'V')
   - 支援供應商採購統計與分析
   - 特別適合供應商績效評估與採購管理
   - 兼具時間序列與供應商分類的雙重優勢 