# W2DCPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | W2DCPF |
| 檔案類型 | 實體檔 (PF) |
| 檔案描述 | 失敗訂單報表 |
| 作業系統 | AS/400 |
| 資料庫 | DB2/400 |

## 2. 檔案功能說明

此檔案為失敗訂單報表的資料檔，負責儲存訂單處理失敗的記錄及統計資料。主要功能：
- 記錄訂單處理失敗的詳細資料
- 管理營業點及失敗訂單的統計資訊
- 提供產品訂單失敗的記錄
- 支援失敗原因及金額的統計
- 提供訂單失敗分析的報表資料來源

## 3. 系統檔案清單

| 項目 | 檔案名稱 | 類型 | 說明 |
|------|----------|------|------|
| 主檔 | W2DCPF | PF | 失敗訂單報表 |
| 關聯檔 | W2DAPF | PF | 一般銷售訂單確認報表 |
| 關聯檔 | W2DBPF | PF | 試飲訂單確認報表 |

## 4. 紀錄格式

### 記錄格式：DC0

| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 說明 |
|----------|----------|------|------|------|------|
| DC01 | 訂貨日期 | S | 8 | 0 | 訂貨日期 |
| DC02 | 訂單編號 | A | 12 | 0 | 訂單編號 |
| DC03 | 營業點 | A | 5 | 0 | 營業點代號 |
| DC04 | 營業點名稱 | O | 22 | 0 | 營業點名稱 |
| DC05 | 產品代號 | A | 9 | 0 | 產品代號 |
| DC06 | 產品名稱 | O | 18 | 0 | 產品名稱 |
| DC07 | 單價 | S | 11 | 2 | 訂單單價 |
| DC08 | 價格 | S | 9 | 2 | 產品價格 |
| DC09 | 訂購數量 | S | 8 | 0 | 訂購數量 |
| DC10 | 出貨數量 | S | 8 | 0 | 出貨數量 |
| DC11 | 失敗原因 | O | 12 | 0 | 失敗原因說明 |

## 5. 主鍵欄位

| 順序 | 欄位代號 | 欄位名稱 | 排序方式 |
|------|----------|----------|----------|
| 1 | DC03 | 營業點 | 遞增 |
| 2 | DC01 | 訂貨日期 | 遞增 |
| 3 | DC02 | 訂單編號 | 遞增 |

## 6. 索引資料

### 索引鍵值
- **主索引**：DC03 + DC01 + DC02
- **排序方式**：營業點遞增，訂貨日期遞增，訂單編號遞增

### 存取路徑
此檔案提供以下存取路徑：
1. 依營業點分組檢索失敗訂單資料
2. 依訂貨日期範圍查詢
3. 依訂單編號直接檢索
4. 支援營業點的失敗訂單統計分析

## 7. 使用說明

### 查詢功能
- 支援依營業點查詢失敗訂單資料
- 提供訂貨日期範圍檢索
- 支援訂單編號直接查詢
- 支援產品代號的失敗統計
- 支援失敗原因分類分析
- 提供訂購與出貨數量差異分析

### 作業程序
1. 記錄訂單處理失敗的詳細資訊
2. 統計訂購及出貨數量差異
3. 記錄失敗原因及相關說明
4. 提供失敗訂單報表的資料來源
5. 支援營業點的失敗訂單分析

### 維護作業
- **新增**：建立新的失敗訂單記錄
- **查詢**：支援多重條件檢索
- **更新**：更新失敗原因及數量
- **統計**：產生各種失敗統計報表
- **分析**：提供失敗原因分析

### 注意事項
- 單價及價格支援小數點後兩位精度
- 失敗原因欄位提供詳細說明功能
- 支援訂購與出貨數量的差異分析
- 營業點優先的排序邏輯

### 失敗原因分析
- **數量不足**：出貨數量小於訂購數量
- **產品異常**：產品相關問題
- **營業點問題**：營業點配送問題
- **系統錯誤**：系統處理錯誤

## 8. 備註

- 此檔案為失敗訂單分析的報表檔案
- 三重複合主鍵確保失敗訂單記錄唯一性
- 支援完整的失敗訂單管理
- 提供失敗原因的統計分析功能
- 營業點及產品名稱採用開放長度格式
- 支援失敗原因的詳細記錄及分析 