# W2BALF04 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | W2BALF04 |
| 檔案類型 | 邏輯檔 (LF) |
| 檔案描述 | 後台銷售主檔邏輯檔04 |
| 基礎實體檔 | W2BAPF |
| 作業系統 | AS/400 |
| 資料庫 | DB2/400 |

## 2. 檔案功能說明

此檔案為後台銷售主檔的邏輯檔，提供異常狀態專門檢索(營業點+銷售編號倒序+銷售發貨號)，僅顯示狀態為'E'(異常)的銷售記錄。主要功能：
- 僅顯示狀態為'E'(異常)的銷售記錄
- 以營業點為主要排序鍵，便於營業點管理
- 銷售編號採用倒序排列，最新異常記錄優先
- 支援異常狀態銷售的專門管理

## 3. 系統檔案清單

| 項目 | 檔案名稱 | 類型 | 說明 |
|------|----------|------|------|
| 主檔 | W2BALF04 | LF | 後台銷售主檔邏輯檔04 |
| 基礎檔 | W2BAPF | PF | 後台銷售主檔 |

## 4. 紀錄格式

### 記錄格式：BA0
**基礎實體檔：W2BAPF**
**選擇條件：BA05 = 'E'**

| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 說明 |
|----------|----------|------|------|------|------|
| BA01 | 銷售編號 | A | 12 | 0 | 後台銷售編號 |
| BA02 | 營業點 | A | 5 | 0 | 營業點代號 |
| BA03 | 銷售發貨號 | A | 12 | 0 | 銷售發貨號 |
| BA04 | 總金額 | S | 11 | 2 | 銷售總金額 |
| BA05 | 狀態 | A | 1 | 0 | 處理狀態(限'E') |
| BA06 | 確認人員 | A | 10 | 0 | 確認人員代號 |
| BA07 | VIP電話 | A | 15 | 0 | VIP客戶電話 |
| BA08 | VIP分機 | S | 4 | 0 | VIP客戶分機 |
| BAXX | 建立日期 | S | 8 | 0 | 記錄建立日期 |
| BAYY | 建立時間 | S | 6 | 0 | 記錄建立時間 |
| BAZZ | 建立人員 | A | 10 | 0 | 記錄建立人員 |

## 5. 主鍵欄位

| 順序 | 欄位代號 | 欄位名稱 | 排序方式 |
|------|----------|----------|----------|
| 1 | BA02 | 營業點 | 遞增 |
| 2 | BA01 | 銷售編號 | 遞減 |
| 3 | BA03 | 銷售發貨號 | 遞增 |

## 6. 索引資料

### 索引鍵值
- **主索引**：BA02 + BA01 (DESCEND) + BA03
- **排序方式**：營業點遞增，銷售編號遞減，銷售發貨號遞增
- **選擇條件**：BA05 = 'E'

### 存取路徑
此邏輯檔提供以下存取路徑：
1. 依營業點分組存取異常銷售記錄
2. 同一營業點的異常銷售按編號倒序排列
3. 自動過濾非異常狀態記錄

### 異常狀態篩選邏輯
- **'E' 狀態**：異常狀態的銷售記錄
- **其他狀態**：自動排除不顯示
- **專門處理**：僅針對異常狀況的銷售管理

## 7. 使用說明

### 查詢功能
- 僅顯示異常狀態的銷售記錄
- 支援依營業點範圍查詢
- 支援依銷售編號範圍查詢
- 提供異常狀況的專門檢索

### 作業程序
1. 系統自動篩選狀態為'E'的記錄
2. 按營業點+銷售編號倒序+銷售發貨號排序顯示
3. 提供異常銷售的專門管理功能
4. 支援異常狀況的追蹤及處理

### 檢索邏輯
- **異常篩選**：僅顯示異常狀態記錄
- **營業點分組**：依營業點群組化異常資料
- **時序排列**：最新異常記錄優先
- **專門管理**：便於異常狀況處理

### 注意事項
- 此為篩選型邏輯檔，僅顯示異常狀態記錄
- 資料異動需透過基礎檔案W2BAPF進行
- 狀態變更時邏輯檔記錄會自動出現或消失
- 專門用於異常狀況的管理及追蹤

## 8. 備註

- 邏輯檔建立於W2BAPF基礎檔案之上
- 專門用於後台銷售系統的異常狀態管理
- 提供異常銷售記錄的專門檢索
- 異常狀態篩選機制確保資料一致性
- 支援異常狀況的追蹤及處理需求
- 排序邏輯：營業點(遞增) + 銷售編號(遞減) + 銷售發貨號(遞增) 