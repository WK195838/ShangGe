# W2BFPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | W2BFPF |
| 檔案類型 | 實體檔 (PF) |
| 檔案描述 | 後台採購明細檔 |
| 主鍵 | BF01 + BF02 |
| 作業系統 | AS/400 |
| 資料庫 | DB2/400 |

## 2. 檔案功能說明

此檔案為後台採購系統的核心明細檔案，記錄每筆採購交易的詳細商品明細資訊。主要功能：
- 儲存後台採購的商品明細記錄
- 管理採購數量與單價資訊
- 提供採購成本管理
- 追蹤採購明細的關聯編號
- 支援採購金額計算

## 3. 系統檔案清單

| 項目 | 檔案名稱 | 類型 | 說明 |
|------|----------|------|------|
| 主檔 | W2BFPF | PF | 後台採購明細檔 |
| 主檔關聯 | W2BEPF | PF | 後台採購主檔 |

## 4. 紀錄格式

### 記錄格式：BF0

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|----------|------|------|------|------|------|
| BF01 | 採購編號 | 1 | 12 | A | 主鍵 | 採購編號 |
| BF02 | 商品代號 | 13 | 9 | A | 主鍵 | 商品識別代號 |
| BF03 | 數量 | 22 | 8 | S | 必填 | 採購數量 |
| BF04 | 進貨單價 | 30 | 9 | S(2) | 必填 | 進貨單價 |
| BF05 | 金額 | 39 | 11 | S(2) | 計算 | 採購金額 |
| BF06 | 採購編號 | 50 | 12 | A | 索引 | 關聯採購編號 |
| BFXX | 建立日期 | 62 | 8 | S | 系統 | 記錄建立日期 |
| BFYY | 建立時間 | 70 | 6 | S | 系統 | 記錄建立時間 |
| BFZZ | 建立人員 | 76 | 10 | A | 系統 | 記錄建立人員 |

## 5. 主鍵欄位

| 順序 | 欄位代號 | 欄位名稱 | 約束條件 |
|------|----------|----------|----------|
| 1 | BF01 | 採購編號 | NOT NULL |
| 2 | BF02 | 商品代號 | NOT NULL |

**唯一性約束：** UNIQUE (BF01, BF02)

## 6. 索引資料

### 主索引
- **索引名稱**：BF0_PRIMARY
- **索引欄位**：BF01 + BF02
- **索引類型**：PRIMARY KEY, UNIQUE
- **排序方式**：遞增

### 輔助索引
- **商品代號索引**：BF02 (商品識別代號)
- **關聯採購編號索引**：BF06 (關聯採購編號)
- **建立日期索引**：BFXX (建立日期)

## 7. 使用說明

### 資料維護
- 新增：透過採購系統自動產生明細記錄
- 修改：支援數量及單價欄位的異動，金額自動計算
- 刪除：配合採購主檔刪除時同步刪除

### 數量與單價控制
- **採購數量(BF03)**：商品採購數量
- **進貨單價(BF04)**：商品進貨單價，支援小數點後2位
- **採購金額(BF05)**：系統計算，數量×單價

### 金額計算邏輯
- 採購金額 = 採購數量 × 進貨單價
- 支援自動計算與手動調整
- 提供金額驗證機制

### 關聯編號管理
- **採購編號(BF01)**：主要採購編號
- **關聯採購編號(BF06)**：輔助關聯編號
- 支援採購記錄的交叉引用

### 商品代號規則
- **商品代號(BF02)**：9位字元的商品識別碼
- 配合採購編號形成唯一明細識別
- 支援商品管理的完整追蹤

## 8. 備註

- 檔案採用雙重複合主鍵確保明細記錄唯一性
- 支援採購編號與商品代號的完整組合管理
- 提供進貨單價的精確管理機制
- 支援採購金額的自動計算功能
- 系統自動記錄建立資訊便於追蹤
- 為後台採購系統的核心明細檔案
- 與主檔W2BEPF建立主從關聯 