# SOSFJF01 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSFJF01
- **檔案類型**: LF (聯結邏輯檔案)
- **基底檔案**: SOSFPF (送貨單明細檔), SOSEPF (送貨單主檔)
- **檔案說明**: 送貨單明細檔案聯結檔 - 明細主檔聯結查詢
- **建立日期**: (依系統記錄)
- **最後異動日期**: 2024/11/26 (DEREK - 新增送貨日期欄位)

## 2. 檔案功能說明
此聯結邏輯檔案將送貨單明細檔 (SOSFPF) 與送貨單主檔 (SOSEPF) 進行聯結，提供完整的送貨明細與主檔資訊，支援動態選擇查詢。

### 主要功能
- 明細主檔聯結查詢
- 未確認送貨單分析
- 特定部門送貨管理

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSFPF | PF | 送貨單明細檔 (主要檔案) |
| SOSEPF | PF | 送貨單主檔 (次要檔案) |
| SOSFJF01 | LF | 送貨單明細聯結邏輯檔案 |

## 4. 紀錄格式

### 4.1 聯結檔案設定
```
JFILE(SOSFPF SOSEPF)    // 聯結檔案設定
JOIN(SF02 SE02)         // 聯結條件：送貨單號
DYNSLT                  // 動態選擇
JDFTVAL                 // 預設值處理
```

### 4.2 關鍵欄位 (Key Fields)
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SF01A | 客戶編號第一碼 | A | 1 | ASC | 主要排序鍵 |
| 2 | SF26 | 出貨訊息統計 | A | 8 | ASC | 次要排序鍵 |
| 3 | SF03 | 產品編號 | A | 15 | ASC | 第三排序鍵 |

### 4.3 計算欄位
| 欄位代號 | 計算公式 | 說明 |
|----------|----------|------|
| SF01A | SST(SF01 1 1) | 客戶編號第一碼 |

### 4.4 選擇條件 (SELECT/OMIT)
| 類型 | 欄位代號 | 條件 | 值 | 說明 |
|------|----------|------|----|----|
| SELECT | SE03 | VALUES | 'D1','D2','D3','D4' | 選擇特定部門代號 |
| SELECT | SE24 | COMP(EQ) | 0 | 選擇確認日期為零（未確認） |

### 4.5 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|----------|
| SF01 | 客戶編號 | A | 10 | - | 客戶基本資料 |
| SF01A | 客戶編號第一碼 | A | 1 | Key,Computed | SST(SF01 1 1) |
| SF02 | 送貨單號 | A | 10 | Join | 聯結關鍵欄位 |
| SF03 | 產品編號 | A | 15 | Key | 產品基本資料 |
| SF04 | 訂購數量 | P | 9,2 | - | 客戶訂購數量 |
| SF05 | 出貨數量 | P | 9,2 | - | 實際出貨數量 |
| SF26 | 出貨訊息統計 | A | 8 | Key | 出貨狀態統計 |
| SE03 | 部門 | A | 5 | Select | 業務部門代號 |
| SE06 | 送貨日期 | N | 8,0 | - | 送貨執行日期 |
| SE24 | 確認日期 | N | 8,0 | Select | 送貨確認日期 |

## 5. 主鍵欄位
- **主要鍵值**: SF01A + SF26 + SF03
- **排序方式**: 客戶編號第一碼、出貨訊息統計、產品編號升序
- **索引類型**: 複合索引，聯結查詢專用

## 6. 索引資料
- **排序方式**: SF01A + SF26 + SF03
- **索引類型**: 復合索引，支援客戶產品查詢
- **特殊屬性**: 包含子字串欄位，支援動態選擇

## 7. 使用說明

### 7.1 檔案用途
- 送貨單明細與主檔聯合查詢
- 明細分析
- 未確認送貨單處理

### 7.2 程式存取方式
```rpg
// 依客戶編號第一碼查詢
SETLL (客戶編號第一碼) SOSFJF01;
READ SOSFJF01;
// 依客戶編號第一碼和出貨統計查詢
CHAIN (客戶編號第一碼:出貨訊息統計) SOSFJF01;
```

### 7.3 部門代號說明
選擇的部門代號：
- **D1**: 部門代號 D1
- **D2**: 部門代號 D2
- **D3**: 部門代號 D3
- **D4**: 部門代號 D4

## 8. 備註
- 此聯結檔案專門用於特定部門的未確認送貨單分析
- 提供動態選擇功能，支援靈活查詢
- 整合明細與主檔資訊，提供完整的業務視圖
- 僅顯示特定部門 (D1-D4) 的送貨記錄
- 僅顯示未確認的送貨單 (SE24 = 0) 