# MTMJPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | MTMJPF |
| 檔案描述 | 客戶基本資料延伸檔 |
| 檔案類型 | PF (Physical File) |
| 記錄格式 | MJ0 |
| 主鍵 | MJ01 + MJ02 (客戶代號 + 延伸代號) |
| 檔案屬性 | 實體檔案，客戶延伸資料主檔 |

## 2. 檔案功能說明

MTMJPF 為客戶基本資料延伸檔的實體檔案，提供：
- 客戶延伸資料儲存
- 客戶特殊屬性管理
- 客戶關係資料記錄
- 客製化客戶資訊

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 說明 |
|----------|----------|------|
| MTMJPF | 客戶基本資料延伸實體檔 | 主檔 |
| MTMDPF | 客戶基本資料實體檔 | 關聯主檔 |
| MTMEPF | 客戶分店資料實體檔 | 關聯檔案 |
| RERF | 參考檔案 | 欄位定義參考 |

## 4. 紀錄格式

### 記錄格式：MJ0

## 5. 欄位規格

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| MJ01 | 客戶代號 | 1-7 | 7 | A | R | 主鍵1，關聯MTMDPF.MD01 |
| MJ02 | 延伸代號 | 8-10 | 3 | A | R | 主鍵2，延伸資料識別碼 |
| MJ03 | 延伸名稱 | 11-50 | 40 | A | R | 延伸資料名稱 |
| MJ04 | 延伸說明 | 51-150 | 100 | A | R | 延伸資料詳細說明 |
| MJ05 | 資料類型 | 151 | 1 | A | R | 'T'-文字，'N'-數字，'D'-日期 |
| MJ06 | 文字內容 | 152-301 | 150 | A | R | 文字型延伸內容 |
| MJ07 | 數字內容 | 302-316 | 15 | N | R | 數字型延伸內容 (11位整數，4位小數) |
| MJ08 | 日期內容 | 317-324 | 8 | N | R | 日期型延伸內容 YYYYMMDD |
| MJ09 | 優先順序 | 325-327 | 3 | N | R | 顯示優先順序 001-999 |
| MJ10 | 狀態標記 | 328 | 1 | A | R | 'A'-有效，'I'-無效，'D'-刪除 |
| MJ11 | 分類標記 | 329-333 | 5 | A | R | 延伸資料分類 |
| MJ12 | 客戶層級 | 334 | 1 | A | R | '1'-總公司，'2'-分公司，'3'-門市 |
| MJ13 | 適用範圍 | 335-339 | 5 | A | R | 適用範圍代碼 |
| MJ14 | 業務員 | 340-344 | 5 | A | R | 負責業務員代號 |
| MJ15 | 地區代號 | 345-349 | 5 | A | R | 客戶所屬地區 |
| MJ16 | 區域代號 | 350-354 | 5 | A | R | 客戶所屬區域 |
| MJ17 | 通路代號 | 355-359 | 5 | A | R | 銷售通路代號 |
| MJ18 | 客戶等級 | 360-364 | 5 | A | R | 客戶等級代號 |
| MJ19 | 信用等級 | 365 | 1 | A | R | 'A'-優，'B'-良，'C'-普通，'D'-差 |
| MJ20 | 信用額度 | 366-380 | 15 | N | R | 信用額度 (13位整數，2位小數) |
| MJ21 | 付款條件 | 381-385 | 5 | A | R | 付款條件代號 |
| MJ22 | 付款方式 | 386-390 | 5 | A | R | 付款方式代號 |
| MJ23 | 開始交易日 | 391-398 | 8 | N | R | 開始交易日期 YYYYMMDD |
| MJ24 | 停止交易日 | 399-406 | 8 | N | R | 停止交易日期 YYYYMMDD |
| MJ25 | 交易狀態 | 407 | 1 | A | R | 'A'-正常，'S'-暫停，'C'-結束 |
| MJ26 | 折扣率 | 408-422 | 15 | N | R | 客戶折扣率 (10位整數，5位小數) |
| MJ27 | 特殊折扣 | 423-437 | 15 | N | R | 特殊折扣率 (10位整數，5位小數) |
| MJ28 | 回扣率 | 438-452 | 15 | N | R | 客戶回扣率 (10位整數，5位小數) |
| MJ29 | 佣金率 | 453-467 | 15 | N | R | 業務佣金率 (10位整數，5位小數) |
| MJ30 | 稅籍編號 | 468-475 | 8 | A | R | 統一編號 |
| MJ31 | 發票抬頭 | 476-515 | 40 | A | R | 發票抬頭名稱 |
| MJ32 | 發票地址 | 516-615 | 100 | A | R | 發票寄送地址 |
| MJ33 | 聯絡人 | 616-635 | 20 | A | R | 主要聯絡人 |
| MJ34 | 聯絡電話 | 636-650 | 15 | A | R | 聯絡電話 |
| MJ35 | 傳真號碼 | 651-665 | 15 | A | R | 傳真號碼 |
| MJ36 | 電子郵件 | 666-715 | 50 | A | R | 電子郵件地址 |
| MJ37 | 網站網址 | 716-765 | 50 | A | R | 公司網站網址 |
| MJ38 | 行業別 | 766-770 | 5 | A | R | 行業別代號 |
| MJ39 | 公司規模 | 771 | 1 | A | R | '1'-大型，'2'-中型，'3'-小型 |
| MJ40 | 員工人數 | 772-776 | 5 | N | R | 員工人數 |
| MJ41 | 資本額 | 777-791 | 15 | N | R | 資本額 (13位整數，2位小數) |
| MJ42 | 年營業額 | 792-806 | 15 | N | R | 年營業額 (13位整數，2位小數) |
| MJ43 | 成立日期 | 807-814 | 8 | N | R | 公司成立日期 YYYYMMDD |
| MJ44 | 合作開始日 | 815-822 | 8 | N | R | 合作開始日期 YYYYMMDD |
| MJ45 | 合約到期日 | 823-830 | 8 | N | R | 合約到期日期 YYYYMMDD |
| MJ46 | 最後交易日 | 831-838 | 8 | N | R | 最後交易日期 YYYYMMDD |
| MJ47 | 最後拜訪日 | 839-846 | 8 | N | R | 最後拜訪日期 YYYYMMDD |
| MJ48 | 拜訪頻率 | 847 | 1 | A | R | '1'-每週，'2'-隔週，'3'-每月 |
| MJ49 | VIP等級 | 848 | 1 | A | R | '1'-鑽石，'2'-白金，'3'-金卡 |
| MJ50 | 累計消費 | 849-863 | 15 | N | R | 累計消費金額 (13位整數，2位小數) |
| MJ51 | 本年消費 | 864-878 | 15 | N | R | 本年消費金額 (13位整數，2位小數) |
| MJ52 | 上年消費 | 879-893 | 15 | N | R | 上年消費金額 (13位整數，2位小數) |
| MJ53 | 平均月消費 | 894-908 | 15 | N | R | 平均月消費 (13位整數，2位小數) |
| MJ54 | 銀行代號 | 909-913 | 5 | A | R | 主要往來銀行 |
| MJ55 | 銀行帳號 | 914-928 | 15 | A | R | 銀行帳號 |
| MJ56 | 戶名 | 929-968 | 40 | A | R | 銀行戶名 |
| MJ57 | 特殊備註 | 969-1068 | 100 | A | R | 特殊備註說明 |
| MJ58 | 內部評等 | 1069 | 1 | A | R | 'A'-優質，'B'-一般，'C'-待觀察 |
| MJ59 | 風險等級 | 1070 | 1 | A | R | '1'-低風險，'2'-中風險，'3'-高風險 |
| MJ60 | 競爭對手 | 1071-1120 | 50 | A | R | 主要競爭對手 |
| MJXX | 建立日期 | 1121-1128 | 8 | N | R | 建立日期 YYYYMMDD |
| MJYY | 建立時間 | 1129-1134 | 6 | N | R | 建立時間 HHMMSS |
| MJZZ | 建立者 | 1135-1144 | 10 | A | R | 建立人員 |
| MJ61 | 異動日期 | 1145-1152 | 8 | N | R | 最後異動日期 YYYYMMDD |
| MJ62 | 異動時間 | 1153-1158 | 6 | N | R | 最後異動時間 HHMMSS |
| MJ63 | 異動者 | 1159-1168 | 10 | A | R | 最後異動人員 |

## 6. 主鍵欄位

| 鍵值序號 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | MJ01 | 客戶代號 | 升序 |
| 2 | MJ02 | 延伸代號 | 升序 |

## 7. 索引資料

### 主要索引
- **索引名稱**：主鍵索引
- **索引欄位**：MJ01 + MJ02
- **索引類型**：PRIMARY
- **說明**：客戶代號 + 延伸代號複合升序排序

### 輔助索引
1. **延伸代號索引**：MJ02 + MJ01 (延伸代號 + 客戶代號)
2. **分類狀態索引**：MJ11 + MJ10 + MJ01 + MJ02 (分類 + 狀態 + 客戶 + 延伸)
3. **客戶層級索引**：MJ12 + MJ01 + MJ02 (客戶層級 + 客戶 + 延伸代號)
4. **業務員索引**：MJ14 + MJ01 + MJ02 (業務員 + 客戶 + 延伸代號)
5. **地區區域索引**：MJ15 + MJ16 + MJ01 + MJ02 (地區 + 區域 + 客戶 + 延伸)
6. **通路索引**：MJ17 + MJ01 + MJ02 (通路 + 客戶 + 延伸代號)
7. **客戶等級索引**：MJ18 + MJ01 + MJ02 (客戶等級 + 客戶 + 延伸代號)
8. **信用等級索引**：MJ19 + MJ01 + MJ02 (信用等級 + 客戶 + 延伸代號)
9. **交易狀態索引**：MJ25 + MJ01 + MJ02 (交易狀態 + 客戶 + 延伸代號)
10. **VIP等級索引**：MJ49 + MJ50 + MJ01 + MJ02 (VIP等級 + 累計消費 + 客戶 + 延伸)
11. **風險等級索引**：MJ59 + MJ19 + MJ01 + MJ02 (風險等級 + 信用等級 + 客戶 + 延伸)
12. **行業別索引**：MJ38 + MJ39 + MJ01 + MJ02 (行業別 + 公司規模 + 客戶 + 延伸)
13. **合約到期索引**：MJ45 + MJ01 + MJ02 (合約到期日 + 客戶 + 延伸代號)
14. **最後交易索引**：MJ46 + MJ01 + MJ02 (最後交易日 + 客戶 + 延伸代號)
15. **異動日期索引**：MJ61 + MJ62 + MJ01 + MJ02 (異動日期 + 時間 + 客戶 + 延伸)

## 8. 備註

### 設計考量
1. 此檔案為客戶延伸資料的主要實體檔案
2. 提供客戶主檔無法滿足的詳細客戶資訊
3. 支援客戶關係管理和商業智能分析

### 客戶關係管理
- **客戶分層**：支援總公司、分公司、門市三層架構
- **業務管理**：業務員、地區、區域管理
- **通路管理**：多通路客戶管理
- **等級管理**：客戶等級、VIP等級管理

### 信用管理
- **信用評等**：信用等級、風險等級評估
- **信用額度**：信用額度控制
- **付款管理**：付款條件、付款方式
- **交易控制**：交易狀態管理

### 財務資訊
- **折扣管理**：一般折扣、特殊折扣、回扣
- **佣金管理**：業務佣金率設定
- **消費分析**：累計、年度、平均消費
- **銀行資訊**：往來銀行帳號資訊

### 聯絡資訊
- **基本聯絡**：聯絡人、電話、傳真
- **電子通訊**：電子郵件、網站
- **發票資訊**：統編、抬頭、地址
- **拜訪管理**：拜訪頻率、最後拜訪日

### 公司資訊
- **基本資料**：行業別、公司規模、員工人數
- **財務資料**：資本額、年營業額
- **重要日期**：成立日、合作開始日、合約到期日
- **競爭分析**：主要競爭對手

### 資料類型處理
- **文字型 (T)**：使用 MJ06 欄位 (150字元)
- **數字型 (N)**：使用 MJ07 欄位 (15位數，4位小數)
- **日期型 (D)**：使用 MJ08 欄位 (YYYYMMDD格式)

### 資料完整性控制
1. **主鍵唯一性**：MJ01 + MJ02 複合主鍵唯一
2. **外鍵檢查**：MJ01 必須存在於 MTMDPF.MD01
3. **資料類型一致性**：MJ05 與內容欄位必須一致
4. **狀態有效性**：MJ10、MJ25 狀態標記有效性檢查
5. **數值合理性**：金額、比率欄位合理性檢查

### 業務規則
1. 客戶代號必須存在於 MTMDPF 中
2. 延伸代號在同一客戶下必須唯一
3. 資料類型決定使用哪個內容欄位
4. 交易狀態影響業務處理
5. 信用額度不可超過限制

### 關聯檔案
- **客戶主檔**：MTMDPF (MJ01 = MD01)
- **客戶分店檔**：MTMEPF (MJ01 = ME01)
- **業務員檔**：MTMCPF (MJ14 = MC01)
- **地區檔**：PA#DPF (MJ15 = #D01)
- **區域檔**：PA#EPF (MJ16 = #E01)
- **通路檔**：PA#CPF (MJ17 = #C01)
- **銀行檔**：銀行檔 (MJ54 = 銀行代號)

### CRM應用
- **客戶分析**：客戶價值分析、消費行為分析
- **風險管控**：信用風險評估、交易風險控制
- **業務管理**：業務績效分析、客戶拜訪管理
- **行銷支援**：客戶分群、精準行銷

### 商業智能
- **消費分析**：消費趨勢、季節性分析
- **客戶生命週期**：客戶價值變化追蹤
- **市場分析**：地區、通路、行業分析
- **競爭分析**：競爭對手影響分析

### 使用場景
1. **客戶維護**：客戶資料詳細維護
2. **信用控制**：信用額度和風險管理
3. **業務分析**：業務績效和客戶分析
4. **行銷活動**：目標客戶篩選

### 維護作業
- **新增作業**：新客戶延伸資料建立
- **修改作業**：客戶延伸資料維護
- **刪除作業**：客戶延伸資料邏輯刪除
- **批次作業**：大量客戶資料處理
- **同步作業**：多系統客戶資料同步

### 效能考量
1. **索引最佳化**：多個輔助索引提升查詢效能
2. **資料分割**：可考慮按地區或客戶等級分割
3. **快取策略**：VIP客戶資料優先快取
4. **查詢最佳化**：複合索引支援複雜查詢

### 安全控制
- **客戶隱私**：敏感資料加密保護
- **存取權限**：依業務員權限控制
- **稽核記錄**：完整的客戶資料異動記錄
- **資料遮罩**：敏感資料顯示遮罩

### 資料品質
1. **完整性檢查**：關鍵客戶資訊完整性
2. **格式檢查**：電話、電郵、統編格式
3. **邏輯檢查**：日期邏輯、金額合理性
4. **重複檢查**：避免客戶資料重複
5. **更新檢查**：定期更新客戶狀態

### 使用注意事項
1. 此為實體檔案，可直接進行 CRUD 操作
2. 異動時需更新 MJ61、MJ62、MJ63 等異動資訊
3. 客戶狀態變更需檢查相關業務影響
4. 信用額度調整需要授權
5. 重要客戶資料異動建議先備份 