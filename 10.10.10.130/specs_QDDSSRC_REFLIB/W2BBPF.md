# W2BBPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | W2BBPF |
| 檔案類型 | 實體檔 (PF) |
| 檔案描述 | 後台銷售明細檔 |
| 主鍵 | BB01 + BB02 |
| 作業系統 | AS/400 |
| 資料庫 | DB2/400 |

## 2. 檔案功能說明

此檔案為後台銷售系統的核心明細檔案，記錄每筆銷售交易的詳細商品明細資訊。主要功能：
- 儲存後台銷售的商品明細記錄
- 管理銷售數量、寄出數量、確認數量
- 支援多層次成本結構(FOB/FHI/DUTY)
- 提供銷售明細的狀態管理
- 追蹤銷售明細的建立及異動記錄

## 3. 系統檔案清單

| 項目 | 檔案名稱 | 類型 | 說明 |
|------|----------|------|------|
| 主檔 | W2BBPF | PF | 後台銷售明細檔 |
| 邏輯檔1 | W2BBLF01 | LF | 銷售編號+商品代號排序 |
| 邏輯檔2 | W2BBLF02 | LF | 銷售編號+銷售單號排序(狀態篩選) |
| 邏輯檔3 | W2BBLF03 | LF | 三重複合索引排序 |
| 邏輯檔4 | W2BBLF04 | LF | 商品代號+銷售編號倒序 |

## 4. 紀錄格式

### 記錄格式：BB0

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|----------|------|------|------|------|------|
| BB01 | 銷售編號 | 1 | 12 | A | 主鍵 | 後台銷售編號 |
| BB02 | 銷售單號 | 13 | 6 | S | 主鍵 | 銷售單號 |
| BB03 | 商品代號 | 19 | 9 | A | 索引 | 商品識別代號 |
| BB04 | 銷售數量 | 28 | 8 | S | 必填 | 銷售數量 |
| BB05 | 寄出數量 | 36 | 8 | S | - | 實際寄出數量 |
| BB06 | 確認數量 | 44 | 8 | S | - | 確認收貨數量 |
| BB07 | 單價 | 52 | 11 | S(2) | 必填 | 銷售單價 |
| BB08 | FOB單價 | 63 | 9 | S(2) | - | FOB成本單價 |
| BB08A | FHI單價 | 72 | 9 | S(2) | - | FHI成本單價 |
| BB08B | DUTY單價 | 81 | 9 | S(2) | - | 關稅成本單價 |
| BB09 | 狀態 | 90 | 1 | A | 索引 | 處理狀態代碼 |
| BB10 | 備註 | 91 | 128 | O | - | 備註說明 |
| BB11 | 指派記號 | 219 | 1 | A | - | 指派標記 |
| BBXX | 建立日期 | 220 | 8 | S | 系統 | 記錄建立日期 |
| BBYY | 建立時間 | 228 | 6 | S | 系統 | 記錄建立時間 |
| BBZZ | 建立人員 | 234 | 10 | A | 系統 | 記錄建立人員 |

## 5. 主鍵欄位

| 順序 | 欄位代號 | 欄位名稱 | 約束條件 |
|------|----------|----------|----------|
| 1 | BB01 | 銷售編號 | NOT NULL |
| 2 | BB02 | 銷售單號 | NOT NULL |

**唯一性約束：** UNIQUE (BB01, BB02)

## 6. 索引資料

### 主索引
- **索引名稱**：BB0_PRIMARY
- **索引欄位**：BB01 + BB02
- **索引類型**：PRIMARY KEY, UNIQUE
- **排序方式**：遞增

### 輔助索引
- **商品索引**：BB03 (商品代號)
- **狀態索引**：BB09 (處理狀態)
- **建立日期索引**：BBXX (建立日期)

## 7. 使用說明

### 資料維護
- 新增：透過銷售系統自動產生明細記錄
- 修改：支援數量及狀態欄位的異動
- 刪除：配合銷售主檔刪除時同步刪除

### 狀態管理
- **O**：進行中(Order)
- **B**：已完成(Billed)
- **其他**：依系統定義的狀態代碼

### 數量控制
- **銷售數量(BB04)**：原始訂購數量
- **寄出數量(BB05)**：實際寄出數量
- **確認數量(BB06)**：客戶確認收貨數量

### 成本結構
- **FOB成本(BB08)**：Free On Board成本
- **FHI成本(BB08A)**：Freight & Handling & Insurance成本
- **DUTY成本(BB08B)**：關稅成本

## 8. 備註

- 檔案採用UNIQUE約束確保明細記錄唯一性
- 支援多層次的成本結構管理
- 提供完整的數量流程控制機制
- 系統自動記錄建立資訊便於追蹤
- 配合多個邏輯檔提供不同檢索需求
- 為後台銷售系統的核心明細檔案 