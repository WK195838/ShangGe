# SOSELF1 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSELF1
- **檔案類型**: LF (邏輯檔案)
- **基底檔案**: SOSEPF (送貨單主檔)
- **檔案說明**: 送貨單主檔邏輯檔案 - key=se06+se07+se02 (s)
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此邏輯檔案提供以送貨日期為主的遞減排序索引，專門用於已核准且具有核准狀態的送貨單查詢。

### 主要功能
- 送貨日期降序排列查詢
- 篩選已核准有效的送貨單
- 排除重複與無效記錄

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSEPF | PF | 送貨單主檔 (基底檔案) |
| SOSELF1 | LF | 送貨單主檔邏輯檔案 |

## 4. 紀錄格式

### 4.1 邏輯檔案設定
```
PFILE(SOSEPF)      // 基底實體檔案
```

### 4.2 關鍵欄位 (Key Fields)
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SE06 | 送貨日期 | N | 8,0 | DESC | 降序排列 |
| 2 | SE07 | 出貨訊息統計 | A | 8 | ASC | 次要排序鍵 |
| 3 | SE02 | 送貨單號 | A | 10 | ASC | 第三排序鍵 |

### 4.3 選擇條件 (SELECT/OMIT)
| 類型 | 欄位代號 | 條件 | 值 | 說明 |
|------|----------|------|----|----|
| OMIT | SE07 | COMP(EQ) | SE26 | 排除出貨訊息統計等於原送貨訊息統計 |
| OMIT | SE20 | COMP(EQ) | 0 | 排除列印數量為零 |
| OMIT | SE36 | COMP(NE) | ' ' | 排除核准狀態為非空白 |
| OMIT | SE40 | COMP(NE) | ' ' | 排除確認狀態非空白 |
| SELECT | SE31 | COMP(EQ) | '*' | 發貨狀態為已發貨 |
| SELECT | SE31 | COMP(EQ) | ' ' | 或發貨狀態為空白 |

## 5. 主鍵欄位
- **主要鍵值**: SE06 (送貨日期) + SE07 (出貨訊息統計) + SE02 (送貨單號)
- **排序方式**: 送貨日期降序，其餘升序
- **索引類型**: 複合索引

## 6. 索引資料
- **排序方式**: SE06(遞減) + SE07 + SE02
- **索引類型**: 復合索引，最新送貨記錄優先
- **特殊屬性**: 送貨日期遞減排序

## 7. 使用說明

### 7.1 檔案用途
- 最新已核准送貨單查詢
- 送貨記錄查詢
- 配送狀態監控

### 7.2 程式存取方式
```rpg
// 讀取最新送貨記錄
SETLL (*HIVAL) SOSELF1;
READP SOSELF1;
// 依特定日期範圍讀取
SETLL (結束日期) SOSELF1;
READP SOSELF1;
```

## 8. 備註
- 專注於有效送貨記錄的即時查詢
- 提供最新優先的資料顯示方式
- 支援送貨狀態的精確篩選
- 自動排除重複與無效記錄 