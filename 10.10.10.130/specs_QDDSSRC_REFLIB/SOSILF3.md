# SOSILF3 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSILF3
- **檔案類型**: LF (邏輯檔案)
- **基底檔案**: SOSIPF (發票主檔)
- **檔案說明**: 發票主檔邏輯檔案 - 轄區部門時序查詢
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此邏輯檔案提供轄區編號、部門編號、發票日期降序的複合排序，並篩選正常狀態且非重開的發票，適用於轄區部門導向的發票時序管理。

### 主要功能
- 轄區部門發票查詢
- 發票日期時序管理 (最新優先)
- 正常狀態發票篩選
- 轄區部門統計分析

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSIPF | PF | 發票主檔 (基底檔案) |
| SOSILF3 | LF | 發票主檔邏輯檔案 |

## 4. 紀錄格式

### 4.1 邏輯檔案設定
```
PFILE(SOSIPF)      // 基底實體檔案
```

### 4.2 關鍵欄位 (Key Fields)
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SI08 | 轄區編號 | A | 5 | ASC | 主要排序鍵 |
| 2 | SI09 | 部門編號 | A | 5 | ASC | 次要排序鍵 |
| 3 | SI21 | 發票日期 | N | 8,0 | DESC | 第三排序鍵 (降序) |

### 4.3 選擇條件 (SELECT/OMIT)
| 條件類型 | 欄位代號 | 條件 | 值 | 說明 |
|----------|----------|------|----|----|
| SELECT | SI18 | COMP | EQ ' ' | 狀態正常 |
| SELECT | SI19 | COMP | NE 'V' | 非重開發票 |

### 4.4 篩選邏輯說明
#### 正常狀態條件
| 欄位 | 條件 | 說明 |
|------|------|------|
| SI18 | = ' ' | 發票狀態正常 |
| SI19 | ≠ 'V' | 非重開發票 |

### 4.5 轄區部門管理
- **轄區分類**: 依SI08轄區編號分類
- **部門細分**: 依SI09部門編號進一步分類
- **時序排列**: 每個部門內按發票日期降序

## 5. 主鍵欄位
- **主要鍵值**: SI08 + SI09 + SI21
- **排序方式**: 轄區編號、部門編號升序，發票日期降序
- **索引類型**: 複合索引，組織架構導向

## 6. 索引資料
- **排序方式**: SI08 + SI09 + SI21(DESC)
- **索引類型**: 復合索引，支援組織查詢
- **特殊屬性**: 轄區部門分層，時序倒排

## 7. 使用說明

### 7.1 檔案用途
- 轄區部門發票查詢
- 組織架構發票統計
- 部門最新發票檢視
- 轄區發票時序分析

### 7.2 程式存取方式
```rpg
// 依轄區查詢發票
SETLL (轄區編號) SOSILF3;
READ SOSILF3;
// 依轄區部門查詢最新發票
CHAIN (轄區編號:部門編號) SOSILF3;
```

### 7.3 組織架構查詢
- **轄區層級**: 可查詢整個轄區的發票
- **部門層級**: 可查詢特定部門的發票
- **時序優勢**: 每層級內最新發票優先

### 7.4 統計分析應用
- **轄區統計**: 按轄區統計發票數量與金額
- **部門比較**: 轄區內各部門發票比較
- **時序分析**: 轄區部門發票趨勢分析

## 8. 備註
- 此邏輯檔案專為組織架構發票管理設計
- 提供轄區-部門二層分類結構
- 發票日期採降序排列，便於最新資料檢視
- 嚴格篩選正常有效發票，確保資料品質 