# SOSMLF5 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSMLF5
- **檔案類型**: LF (聯結邏輯檔案)
- **基底檔案**: SOSCPF (銷售訂單主檔), SOSEPF (送貨單主檔)
- **檔案說明**: 訂單送貨單聯結檔 - 業務人員完整確認狀態查詢
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此聯結邏輯檔案將銷售訂單主檔 (SOSCPF) 與送貨單主檔 (SOSEPF) 進行聯結，專門篩選特定部門代碼範圍並且所有確認狀態均為空白的記錄。

### 主要功能
- 業務人員導向的訂單送貨查詢
- 完整確認狀態篩選
- 特定部門代碼範圍處理

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSCPF | PF | 銷售訂單主檔 (主要檔案) |
| SOSEPF | PF | 送貨單主檔 (次要檔案) |
| SOSMLF5 | LF | 訂單送貨單聯結邏輯檔案 |

## 4. 紀錄格式

### 4.1 記錄格式 SC0 (基於 SOSCPF)
```
PFILE(SOSCPF)
KEY: SM16 + SM06 + SM02
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SM16 | 業務人員 | A | - | ASC | 主要排序鍵 |
| 2 | SM06 | 送貨日期 | N | 8,0 | ASC | 次要排序鍵 |
| 3 | SM02 | 訂單單號 | A | - | ASC | 三級排序鍵 |

#### 選擇條件 (SELECT/OMIT)
| 類型 | 欄位代號 | 條件 | 值 | 說明 |
|------|----------|------|----|----|
| OMIT | SM17 | COMP(EQ) | ' ' | 排除送貨單號為空白 |
| OMIT | SM03 | COMP(LE) | 'S0' | 排除部門代碼≤S0 |
| OMIT | SM03 | COMP(EQ) | 'S2' | 或排除部門代碼=S2 |
| SELECT | SM07 | COMP(EQ) | ' ' | 選擇訂單狀態為已確認 |
| SELECT | SM08 | COMP(EQ) | ' ' | 且總務確認為空白 |
| SELECT | SM09 | COMP(EQ) | ' ' | 且處理確認為空白 |
| SELECT | SM10 | COMP(EQ) | ' ' | 且保管確認為空白 |
| SELECT | SM11 | COMP(EQ) | ' ' | 且倉庫確認為空白 |
| SELECT | SM12 | COMP(EQ) | ' ' | 且應收確認為空白 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 來源欄位 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|----------|------|------|------|----------|
| SM01 | 客戶編號 | SC01 | A | - | RENAME | 客戶基本資料 |
| SM02 | 訂單單號 | SC02 | A | - | Key,RENAME | 訂單唯一識別 |
| SM03 | 部門 | SC03 | A | - | RENAME | 業務部門(篩選用) |
| SM04 | 客戶代號 | SC04 | A | - | RENAME | 客戶代號 |
| SM05 | 聯絡代號 | SC05 | A | - | RENAME | 聯絡人代號 |
| SM06 | 送貨日期 | SC08 | N | 8,0 | Key,RENAME | 送貨日期 |
| SM07 | 訂單狀態 | SC13 | A | 1 | RENAME | 訂單確認狀態 |
| SM08 | 總務確認狀態記號 | SC22 | A | 1 | RENAME | 總務確認 |
| SM09 | 處理確認狀態記號 | SC23 | A | 1 | RENAME | 處理確認 |
| SM10 | 保管確認狀態記號 | SC24 | A | 1 | RENAME | 保管確認 |
| SM11 | 倉庫確認狀態記號 | SC25 | A | 1 | RENAME | 倉庫確認 |
| SM12 | 應收確認狀態記號 | SC26 | A | 1 | RENAME | 應收確認 |
| SM14 | 客戶地區 | SC31 | A | - | RENAME | 地區代號 |
| SM15 | 溫層 | SC12 | A | - | RENAME | 溫度層級 |
| SM16 | 業務人員 | SC27 | A | - | Key,RENAME | 業務人員代號 |
| SM17 | 送貨單號 | SC29 | A | - | RENAME | 關聯送貨單號 |

### 4.2 記錄格式 SE0 (基於 SOSEPF)
```
PFILE(SOSEPF)
KEY: SM16 + SM06 + SM02
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SM16 | 業務人員 | A | - | ASC | 主要排序鍵 |
| 2 | SM06 | 送貨日期 | N | 8,0 | ASC | 次要排序鍵 |
| 3 | SM02 | 送貨單號 | A | - | ASC | 三級排序鍵 |

#### 選擇條件 (SELECT/OMIT)
| 類型 | 欄位代號 | 條件 | 值 | 說明 |
|------|----------|------|----|----|
| OMIT | SM18 | COMP(EQ) | 0 | 排除印單數量為零 |
| OMIT | SM03 | COMP(LE) | 'D0' | 排除部門代碼≤D0 |
| OMIT | SM03 | COMP(EQ) | 'D2' | 或排除部門代碼=D2 |
| SELECT | SM07 | COMP(EQ) | ' ' | 選擇送貨狀態為已確認 |
| SELECT | SM08 | COMP(EQ) | ' ' | 且價格確認為空白 |
| SELECT | SM09 | COMP(EQ) | ' ' | 且處理確認為空白 |
| SELECT | SM10 | COMP(EQ) | ' ' | 且保管確認為空白 |
| SELECT | SM11 | COMP(EQ) | ' ' | 且倉庫確認為空白 |
| SELECT | SM13 | COMP(EQ) | ' ' | 且列印確認為空白 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 來源欄位 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|----------|------|------|------|----------|
| SM01 | 客戶編號 | SE01 | A | - | RENAME | 客戶基本資料 |
| SM02 | 送貨單號 | SE02 | A | - | Key,RENAME | 送貨單唯一識別 |
| SM03 | 部門 | SE03 | A | - | RENAME | 業務部門(篩選用) |
| SM04 | 路線代碼 | SE04 | A | - | RENAME | 配送路線 |
| SM05 | 銷貨代碼 | SE05 | A | - | RENAME | 銷貨類型 |
| SM06 | 送貨日期 | SE06 | N | 8,0 | Key,RENAME | 送貨執行日期 |
| SM07 | 送貨狀態 | SE09 | A | 1 | RENAME | 送貨確認狀態 |
| SM08 | 價格確認狀態編號 | SE15 | A | 1 | RENAME | 價格確認 |
| SM09 | 處理確認狀態編號 | SE16 | A | 1 | RENAME | 處理確認 |
| SM10 | 保管確認狀態編號 | SE17 | A | 1 | RENAME | 保管確認 |
| SM11 | 倉庫確認狀態編號 | SE18 | A | 1 | RENAME | 倉庫確認 |
| SM13 | 列印確認狀態編號 | SE19 | A | 1 | RENAME | 列印確認 |
| SM14 | 地區 | SE34 | A | - | RENAME | 地區代號 |
| SM15 | 溫層折扣 | SE08 | A | - | RENAME | 溫度層級折扣 |
| SM16 | 業務人員 | SE32 | A | - | Key,RENAME | 業務人員代號 |
| SM18 | 印單數量 | SE20 | N | - | RENAME | 印單數量統計 |

## 5. 主鍵欄位
- **SC0 記錄格式**: SM16 (業務人員) + SM06 (送貨日期) + SM02 (訂單單號)
- **SE0 記錄格式**: SM16 (業務人員) + SM06 (送貨日期) + SM02 (送貨單號)

## 6. 索引資料
| 記錄格式 | 排序方式 | 索引類型 | 說明 |
|----------|----------|----------|------|
| SC0 | SM16+SM06+SM02 | 三層複合索引 | 業務人員日期單號排序 |
| SE0 | SM16+SM06+SM02 | 三層複合索引 | 業務人員日期單號排序 |

## 7. 使用說明

### 7.1 檔案用途
- 業務人員導向的訂單送貨查詢
- 完整確認狀態篩選
- 特定部門代碼範圍處理

### 7.2 程式存取方式
```rpg
// 查詢特定業務人員的完整確認記錄
SETLL (業務人員:送貨日期) SOSMLF5;
READE (業務人員) SOSMLF5 %KDS SC0;
// 批次處理業務人員資料
SETLL (*LOVAL) SOSMLF5;
READ SOSMLF5 %KDS SE0;
```

## 8. 備註
- 此檔案專門處理完整確認狀態的訂單送貨記錄
- 複雜篩選條件：
  - 排除特定部門代碼範圍 (≤S0或=S2 / ≤D0或=D2)
  - 要求所有確認狀態均為空白
  - 排除空白送貨單號和零印單數量
- 按業務人員+日期+單號三層排序
- 適用於業務人員工作量分析和績效評估
- 主要用於後續處理需要完整確認的訂單送貨記錄 