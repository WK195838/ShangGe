# SOSIPF 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSIPF
- **檔案類型**: PF (實體檔案)
- **檔案說明**: 發票主檔 - 銷貨發票核心管理檔案
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)
- **參考檔案**: RERF (參考檔案)

## 2. 檔案功能說明
發票主檔是銷貨管理系統的核心檔案，儲存所有銷貨發票的主要資訊，包含客戶資料、發票金額、稅額計算、發票狀態管理等完整資訊。

### 主要功能
- 發票基本資料管理
- 發票狀態控制 (開立、作廢、重開、確認)
- 稅務計算與管理
- 客戶發票關聯
- 部門轄區管理
- 收款狀態追蹤

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSIPF | PF | 發票主檔 (實體檔案) |
| RERF | PF | 參考檔案 (欄位定義參考) |

## 4. 紀錄格式

### 4.1 實體檔案設定
```
REF(RERF)          // 參考檔案
UNIQUE             // 唯一鍵值設定
```

### 4.2 主要欄位規格
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 說明 |
|----------|----------|------|------|------|------|
| SI01 | 客戶編號 | A | 10 | - | 客戶識別碼 |
| SI02 | 發票號碼 | A | 10 | - | 發票識別號碼 |
| SI03 | 數量 | N | 9 | 2 | 銷貨數量 |
| SI04 | 單價 | N | 9 | 2 | 銷貨單價 |
| SI05 | 送貨點 | A | 5 | - | 送貨地點代號 |
| SI06 | 送貨日期 | N | 8 | 0 | 送貨日期 |
| SI07 | 檢查號碼 | A | 10 | - | 發票檢查碼 |
| SI08 | 轄區編號 | A | 5 | - | 業務轄區代號 |
| SI09 | 部門編號 | A | 5 | - | 所屬部門代號 |
| SI10 | 客戶類型 | A | 5 | - | 客戶分類代號 |
| SI11 | 送貨備註 | A | 30 | - | 送貨相關備註 |

### 4.3 發票狀態欄位
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 說明 |
|----------|----------|------|------|------|
| SI16 | 作廢發票 | A | 1 | Y-作廢發票 |
| SI18 | 狀態 | A | 1 | *-數量異常待處理, V-重開已完成 |
| SI19 | 重開發票 | A | 1 | 'V'-已重開 |
| SI20 | 確認狀態 | A | 1 | 'V'-已確認 |
| SI22 | 發單代號 | A | 1 | D-經銷, B-直銷, Z-零售 |
| SI34 | 經銷商標記 | A | 1 | Y-經銷商發票, ' '-非經銷商 |
| SI36 | 發票形式 | A | 1 | E-電子發票, ' '-非電子發票 |

### 4.4 金額相關欄位
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 說明 |
|----------|----------|------|------|------|------|
| SI12 | 發票地址區碼 | A | 5 | - | 發票地址區域碼 |
| SI13 | 發票地址序號 | A | 5 | - | 發票地址序號 |
| SI21 | 發票日期 | N | 8 | 0 | 發票開立日期 |
| SI23 | 折扣金額 | N | 11 | 2 | 折扣金額 |
| SI24 | 運費 | N | 9 | 2 | 運輸費用 |
| SI25 | 發票金額 | N | 11 | 2 | 發票總金額 |
| SI26 | 已收金額 | N | 11 | 2 | 已收款金額 |
| SI27 | 營業稅額 | N | 9 | 2 | 營業稅金額 |
| SI28 | 折扣金額 | N | 9 | 2 | 總折扣金額 |
| SI29 | 開票日期 | N | 8 | 0 | 開票日期 |
| SI30 | 應收金額 | N | 11 | 2 | 應收帳款金額 |

### 4.5 擴充欄位 (版本更新)
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 說明 | 版本 |
|----------|----------|------|------|------|------|------|
| SI37 | 重開日期 | N | 8 | 0 | 重開發票日期 | 00B |
| SI38 | 發票收送日期 | N | 8 | 0 | 發票收送日期 | 00B |
| SI39 | 重開發票收送日期 | N | 8 | 0 | 重開發票收送日期 | 00B |

### 4.6 系統欄位
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 說明 |
|----------|----------|------|------|------|
| SIXX | 異動日期 | N | 8,0 | 記錄異動日期 |
| SIYY | 異動時間 | N | 6,0 | 記錄異動時間 |
| SIZZ | 異動人員 | A | 10 | 記錄異動人員 |

## 5. 主鍵欄位
- **主要鍵值**: SI01 + SI02
- **排序方式**: 客戶編號、發票號碼升序
- **索引類型**: 複合主鍵，唯一性約束

## 6. 索引資料
- **主鍵**: SI01 + SI02 (客戶編號 + 發票號碼)
- **唯一性**: UNIQUE 約束
- **參考完整性**: 與客戶主檔關聯

## 7. 使用說明

### 7.1 檔案用途
- 發票資料集中管理
- 發票狀態生命週期追蹤
- 客戶發票關聯管理
- 財務稅務資料維護
- 收款狀態管理

### 7.2 程式存取方式
```rpg
// 新增發票記錄
CHAIN (客戶編號:發票號碼) SOSIPF;
IF NOT %FOUND(SOSIPF);
  CLEAR SI0;
  SI01 = 客戶編號;
  SI02 = 發票號碼;
  WRITE SI0;
ENDIF;

// 更新發票狀態
CHAIN (客戶編號:發票號碼) SOSIPF;
IF %FOUND(SOSIPF);
  SI20 = 'V';  // 設為已確認
  UPDATE SI0;
ENDIF;
```

### 7.3 狀態管理邏輯
- **SI16**: 作廢控制 ('Y'=作廢)
- **SI19**: 重開追蹤 ('V'=已重開)
- **SI20**: 確認狀態 ('V'=已確認)
- **SI22**: 發票類型 (D/B/Z)

## 8. 備註
- 發票主檔為銷貨系統核心檔案，資料完整性極為重要
- 支援電子發票與傳統發票混合管理
- 提供完整的發票生命週期狀態追蹤
- 金額欄位採高精度設計，確保財務計算準確性
- 版本控制完善，支援系統功能擴充需求 