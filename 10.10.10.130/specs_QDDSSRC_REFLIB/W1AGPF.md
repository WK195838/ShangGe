# W1AGPF 檔案規格書

## 1. 基本資料
- **檔案名稱**: W1AGPF
- **檔案描述**: 前台調撥明細檔
- **檔案類型**: 實體檔案 (PF)
- **記錄格式**: AG0
- **主鍵**: AG01 + AG02 (UNIQUE約束)
- **用途**: 記錄前台調撥明細交易資料
- **相關系統**: 前台調撥管理系統

## 2. 檔案功能說明
W1AGPF檔案主要用於：
- 記錄前台調撥明細交易資料
- 管理調撥發貨號與商品代號對應關係
- 追蹤調撥商品數量與確認數量
- 維護調撥明細狀態資訊

## 3. 系統檔案清單
### 主檔案
- W1AGPF: 前台調撥明細檔

### 相關檔案
- W1AFPF: 前台調撥主檔
- W1AGWF: 前台調撥明細檔(工作檔)

## 4. 紀錄格式

### 記錄: AG0
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| AG01 | 調撥發貨號 | 1-12 | 12 | A | 主鍵1 | 必填，不可重複 |
| AG02 | 商品代號 | 13-21 | 9 | A | 主鍵2 | 必填，不可重複 |
| AG03 | 數量 | 22-29 | 8 | S 0 | - | 調撥數量 |
| AG04 | 確認數量 | 30-37 | 8 | S 0 | - | 實際確認數量 |
| AG05 | 狀態 | 38 | 1 | A | - | 明細狀態 |
| AG06 | 數量 | 39-102 | 64 | O | - | 包裝數量 |
| AGXX | 異動日期 | 103-110 | 8 | S 0 | - | YYYYMMDD格式 |
| AGYY | 異動時間 | 111-116 | 6 | S 0 | - | HHMMSS格式 |
| AGZZ | 異動人員 | 117-126 | 10 | A | - | 異動者代號 |

## 5. 主鍵欄位
- **主鍵組合**: AG01 + AG02
- **唯一性約束**: UNIQUE
- **索引**: 複合索引 (調撥發貨號 + 商品代號)

## 6. 索引資料
### 主要索引
- **索引1**: AG01 + AG02 (主鍵，唯一性)

### 索引結構
```
KEY: AG01 (調撥發貨號) + AG02 (商品代號)
```

## 7. 使用說明
### 新增作業
1. 指定調撥發貨號(AG01)
2. 輸入商品代號(AG02)
3. 設定調撥數量與確認數量
4. 記錄明細狀態
5. 系統自動記錄異動資訊

### 查詢作業
1. 可依調撥發貨號查詢
2. 可依商品代號查詢
3. 支援複合條件查詢
4. 可查詢特定狀態明細

### 維護作業
1. 調撥發貨號與商品代號組合不可重複
2. 可修改數量與確認數量
3. 商品代號須為有效代碼
4. 數量欄位不可為負數
5. 系統記錄完整異動軌跡

## 8. 備註
- 檔案具有UNIQUE約束，確保調撥發貨號與商品代號組合唯一性
- 同時記錄計劃數量(AG03)與確認數量(AG04)，支援差異管理
- 額外的數量欄位(AG06)為64位元OPEN型態，支援大容量資料
- 明細狀態控制調撥明細流程進度 