# SOSOPF 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSOPF
- **檔案類型**: PF (實體檔案)
- **檔案說明**: 產品收回明細檔 - 退回商品明細核心檔案
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)
- **檔案屬性**: REF(RERF), UNIQUE

## 2. 檔案功能說明
此實體檔案為產品收回管理系統的明細檔案，記錄每筆收回單的商品明細資訊，包含數量、金額、商品規格等詳細資料。

### 主要功能
- 產品收回明細資料管理
- 退回商品數量統計
- 退回金額計算
- 商品溫層管理
- 記帳單位控制

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSOPF | PF | 產品收回明細檔 (實體檔案) |
| SOSNPF | PF | 產品收回主檔 (關聯檔案) |
| RERF | PF | 參考檔案 |

## 4. 紀錄格式

### 4.1 記錄格式 SO0
```
REF(RERF)
UNIQUE
KEY: SO02 + SO03
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SO02 | 收回單號 | A | - | ASC | 主要主鍵 |
| 2 | SO03 | 商品代號 | A | - | ASC | 次要主鍵 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SO01 | 客戶編號 | A | - | - | R | 客戶基本資料參考 |
| SO02 | 收回單號 | A | - | - | Key,R | 收回單唯一識別碼，主要主鍵 |
| SO03 | 商品代號 | A | - | - | Key,R | 商品項目代號，次要主鍵 |
| SO04 | 退回數量盒裝合計 | N | - | - | R | 退回數量統計，盒裝計算 |
| SO05 | 確認數量 | N | - | - | R | 確認退回數量 |
| SO06 | 退回數量瓶裝量計 | N | - | - | R | 瓶裝數量統計 |
| SO07 | 退回數量瓶裝重計 | N | - | - | R | 瓶裝重量統計 |
| SO08 | 退回日期 | N | 8 | 0 | R | 退回處理日期，必須為有效日期格式 |
| SO09 | 出貨商品項目代號 | A | - | - | R | 原出貨商品項目 |
| SO10 | 退貨商品項目代號 | A | - | - | R | 退回商品項目 |
| SO11 | 商品類別 | A | - | - | R | 商品分類代號 |
| SO12 | 溫層 | A | - | - | R | 產品溫度層級 |
| SO13 | 應付FOB-TOT | N | - | - | R | FOB價格總計 |
| SO14 | 應付FHI-TOT | N | - | - | R | FHI價格總計 |
| SO15 | 應付DUTY-TOT | N | - | - | R | 關稅總計 |
| SO16 | 退回FOB-TOT | N | - | - | R | 退回FOB價格總計 |
| SO17 | 退回FHI-TOT | N | - | - | R | 退回FHI價格總計 |
| SO18 | 退回DUTY-TOT | N | - | - | R | 退回關稅總計 |
| SO19 | 備註一 | A | 12 | - | A | 備註欄位一(M007新增) |
| SO20 | 備註二 | A | 12 | - | A | 備註欄位二 |
| SO21 | 備註三 | A | 12 | - | A | 備註欄位三 |
| SO22 | 數字一 | N | 11 | 2 | A | 數值欄位一 |
| SO23 | 數字二 | N | 11 | 2 | A | 數值欄位二 |
| SO24 | 數字三 | N | 11 | 2 | A | 數值欄位三 |
| SO25 | 旗標一 | A | 1 | - | A | 旗標欄位一 |
| SO26 | 旗標二 | A | 1 | - | A | 旗標欄位二 |
| SO27 | 旗標三 | A | 1 | - | A | 旗標欄位三 |
| SO99 | 記帳單位 | A | 2 | - | A | 記帳單位代號(M007新增) |
| SO98 | 記帳類別 | A | 1 | - | A | 記帳分類代號 |
| SOXX | 異動人員 | A | 8 | 0 | R | 異動人員代號 |
| SOYY | 異動時間 | N | - | - | R | 異動時間戳記 |
| SOZZ | 異動者 | A | - | - | R | 異動操作者 |

## 5. 主鍵欄位
- **主鍵**: SO02 + SO03 (收回單號 + 商品代號)
- **約束**: UNIQUE - 確保收回單號與商品代號組合唯一性

## 6. 索引資料
| 索引名稱 | 欄位組合 | 索引類型 | 說明 |
|----------|----------|----------|------|
| Primary | SO02 + SO03 | 複合主鍵索引 | 收回單號與商品代號組合索引 |

## 7. 使用說明

### 7.1 檔案用途
- 產品收回明細作業管理
- 退回商品數量統計
- 退回金額計算
- 商品溫層管理
- 記帳單位控制

### 7.2 程式存取方式
```rpg
// 新增明細記錄
WRITE SOSOPF;
// 查詢明細記錄
CHAIN (收回單號:商品代號) SOSOPF;
// 更新明細記錄
UPDATE SOSOPF;
// 刪除明細記錄
DELETE SOSOPF;
```

### 7.3 檔案維護
- 定期備份重要的收回明細資料
- 監控檔案成長狀況
- 與主檔案同步維護

## 8. 備註
- 此檔案採用 REF(RERF) 參考檔案設計
- UNIQUE 約束確保收回單號與商品代號組合唯一性
- 與產品收回主檔(SOSNPF)一對多關係
- M007修改：新增備註欄位、記帳單位等欄位
- 支援完整的異動追蹤機制
- 包含完整的數量統計功能：盒裝、瓶裝數量及重量
- 包含完整的金額計算：FOB、FHI、DUTY等價格總計
- 支援產品溫層管理功能
- 主要用於產品收回明細的完整管理
- 與相關邏輯檔案配合提供多維度查詢功能 