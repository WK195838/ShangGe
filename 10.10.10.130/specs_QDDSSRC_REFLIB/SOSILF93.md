# SOSILF93 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSILF93
- **檔案類型**: LF (邏輯檔案)
- **基底檔案**: SOSIPF (發票主檔)
- **檔案說明**: 發票主檔邏輯檔案 - 地址確認金額管理
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此邏輯檔案提供發票地址區碼、發票日期降序、發票號碼的複合排序，並設有應收金額非零、非重開發票及確認金額非零的篩選條件，適用於地址導向的金額確認管理。

### 主要功能
- 地址確認金額查詢
- 發票日期時序管理 (最新優先)
- 應收與確認金額篩選
- 地址別金額確認統計

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSIPF | PF | 發票主檔 (基底檔案) |
| SOSILF93 | LF | 發票主檔邏輯檔案 |

## 4. 紀錄格式

### 4.1 邏輯檔案設定
```
PFILE(SOSIPF)      // 基底實體檔案
```

### 4.2 關鍵欄位 (Key Fields)
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SI12 | 發票地址區碼 | A | 5 | ASC | 主要排序鍵 |
| 2 | SI21 | 發票日期 | N | 8,0 | DESC | 次要排序鍵 (降序) |
| 3 | SI02 | 發票號碼 | A | 10 | ASC | 第三排序鍵 |

### 4.3 選擇條件 (SELECT/OMIT)
| 條件類型 | 欄位代號 | 條件 | 值 | 說明 |
|----------|----------|------|----|----|
| SELECT | SI30 | COMP | NE 0 | 應收金額非零 |
| SELECT | SI19 | COMP | NE 'V' | 非重開發票 |
| SELECT | SI35 | COMP | NE 0 | 確認金額非零 |

### 4.4 篩選邏輯說明
#### 金額篩選條件
| 欄位 | 條件 | 說明 |
|------|------|------|
| SI30 | ≠ 0 | 應收金額必須有值 |
| SI35 | ≠ 0 | 確認金額必須有值 |

#### 狀態篩選條件
| 欄位 | 條件 | 說明 |
|------|------|------|
| SI19 | ≠ 'V' | 必須為非重開發票 |

### 4.5 確認金額管理
此檔案專門用於管理同時有應收金額與確認金額的正常發票

## 5. 主鍵欄位
- **主要鍵值**: SI12 + SI21 + SI02
- **排序方式**: 地址區碼升序，發票日期降序，發票號碼升序
- **索引類型**: 複合索引，地址導向三層排序

## 6. 索引資料
- **排序方式**: SI12 + SI21(DESC) + SI02
- **索引類型**: 復合索引，支援地址金額確認查詢
- **特殊屬性**: 發票日期降序，雙重金額篩選

## 7. 使用說明

### 7.1 檔案用途
- 地址確認金額查詢
- 金額確認流程管理
- 地址別金額統計
- 應收確認差異分析

### 7.2 程式存取方式
```rpg
// 依地址區碼查詢確認金額發票
SETLL (地址區碼) SOSILF93;
READ SOSILF93;
// 依地址和日期查詢
CHAIN (地址區碼:發票日期) SOSILF93;
// 處理地址確認金額
DOW NOT %EOF(SOSILF93) AND SI12 = 地址區碼;
  // 檢查應收與確認金額
  IF SI30 <> SI35;
    // 處理差異邏輯
  ENDIF;
  READ SOSILF93;
ENDDO;
```

### 7.3 地址管理特色
- **地址導向**: 以地址區碼為主要分類
- **時序優勢**: 每地址內最新發票優先
- **金額追蹤**: 專門管理有雙重金額的發票

### 7.4 確認金額應用
- **確認流程**: 依地址進行金額確認管理
- **差異分析**: 應收與確認金額比對
- **統計報表**: 地址別確認金額統計

## 8. 備註
- 此邏輯檔案專為地址確認金額管理設計
- 嚴格篩選同時有應收與確認金額的正常發票
- 支援地址導向的金額確認與差異分析作業
- 發票日期降序排列，便於最新資料優先處理 