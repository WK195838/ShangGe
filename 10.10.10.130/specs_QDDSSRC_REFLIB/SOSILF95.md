# SOSILF95 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSILF95
- **檔案類型**: LF (邏輯檔案)
- **基底檔案**: SOSIPF (發票主檔)
- **檔案說明**: 發票主檔邏輯檔案 - 視窗查詢經銷商發票專用
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此邏輯檔案提供客戶編號、發票號碼的基本排序，並設有複雜的OMIT條件與SELECT條件，專門用於視窗介面的經銷商發票查詢，排除特定狀態並保留經銷商發票。

### 主要功能
- 視窗介面經銷商發票查詢
- 複雜狀態條件排除組合
- 發票號碼範圍限制
- 經銷商發票專用篩選

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSIPF | PF | 發票主檔 (基底檔案) |
| SOSILF95 | LF | 發票主檔邏輯檔案 |

## 4. 紀錄格式

### 4.1 邏輯檔案設定
```
PFILE(SOSIPF)      // 基底實體檔案
```

### 4.2 關鍵欄位 (Key Fields)
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SI01 | 客戶編號 | A | 10 | ASC | 主要排序鍵 |
| 2 | SI02 | 發票號碼 | A | 10 | ASC | 次要排序鍵 |

### 4.3 選擇條件 (SELECT/OMIT)
#### OMIT條件 (排除以下情況)
| 條件類型 | 欄位代號 | 條件 | 值 | 說明 |
|----------|----------|------|----|----|
| OMIT | SI02 | RANGE | '**        ' to '**99999999' | 排除特殊發票號碼範圍 |
| OMIT | SI16 | COMP | EQ 'Y' | 排除作廢發票 |
| OMIT | SI20 | COMP | EQ 'V' | 排除已確認發票 |

#### SELECT條件
| 條件類型 | 欄位代號 | 條件 | 值 | 說明 |
|----------|----------|------|----|----|
| SELECT | SI18 | COMP | EQ ' ' | 狀態正常 |
| SELECT | SI19 | COMP | EQ ' ' | 非重開發票 |
| SELECT | SI34 | COMP | EQ 'Y' | 經銷商發票 |

### 4.4 篩選邏輯說明
#### 排除條件詳解
| 排除類型 | 說明 |
|----------|------|
| 特殊號碼 | 排除以'**'開頭的發票號碼 |
| 作廢發票 | SI16='Y' 作廢狀態發票 |
| 已確認發票 | SI20='V' 已確認狀態發票 |

#### 保留條件 (AND邏輯)
| 條件 | 說明 |
|------|------|
| SI18=' ' | 狀態正常的發票 |
| SI19=' ' | 原始發票 (非重開) |
| SI34='Y' | 經銷商標記發票 |

### 4.5 經銷商視窗查詢特色
專門設計用於視窗介面的經銷商發票管理

## 5. 主鍵欄位
- **主要鍵值**: SI01 + SI02
- **排序方式**: 客戶編號、發票號碼升序
- **索引類型**: 複合索引，客戶導向

## 6. 索引資料
- **排序方式**: SI01 + SI02
- **索引類型**: 復合索引，支援經銷商視窗查詢
- **特殊屬性**: 複雜OMIT+SELECT組合，經銷商專用

## 7. 使用說明

### 7.1 檔案用途
- 視窗介面經銷商發票查詢
- 經銷商發票清單顯示
- 客戶經銷商發票瀏覽
- 排除非經銷商發票

### 7.2 程式存取方式
```rpg
// 視窗經銷商客戶發票查詢
SETLL (客戶編號) SOSILF95;
READ SOSILF95;
// 視窗經銷商發票清單顯示
DOW NOT %EOF(SOSILF95) AND SI01 = 客戶編號;
  // 顯示經銷商發票資料
  READ SOSILF95;
ENDDO;
```

### 7.3 經銷商視窗特色
- **專用篩選**: 只顯示經銷商發票 (SI34='Y')
- **乾淨清單**: 排除作廢、已確認發票
- **範圍限制**: 排除系統內部發票號碼
- **狀態保證**: 只顯示正常狀態的原始發票

### 7.4 與SOSILF92差異
| 項目 | SOSILF92 | SOSILF95 |
|------|----------|----------|
| 用途 | 一般發票查詢 | 經銷商發票查詢 |
| SI34條件 | OMIT EQ 'Y' | SELECT EQ 'Y' |
| 適用對象 | 一般客戶發票 | 經銷商發票 |

### 7.5 經銷商管理應用
- **經銷商篩選**: 專門管理經銷商發票
- **視窗友善**: 適合視窗介面操作
- **狀態控制**: 確保查詢結果為有效經銷商發票

## 8. 備註
- 此邏輯檔案專為經銷商視窗介面設計
- 與SOSILF92形成互補，分別處理一般發票與經銷商發票
- 提供複雜的OMIT+SELECT組合，確保經銷商發票查詢結果乾淨
- 支援經銷商發票號碼範圍查詢功能 