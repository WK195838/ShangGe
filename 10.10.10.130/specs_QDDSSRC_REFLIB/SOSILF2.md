# SOSILF2 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSILF2
- **檔案類型**: LF (邏輯檔案)
- **基底檔案**: SOSIPF (發票主檔)
- **檔案說明**: 發票主檔邏輯檔案 - 數量待確認發票管理
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此邏輯檔案專為數量待確認發票管理設計，提供客戶編號、發票日期降序、發票號碼的複合排序，並篩選數量待確認且非作廢的發票，適用於發票數量確認作業。

### 主要功能
- 數量待確認發票查詢
- 客戶發票時序管理 (最新優先)
- 非作廢發票篩選
- 發票確認作業支援

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSIPF | PF | 發票主檔 (基底檔案) |
| SOSILF2 | LF | 發票主檔邏輯檔案 |

## 4. 紀錄格式

### 4.1 邏輯檔案設定
```
PFILE(SOSIPF)      // 基底實體檔案
```

### 4.2 關鍵欄位 (Key Fields)
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SI01 | 客戶編號 | A | 10 | ASC | 主要排序鍵 |
| 2 | SI21 | 發票日期 | N | 8,0 | DESC | 次要排序鍵 (降序) |
| 3 | SI02 | 發票號碼 | A | 10 | ASC | 第三排序鍵 |

### 4.3 選擇條件 (SELECT/OMIT)
| 條件類型 | 欄位代號 | 條件 | 值 | 說明 |
|----------|----------|------|----|----|
| SELECT | SI16 | COMP | NE 'Y' | 非作廢發票 |
| SELECT | SI18 | COMP | EQ '*' | 數量待確認狀態 |

### 4.4 篩選邏輯說明
#### 發票有效性
| 欄位 | 條件 | 說明 |
|------|------|------|
| SI16 | ≠ 'Y' | 排除作廢發票 |

#### 確認狀態
| 欄位 | 條件 | 說明 |
|------|------|------|
| SI18 | = '*' | 數量待確認狀態 |

### 4.5 狀態說明
- **SI18 = '*'**: 數量異常待確認發票
- **用途**: 發票數量需要人工確認的特殊狀態

## 5. 主鍵欄位
- **主要鍵值**: SI01 + SI21 + SI02
- **排序方式**: 客戶編號升序，發票日期降序，發票號碼升序
- **索引類型**: 複合索引，客戶時序導向

## 6. 索引資料
- **排序方式**: SI01 + SI21(DESC) + SI02
- **索引類型**: 復合索引，支援確認作業
- **特殊屬性**: 發票日期降序，數量待確認篩選

## 7. 使用說明

### 7.1 檔案用途
- 數量待確認發票查詢
- 客戶最新待確認發票檢視
- 發票數量確認作業
- 異常發票狀態管理

### 7.2 程式存取方式
```rpg
// 依客戶編號查詢待確認發票
SETLL (客戶編號) SOSILF2;
READ SOSILF2;
// 處理數量待確認發票
DOW NOT %EOF(SOSILF2) AND SI01 = 客戶編號;
  // 處理確認邏輯
  READ SOSILF2;
ENDDO;
```

### 7.3 確認作業流程
1. **查詢**: 依客戶查詢數量待確認發票
2. **檢視**: 按日期倒序檢視最新待確認發票
3. **確認**: 處理數量確認作業
4. **更新**: 更新發票狀態為正常

### 7.4 狀態轉換
- **SI18**: '*' → ' ' (待確認 → 正常)

## 8. 備註
- 此邏輯檔案專為發票數量確認作業設計
- 發票日期採降序排列，優先處理最新待確認發票
- 嚴格篩選有效且待確認的發票
- 支援客戶導向的發票確認作業流程 