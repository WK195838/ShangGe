# SOSILF9 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSILF9
- **檔案類型**: LF (邏輯檔案)
- **基底檔案**: SOSIPF (發票主檔)
- **檔案說明**: 發票主檔邏輯檔案 - 客戶地址時序複合查詢
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此邏輯檔案提供客戶編號、發票日期降序、發票地址區碼、發票地址序號、發票號碼的複合排序，並設有複雜的狀態篩選條件，適用於客戶地址導向的發票管理。

### 主要功能
- 客戶地址發票查詢
- 發票日期時序管理 (最新優先)
- 發票狀態篩選 (重開與正常狀態)
- 客戶地址統計分析

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSIPF | PF | 發票主檔 (基底檔案) |
| SOSILF9 | LF | 發票主檔邏輯檔案 |

## 4. 紀錄格式

### 4.1 邏輯檔案設定
```
PFILE(SOSIPF)      // 基底實體檔案
```

### 4.2 關鍵欄位 (Key Fields)
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SI01 | 客戶編號 | A | 10 | ASC | 主要排序鍵 |
| 2 | SI21 | 發票日期 | N | 8,0 | DESC | 次要排序鍵 (降序) |
| 3 | SI12 | 發票地址區碼 | A | 5 | ASC | 第三排序鍵 |
| 4 | SI13 | 發票地址序號 | A | 5 | ASC | 第四排序鍵 |
| 5 | SI02 | 發票號碼 | A | 10 | ASC | 第五排序鍵 |

### 4.3 選擇條件 (SELECT/OMIT)
| 條件類型 | 欄位代號 | 條件 | 值 | 說明 |
|----------|----------|------|----|----|
| OMIT | SI19 | COMP | NE 'V' | 排除非重開發票 |
| SELECT | SI18 | COMP | EQ '*' | 數量待確認狀態 |
| SELECT | SI18 | COMP | EQ ' ' | 正常狀態 |

### 4.4 篩選邏輯說明
#### 重開發票管理
| 欄位 | 條件 | 說明 |
|------|------|------|
| SI19 | NE 'V' | 排除非重開發票 (只保留重開發票) |

#### 狀態條件 (OR邏輯)
| 欄位 | 條件 | 說明 |
|------|------|------|
| SI18 | = '*' | 數量待確認狀態 |
| SI18 | = ' ' | 正常狀態 |

### 4.5 複合篩選說明
此檔案設計用於查詢「重開發票且為待確認或正常狀態」的記錄

## 5. 主鍵欄位
- **主要鍵值**: SI01 + SI21 + SI12 + SI13 + SI02
- **排序方式**: 客戶編號升序，發票日期降序，地址區碼、地址序號、發票號碼升序
- **索引類型**: 複合索引，五層排序

## 6. 索引資料
- **排序方式**: SI01 + SI21(DESC) + SI12 + SI13 + SI02
- **索引類型**: 復合索引，支援客戶地址時序查詢
- **特殊屬性**: 發票日期降序，複雜狀態篩選

## 7. 使用說明

### 7.1 檔案用途
- 客戶地址發票查詢
- 重開發票管理
- 客戶最新地址發票檢視
- 地址別發票統計

### 7.2 程式存取方式
```rpg
// 依客戶編號查詢重開發票
SETLL (客戶編號) SOSILF9;
READ SOSILF9;
// 依客戶和日期查詢
CHAIN (客戶編號:發票日期) SOSILF9;
// 依客戶地址查詢最新發票
CHAIN (客戶編號:發票日期:地址區碼:地址序號) SOSILF9;
```

### 7.3 地址管理特色
- **地址分層**: 區碼 + 序號雙重定位
- **時序優勢**: 每地址內最新發票優先
- **重開追蹤**: 專門管理重開發票

### 7.4 狀態管理應用
- **重開發票**: 專門查詢重開的發票
- **狀態篩選**: 只顯示有效狀態的發票
- **確認流程**: 支援待確認發票管理

## 8. 備註
- 此邏輯檔案專為重開發票與地址管理設計
- 提供客戶-地址-時序複合查詢功能
- 發票日期採降序排列，便於最新資料檢視
- 特殊的OMIT+SELECT組合，實現複雜篩選邏輯 