# REWFA8 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | REWFA8 |
| 檔案類型 | 實體檔 (PF) |
| 檔案說明 | 銷貨退回主檔明細 |
| 主索引鍵 | (依KEY欄位設計) |
| 參照檔案 | RERF |
| 建立日期 | (依實際建立日期填入) |
| 維護人員 | (依實際維護人員填入) |

## 2. 檔案功能說明

此實體檔案用於管理銷貨退回主檔與明細資料，整合退貨基本資訊與詳細明細，支援完整的退貨作業流程管理與確認機制。

### 主要功能
- 管理銷貨退回主檔資料
- 記錄退貨明細資訊
- 支援退貨確認流程
- 管理多種成本計算

## 3. 系統檔案清單

| 檔案名稱 | 檔案類型 | 說明 | 關聯 |
|----------|----------|------|------|
| REWFA8 | PF | 銷貨退回主檔明細 | 主檔案 |
| RERF | PF | 參照檔案 | REF參照 |

## 4. 記錄格式

### 記錄格式名稱：SG0 (主檔)、SH0 (明細)

| 格式說明 | 記錄長度 | 參照檔案 |
|----------|----------|----------|
| 銷貨退回主檔明細記錄格式 | (依欄位定義計算) | RERF |

## 5. 欄位規格

### 5.1 銷貨退回主檔欄位 (SG系列)
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SG01 | 公司編號 | 1 | R | 文字 | | 公司別 |
| SG02 | 退貨單號 | 2 | R | 文字 | | 退貨單編號 |
| SG03 | 年度 | 3 | R | 文字 | | 年度 |
| SG04 | 幣別代碼 | 4 | R | 文字 | | 幣別代碼 |
| SG05 | 排序代碼 | 5 | R | 文字 | | 排序識別 |
| SG06 | 退貨日期 | 6 | R | 日期 | 8 00, B2CHKA | 退貨日期 |
| SG07 | 退回倉庫 | 7 | R | 文字 | | 退回倉庫 |
| SG08 | 退貨原因 | 8 | R | 文字 | | 退貨原因 |
| SG09 | 原單號 | 9 | R | 文字 | | 原銷貨單號 |
| SG10 | 銷退金額處理 | 10 | R | 數值 | | 銷退金額 |
| SG11 | 產品名稱 | 11 | R | 文字 | | 產品名稱 |
| SG12 | 稅別編號 | 12 | R | 文字 | | 稅別編號 |
| SG13 | 銷退總計運費金額 | 13 | R | 數值 | | 總計運費 |

### 5.2 退貨確認狀態欄位
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SG14 | 業務 | 14 | R | 文字 | | 業務人員 |
| SG15 | 地區 | 15 | R | 文字 | | 地區 |
| SG16 | 結帳年度 | 16 | R | 文字 | | 結帳年度 |
| SG17 | 原退貨單號 | 17 | R | 文字 | | 原退貨單號 |
| SG18 | 調整單號 | 18 | R | 文字 | | 調整單號 |

### 5.3 退貨狀態控制說明
根據註解資訊，SG14 業務欄位狀態包含：
- **'*'**：待確認
- **' '**：不須確認或已確認  
- **'V'**：已驗收確認
- **'A'**：已結帳
- **'N'**：無法結帳(結帳處理時重新)

### 5.4 退貨成本欄位
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SG19 | 銷退成本-FOB | 19 | R | 數值 | | FOB成本 |
| SG20 | 銷退成本-FHI | 20 | R | 數值 | | FHI成本 |
| SG21 | 銷退成本-DUTY | 21 | R | 數值 | | DUTY成本 |
| SG22 | 結帳銷退成本-FOB | 22 | R | 數值 | | 結帳FOB成本 |
| SG23 | 結帳銷退成本-FHI | 23 | R | 數值 | | 結帳FHI成本 |
| SG24 | 結帳銷退成本-DUTY | 24 | R | 數值 | | 結帳DUTY成本 |
| SG25 | 結帳銷退運費 | 25 | R | 數值 | | 結帳運費 |
| SG26 | 產品序號 | 26 | R | 日期 | 8 00, B2CHKA | 產品序號(確認日期) |

### 5.5 銷貨退回明細欄位 (SH系列)
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SH01 | 公司編號 | 27 | R | 文字 | | 公司別 |
| SH02 | 退貨單號 | 28 | R | 文字 | | 退貨單號 |
| SH03 | 產品代碼 | 29 | R | 文字 | | 產品代碼 |
| SH04 | 數量 | 30 | R | 數值 | | 退貨數量 |
| SH05 | 外銷數量 | 31 | R | 數值 | | 外銷退貨數量 |
| SH06 | 已驗收其運數量 | 32 | R | 數值 | | 已驗收運送數量 |
| SH07 | 銷退金額處理 | 33 | R | 數值 | | 銷退金額 |
| SH08 | 銷退總計運費金額 | 34 | R | 數值 | | 運費金額 |
| SH09 | 退貨日期 | 35 | R | 日期 | 8 00, B2CHKA | 退貨日期 |
| SH10 | 退回倉庫 | 36 | R | 文字 | | 退回倉庫 |
| SH11 | 產品序號 | 37 | R | 文字 | | 產品序號 |

### 5.6 明細數量管理欄位
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SH12 | 已驗收其數量含內銷 | 38 | R | 數值 | | 已驗收內銷數量 |
| SH13 | 已驗收其數量含外銷 | 39 | R | 數值 | | 已驗收外銷數量 |
| SH14 | 銷退成本-FOB | 40 | R | 數值 | | FOB成本 |
| SH15 | 銷退成本-FHI | 41 | R | 數值 | | FHI成本 |
| SH16 | 銷退成本-DUTY | 42 | R | 數值 | | DUTY成本 |
| SH17 | 結帳銷退成本-FOB | 43 | R | 數值 | | 結帳FOB成本 |
| SH18 | 結帳銷退成本-FHI | 44 | R | 數值 | | 結帳FHI成本 |
| SH19 | 結帳銷退成本-DUTY | 45 | R | 數值 | | 結帳DUTY成本 |
| SH20 | 結帳銷退運費 | 46 | R | 數值 | | 結帳運費 |

## 6. 主鍵欄位

主鍵設計需依據實際的KEY定義確認，建議包含公司編號、退貨單號等關鍵識別欄位。

## 7. 索引資料

### 檔案特性
- REF(RERF)：欄位定義參照RERF檔案
- B2CHKA：多個日期欄位檢核
- REFFLD：廣泛使用欄位參照

## 8. 備註

### 特殊說明
- 此檔案為銷貨退回主檔與明細整合檔
- 包含46個欄位，支援完整退貨流程
- 整合SG(主檔)與SH(明細)兩大系列欄位
- 支援複雜的退貨確認狀態管理

### 退貨管理機制
檔案設計支援完整退貨作業：
- **主檔管理**：SG系列欄位管理退貨基本資訊
- **明細管理**：SH系列欄位管理退貨明細
- **狀態管理**：多種確認狀態控制
- **成本管理**：FOB/FHI/DUTY多種成本計算

### 退貨確認狀態機制
提供完整的退貨確認狀態管理：
- **待確認**：'*' 退貨待確認
- **已確認**：'  ' 退貨已確認或不須確認
- **已驗收**：'V' 退貨已驗收確認
- **已結帳**：'A' 退貨已結帳
- **無法結帳**：'N' 無法結帳狀態

### 檔案用途
- 用於銷貨退回作業管理
- 支援退貨確認流程
- 提供退貨成本計算
- 管理退貨倉庫作業

### 參照檔案說明
使用 REF(RERF) 參照：
- 大量使用 REFFLD 參照系統欄位
- 確保與主系統資料一致性
- 便於維護複雜的欄位定義

### 維護注意事項
- 多個日期欄位使用 B2CHKA 檢核
- 退貨確認狀態需維護正確性
- 內外銷退貨數量需分別管理
- 多種成本計算需確保準確性

### 系統應用
- 用於銷貨退回管理系統
- 支援客服作業
- 提供成本分析基礎
- 配合庫存管理系統

### 相關作業
- 銷貨退回建立與維護作業
- 退貨確認作業
- 退貨成本分析作業
- 退貨入庫作業

### 技術特性
- 主檔明細整合設計
- 複雜的狀態管理機制
- 多種成本類型支援
- 完整的退貨流程支援

### 業務流程整合
- 與銷售管理流程整合
- 支援退貨處理作業
- 配合成本會計系統
- 提供客戶服務基礎

### 退貨管理特性
- **退貨原因管理**：記錄詳細退貨原因
- **倉庫管理**：退回倉庫指定與管理
- **原單追溯**：可追溯原銷貨單號
- **調整機制**：支援調整單號處理

### 成本計算功能
- **FOB成本**：Free On Board 成本
- **FHI成本**：運費保險成本
- **DUTY成本**：關稅成本
- **結帳成本**：結帳時重新計算成本

### 數量管理機制
- **退貨數量**：內外銷分別統計
- **驗收數量**：已驗收數量管控
- **運送數量**：運送過程數量追蹤
- **分類統計**：各種數量分類管理

### 退貨流程控制
- **退貨申請**：退貨單建立
- **退貨確認**：業務確認機制
- **退貨驗收**：倉庫驗收作業
- **退貨結帳**：財務結帳處理

### 財務整合功能
- **退貨金額計算**：精確退貨金額計算
- **運費處理**：退貨運費分攤
- **稅務處理**：退貨稅務計算
- **結帳整合**：與財務系統整合

### 品質管控機制
- **退貨原因分析**：退貨原因統計分析
- **產品品質追蹤**：產品品質問題追蹤
- **供應商回饋**：品質問題供應商回饋
- **改善建議**：品質改善建議追蹤 