# SOSNPF 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSNPF
- **檔案類型**: PF (實體檔案)
- **檔案說明**: 產品收回主檔 - 產品退回管理核心檔案
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)
- **檔案屬性**: REF(RERF), UNIQUE

## 2. 檔案功能說明
此實體檔案為產品收回管理系統的核心檔案，記錄產品退回的完整資訊，包含客戶資料、退回商品、日期管理、業務處理、檢驗過帳狀態等。

### 主要功能
- 產品收回基本資料管理
- 退回商品項目追蹤
- 檢驗與過帳狀態控制
- 業務處理流程記錄

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSNPF | PF | 產品收回主檔 (實體檔案) |
| RERF | PF | 參考檔案 |

## 4. 紀錄格式

### 4.1 記錄格式 SN0
```
REF(RERF)
UNIQUE
KEY: SN02
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SN02 | 收回單號 | A | - | ASC | 主鍵，唯一約束 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SN01 | 客戶編號 | A | - | - | R | 客戶基本資料參考，必須存在於客戶主檔 |
| SN02 | 收回單號 | A | - | - | Key,R | 收回單唯一識別碼，必須唯一且不可空白 |
| SN03 | 出貨商品項目代號 | A | - | - | R | 原出貨商品項目 |
| SN04 | 退貨商品項目代號 | A | - | - | R | 退回商品項目 |
| SN05 | 退回日期 | N | 8 | 0 | R | 客戶退回日期，必須為有效日期格式 |
| SN06 | 收回入庫日 | N | 8 | 0 | R | 公司入庫處理日期，必須為有效日期格式 |
| SN07 | 業務人員 | A | - | - | R | 負責業務人員代號 |
| SN08 | 業務備註欄位 | A | - | - | R | 業務處理備註 |
| SN09 | 檢驗狀態 | A | 1 | - | R | 檢驗結果狀態代碼，'V'=已檢驗 |
| SN10 | 過帳狀態 | A | 1 | - | R | 過帳處理狀態代碼，'V'=已過帳,'T'=過帳錯誤,'N'=未處理過帳 |
| SN11 | 客戶地址 | A | - | - | R | 客戶地址資訊 |
| SN12 | 退回溫層 | A | - | - | R | 產品溫度層級 |
| SN13 | 退回FOB-TOT | N | - | - | R | FOB價格總計 |
| SN14 | 退回FHI-TOT | N | - | - | R | FHI價格總計 |
| SN15 | 退回DUTY-TOT | N | - | - | R | 關稅總計 |
| SN16 | 應收退回 | N | 2 | - | A | 應收退回分類(M001新增) |
| SN17 | 供應商單號 | A | 12 | - | A | 供應商提供單號 |
| SN18 | 供應商客戶代號 | A | 5 | - | A | 供應商客戶代號 |
| SN19 | 供應商聯絡代號 | A | 4 | - | A | 供應商聯絡代號 |
| SN20 | 製造商代號 | A | 5 | - | A | 產品製造商代號 |
| SN21 | 製造商地址 | A | 4 | - | A | 製造商地址代號 |
| SN22 | 同業代理代號 | A | 12 | - | A | 同業代理商代號 |
| SN23 | 備註一 | A | 12 | - | A | 備註欄位一 |
| SN24 | 備註二 | A | 12 | - | A | 備註欄位二 |
| SN25 | 備註三 | A | 12 | - | A | 備註欄位三 |
| SN26 | 數字一 | N | 11 | 2 | A | 數值欄位一 |
| SN27 | 數字二 | N | 11 | 2 | A | 數值欄位二 |
| SN28 | 數字三 | N | 11 | 2 | A | 數值欄位三 |
| SN29 | 雜項一 | A | 30 | - | O | 雜項資料一 |
| SN30 | 雜項二 | A | 30 | - | O | 雜項資料二 |
| SN31 | 雜項三 | A | 30 | - | O | 雜項資料三 |
| SN32 | 旗標一 | A | 1 | - | A | 旗標欄位一 |
| SN33 | 旗標二 | A | 1 | - | A | 旗標欄位二 |
| SN34 | 旗標三 | A | 1 | - | A | 旗標欄位三 |
| SNXX | 異動人員 | A | - | - | R | 異動人員代號 |
| SNYY | 異動時間 | N | - | - | R | 異動時間戳記 |
| SNZZ | 異動者 | A | - | - | R | 異動操作者 |

## 5. 主鍵欄位
- **主鍵**: SN02 (收回單號)
- **約束**: UNIQUE - 確保收回單號唯一性

## 6. 索引資料
| 索引名稱 | 欄位組合 | 索引類型 | 說明 |
|----------|----------|----------|------|
| Primary | SN02 | 主鍵索引 | 收回單號唯一索引 |

## 7. 使用說明

### 7.1 檔案用途
- 產品收回作業主檔案
- 退回商品資料管理
- 檢驗過帳流程控制
- 客戶退回歷史記錄

### 7.2 程式存取方式
```rpg
// 新增收回記錄
WRITE SOSNPF;
// 查詢收回記錄
CHAIN (收回單號) SOSNPF;
// 更新收回記錄
UPDATE SOSNPF;
// 刪除收回記錄
DELETE SOSNPF;
```

### 7.3 檔案維護
- 定期備份重要的收回資料
- 監控檔案成長狀況
- 定期清理歷史資料

## 8. 備註
- 此檔案採用 REF(RERF) 參考檔案設計
- UNIQUE 約束確保收回單號唯一性
- 收回單號格式：XX-XX-XX-XXXXXX (客戶-部門-產品業務-序號)
- M001 修改：新增應收退回分類欄位 (SN16)
- 支援完整的異動追蹤機制
- 包含彈性的備註和數值欄位供擴充使用
- 主要用於產品收回流程的完整管理
- 與相關邏輯檔案配合提供多維度查詢功能
- 錯誤處理：重複收回單號、無效客戶編號、日期格式錯誤、狀態碼無效等錯誤處理機制
- 輸入欄位驗證：必要欄位檢核與狀態欄位檢核機制 