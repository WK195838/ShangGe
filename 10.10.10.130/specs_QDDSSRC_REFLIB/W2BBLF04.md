# W2BBLF04 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | W2BBLF04 |
| 檔案類型 | 邏輯檔 (LF) |
| 檔案描述 | 後台銷售明細檔邏輯檔04 |
| 基礎實體檔 | W2BBPF |
| 作業系統 | AS/400 |
| 資料庫 | DB2/400 |

## 2. 檔案功能說明

此檔案為後台銷售明細檔的邏輯檔，提供商品優先排序檢索(商品代號+銷售編號倒序)。主要功能：
- 以商品代號為主要排序鍵
- 銷售編號採用倒序排列，最新記錄優先
- 支援商品導向的銷售明細查詢

## 3. 系統檔案清單

| 項目 | 檔案名稱 | 類型 | 說明 |
|------|----------|------|------|
| 主檔 | W2BBLF04 | LF | 後台銷售明細檔邏輯檔04 |
| 基礎檔 | W2BBPF | PF | 後台銷售明細檔 |

## 4. 紀錄格式

### 記錄格式：BB0
**基礎實體檔：W2BBPF**

| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 說明 |
|----------|----------|------|------|------|------|
| BB01 | 銷售編號 | A | 12 | 0 | 後台銷售編號 |
| BB02 | 銷售單號 | S | 6 | 0 | 銷售單號 |
| BB03 | 商品代號 | A | 9 | 0 | 商品識別代號 |
| BB04 | 銷售數量 | S | 8 | 0 | 銷售數量 |
| BB05 | 寄出數量 | S | 8 | 0 | 實際寄出數量 |
| BB06 | 確認數量 | S | 8 | 0 | 確認收貨數量 |
| BB07 | 單價 | S | 11 | 2 | 銷售單價 |
| BB08 | FOB單價 | S | 9 | 2 | FOB成本單價 |
| BB08A | FHI單價 | S | 9 | 2 | FHI成本單價 |
| BB08B | DUTY單價 | S | 9 | 2 | 關稅成本單價 |
| BB09 | 狀態 | A | 1 | 0 | 處理狀態代碼 |
| BB10 | 備註 | O | 128 | 0 | 備註說明 |
| BB11 | 指派記號 | A | 1 | 0 | 指派標記 |
| BBXX | 建立日期 | S | 8 | 0 | 記錄建立日期 |
| BBYY | 建立時間 | S | 6 | 0 | 記錄建立時間 |
| BBZZ | 建立人員 | A | 10 | 0 | 記錄建立人員 |

## 5. 主鍵欄位

| 順序 | 欄位代號 | 欄位名稱 | 排序方式 |
|------|----------|----------|----------|
| 1 | BB03 | 商品代號 | 遞增 |
| 2 | BB01 | 銷售編號 | 遞減 |

## 6. 索引資料

### 索引鍵值
- **主索引**：BB03 + BB01 (DESCEND)
- **排序方式**：商品代號遞增，銷售編號遞減
- **唯一性**：非唯一索引(允許重複)

### 存取路徑
此邏輯檔提供以下存取路徑：
1. 依商品代號分組存取銷售記錄
2. 同一商品的銷售記錄按時間倒序排列
3. 支援商品銷售歷史的時序查詢

### 排序邏輯
- **主要排序**：商品代號(A-Z順序)
- **次要排序**：銷售編號(最新→最舊)
- **結果**：商品分組，時間倒序

## 7. 使用說明

### 查詢功能
- 支援商品導向的銷售歷史查詢
- 同一商品最新銷售記錄優先顯示
- 提供商品銷售時序分析功能

### 作業程序
1. 透過商品代號定位商品銷售群組
2. 系統自動按銷售編號倒序排列
3. 最新銷售記錄排在最前面
4. 支援商品銷售趨勢分析

### 檢索邏輯
- **商品分組**：依商品代號群組化資料
- **時序排列**：最新銷售記錄優先
- **分析支援**：便於商品銷售分析

### 注意事項
- 此為唯讀邏輯檔，不可直接進行資料維護
- 排序邏輯以商品為中心，時間為輔助
- 適用於商品銷售分析及歷史查詢

## 8. 備註

- 邏輯檔建立於W2BBPF基礎檔案之上
- 提供商品導向的銷售明細檢索
- 支援商品銷售歷史的時序分析
- 排序邏輯：商品代號(遞增) + 銷售編號(遞減)
- 適用於商品管理及銷售分析需求 