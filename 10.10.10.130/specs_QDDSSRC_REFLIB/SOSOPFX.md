# SOSOPFX 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSOPFX
- **檔案類型**: PF (實體檔案)
- **檔案說明**: 試飲收回訂單明細延伸檔 - 試飲活動收回延伸資料檔
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)
- **檔案屬性**: REF(RERF), UNIQUE

## 2. 檔案功能說明
此實體檔案為試飲收回訂單明細的延伸檔案，專門記錄試飲活動相關的收回資訊，擴充一般收回管理功能。

### 主要功能
- 試飲活動收回記錄管理
- 收回單延伸資料存儲
- 記帳單位控制
- 記帳類別管理
- 試飲商品追蹤

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSOPFX | PF | 試飲收回訂單明細延伸檔 (實體檔案) |
| SOSOPF | PF | 產品收回明細檔 (關聯檔案) |
| RERF | PF | 參考檔案 |

## 4. 紀錄格式

### 4.1 記錄格式 SO0
```
REF(RERF)
UNIQUE
KEY: SO02 + SO03
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SO02 | 收回單號 | A | - | ASC | 主要主鍵，與SOSOPF.SO02對應 |
| 2 | SO03 | 商品代號 | A | - | ASC | 次要主鍵，與SOSOPF.SO03對應 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 型態 | 長度 | 小數 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| SO01 | 客戶編號 | A | - | - | R | 客戶基本資料參考 |
| SO02 | 收回單號 | A | - | - | Key,R | 收回單唯一識別碼，與主檔對應 |
| SO03 | 商品代號 | A | - | - | Key,R | 商品項目代號，與主檔對應 |
| SO99 | 記帳單位 | A | 2 | - | R | 記帳單位代號 |
| SO98 | 記帳類別 | A | 1 | - | R | 記帳分類代號 |
| SOXX | 異動人員 | A | 8 | 0 | R | 異動人員代號 |
| SOYY | 異動時間 | N | 6 | 0 | R | 異動時間戳記 |
| SOZZ | 異動者 | A | 10 | - | R | 異動操作者 |

## 5. 主鍵欄位
- **主鍵**: SO02 + SO03 (收回單號 + 商品代號)
- **約束**: UNIQUE - 確保收回單號與商品代號組合唯一性
- **關聯**: 與SOSOPF.SO02+SO03一對一對應

## 6. 索引資料
| 索引名稱 | 欄位組合 | 索引類型 | 說明 |
|----------|----------|----------|------|
| Primary | SO02 + SO03 | 複合主鍵索引 | 收回單號與商品代號組合索引 |

## 7. 使用說明

### 7.1 檔案用途
- 試飲活動收回延伸資料管理
- 記帳單位分類管理
- 試飲商品收回追蹤
- 延伸資料存儲

### 7.2 程式存取方式
```rpg
// 新增延伸記錄
WRITE SOSOPFX;
// 查詢延伸記錄
CHAIN (收回單號:商品代號) SOSOPFX;
// 更新延伸記錄
UPDATE SOSOPFX;
// 與主檔聯合查詢
CHAIN (收回單號:商品代號) SOSOPF;
IF %FOUND(SOSOPF);
  CHAIN (收回單號:商品代號) SOSOPFX;
ENDIF;
```

### 7.3 檔案維護
- 與產品收回明細檔同步維護
- 定期檢核資料一致性
- 試飲活動相關資料更新

## 8. 備註
- 此檔案採用 REF(RERF) 參考檔案設計
- UNIQUE 約束確保收回單號與商品代號組合唯一性
- 與產品收回明細檔(SOSOPF)一對一對應關係
- 專門處理試飲活動相關的收回延伸資訊
- 支援完整的異動追蹤機制
- 記帳單位與記帳類別用於會計處理分類
- 收回單號格式：XX-XX-XX-XXXXXX
- 主要用於擴充試飲收回管理的記帳功能
- 與主檔案配合提供完整的試飲收回資訊管理
- 適用於試飲活動的專門收回作業 