# PA#IPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | PA#IPF |
| 檔案描述 | 銷售銷退收回單別歷始檔 |
| 檔案類型 | PF (Physical File) |
| 記錄格式 | #I0 |
| 主鍵 | #I01 + #I02 + #I03 (年月 + 單別 + 序號) |
| 實體檔案 | PA#IPF |
| 檔案屬性 | 實體檔案，單別歷史紀錄 |

## 2. 檔案功能說明

PA#IPF 為銷售銷退收回單別的歷史紀錄檔案，提供：
- 單別使用歷史追蹤
- 單據編號管控
- 歷史資料查詢
- 統計分析支援

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 說明 |
|----------|----------|------|
| PA#IPF | 單別歷始實體檔 | 主檔 |
| RERF | 參考檔案 | 欄位定義參考 |

## 4. 紀錄格式

### 記錄格式：#I0

## 5. 欄位規格

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| #I01 | 年月 | 1-6 | 6 | N | R | 主鍵，格式：YYYYMM |
| #I02 | 單別 | 7-9 | 3 | A | R | 主鍵，單據類別 |
| #I03 | 序號 | 10-16 | 7 | N | R | 主鍵，記錄序號 |
| #I04 | 單據號碼 | 17-26 | 10 | A | R | 完整單據號碼 |
| #I05 | 單據類型 | 27 | 1 | A | R | 'S'-銷售，'R'-銷退，'C'-收回 |
| #I06 | 客戶代號 | 28-34 | 7 | A | R | 客戶識別碼 |
| #I07 | 客戶名稱 | 35-54 | 20 | A | R | 客戶中文名稱 |
| #I08 | 業務員 | 55-59 | 5 | A | R | 負責業務員代號 |
| #I09 | 業務日期 | 60-67 | 8 | N | R | 業務發生日期 |
| #I10 | 建立日期 | 68-75 | 8 | N | R | 單據建立日期 |
| #I11 | 建立時間 | 76-81 | 6 | N | R | 單據建立時間 |
| #I12 | 總金額 | 82-94 | 13 | N | R | 單據總金額 (2位小數) |
| #I13 | 總數量 | 95-105 | 11 | N | R | 單據總數量 (2位小數) |
| #I14 | 地區代號 | 106-110 | 5 | A | R | 業務地區 |
| #I15 | 區域代號 | 111-115 | 5 | A | R | 業務區域 |
| #I16 | 單據狀態 | 116 | 1 | A | R | 'A'-正常，'C'-取消，'D'-刪除 |
| #I17 | 處理程式 | 117-126 | 10 | A | R | 處理程式名稱 |
| #I18 | 列印次數 | 127-129 | 3 | N | R | 單據列印次數 |
| #I19 | 特殊標記 | 130-134 | 5 | A | R | 特殊處理標記 |
| #I20 | 關聯單號 | 135-144 | 10 | A | R | 關聯單據號碼 |
| #I21 | 稅額 | 145-157 | 13 | N | R | 稅額 (2位小數) |
| #I22 | 折扣金額 | 158-170 | 13 | N | R | 折扣金額 (2位小數) |
| #I23 | 實收金額 | 171-183 | 13 | N | R | 實收金額 (2位小數) |
| #I24 | 貨幣別 | 184-186 | 3 | A | R | 貨幣代碼 |
| #I25 | 匯率 | 187-199 | 13 | N | R | 匯率 (5位小數) |
| #IXX | 建檔日期 | 200-207 | 8 | N | R | 格式：YYYYMMDD |
| #IYY | 建檔時間 | 208-213 | 6 | N | R | 格式：HHMMSS |
| #IZZ | 建檔者 | 214-223 | 10 | A | R | 操作人員 |

## 6. 主鍵欄位

| 鍵值序號 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | #I01 | 年月 | 升序 |
| 2 | #I02 | 單別 | 升序 |
| 3 | #I03 | 序號 | 升序 |

## 7. 索引資料

### 主要索引
- **索引名稱**：主鍵索引
- **索引欄位**：#I01 + #I02 + #I03
- **索引類型**：PRIMARY
- **說明**：年月 + 單別 + 序號複合升序排序

### 輔助索引
1. **單據號碼索引**：#I04 + #I01 (單據號碼 + 年月)
2. **客戶索引**：#I06 + #I01 + #I02 (客戶 + 年月 + 單別)
3. **業務員索引**：#I08 + #I01 + #I02 (業務員 + 年月 + 單別)
4. **業務日期索引**：#I09 + #I02 + #I03 (業務日期 + 單別 + 序號)
5. **單據類型索引**：#I05 + #I01 + #I02 (類型 + 年月 + 單別)
6. **地區索引**：#I14 + #I01 + #I02 (地區 + 年月 + 單別)
7. **單據狀態索引**：#I16 + #I01 + #I02 (狀態 + 年月 + 單別)
8. **關聯單號索引**：#I20 + #I01 (關聯單號 + 年月)
9. **建立日期索引**：#I10 + #I02 + #I03 (建立日期 + 單別 + 序號)

## 8. 備註

### 設計考量
1. 此檔案為銷售相關單據的歷史紀錄檔案
2. 提供完整的單據使用歷程追蹤
3. 支援多種單據類型的統一管理

### 特殊功能
- **歷史追蹤**：完整記錄單據使用歷史
- **統計分析**：支援業績統計和分析
- **稽核支援**：提供稽核所需的歷史資料
- **關聯查詢**：支援關聯單據的查詢

### 單據類型說明
- **S級 (銷售)**：一般銷售單據
- **R級 (銷退)**：銷貨退回單據
- **C級 (收回)**：試飲收回單據

### 單據狀態說明
- **A級 (正常)**：正常處理中的單據
- **C級 (取消)**：已取消的單據
- **D級 (刪除)**：已刪除的單據

### 特殊標記範例
- **RUSH**：急件處理
- **HOLD**：暫停處理
- **VIP**：重要客戶
- **TEST**：測試單據
- **BATCH**：批次處理

### 年月格式說明
- **格式**：YYYYMM
- **範例**：202412 代表 2024年12月
- **用途**：便於按月份統計和查詢

### 參考關聯
- **客戶檔案**：MTMDPF (#I06 = MD01)
- **業務員檔案**：MTMCPF (#I08 = MC01)
- **地區檔案**：PA#DPF (#I14 = #D01)
- **區域檔案**：PA#EPF (#I15 = #E01)
- **程式檔案**：執行程式 (#I17 = 程式名稱)

### 業務規則
1. 年月 + 單別 + 序號必須唯一
2. 單據號碼在同一年月內不可重複
3. 單據狀態為 'D' 時不可再異動
4. 關聯單號需對應有效的單據

### 資料完整性
1. #I01 年月需為有效的年月格式
2. #I09 業務日期需在合理範圍內
3. #I10 建立日期不可晚於目前日期
4. #I12, #I21, #I22, #I23 金額需為正值或零
5. #I25 匯率需大於零

### 使用注意事項
1. 此檔案為歷史紀錄，原則上不可刪除
2. 單據取消時狀態改為 'C'，不實際刪除記錄
3. 查詢歷史資料時建議使用年月範圍限制
4. 適用於銷售業績統計、稽核查詢和歷史分析 