# IMIPLF1 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案代號 | IMIPLF1 |
| 檔案名稱 | 進貨單據主檔 |
| 檔案類型 | LF (邏輯檔案) |
| 資料庫 | REFLIB |
| 記錄格式 | PF0, SN0, II0 |
| 基礎實體檔案 | POPFPF, SOSNPF, IMIIPF |

## 2. 檔案功能說明

此聯結邏輯檔案整合三個實體檔案（POPFPF、SOSNPF、IMIIPF），提供以收貨日期降序、收貨項次代號、單據號碼的排序存取路徑。主要用於進貨單據的時間序列管理，將最新的收貨記錄優先顯示。具有多重選擇條件，包括已確認數量不等於0、確認標記等於'V'、'T'、'N'等，適用於已確認的進貨單據查詢和管理。

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|----------|------|
| IMIPLF1 | 進貨單據主檔 | LF | 邏輯檔案 |
| POPFPF | 進貨單據主檔 | PF | 基礎實體檔案1 |
| SOSNPF | 銷退單據檔案 | PF | 基礎實體檔案2 |
| IMIIPF | 存貨調撥主檔 | PF | 基礎實體檔案3 |

## 4. 紀錄格式

### 記錄格式：PF0 (基於POPFPF)
- **基於實體檔案**：POPFPF
- **存取方式**：聯結邏輯存取
- **排序方式**：複合排序（收貨日期降序 + 收貨項次代號 + 單據號碼）
- **選擇條件**：
  - IP06 NE 0 (已確認數量不等於0)
  - IP021 LT '0' (單據第四碼小於'0')

### 記錄格式：SN0 (基於SOSNPF)
- **基於實體檔案**：SOSNPF
- **存取方式**：聯結邏輯存取
- **排序方式**：複合排序（收貨日期降序 + 收貨項次代號 + 單據號碼）
- **選擇條件**：
  - IP07 EQ 'V' OR 'T' OR 'N' (確認標記等於V、T、N)
  - IP021 LT '0' (單據第四碼小於'0')

### 記錄格式：II0 (基於IMIIPF)
- **基於實體檔案**：IMIIPF
- **存取方式**：聯結邏輯存取
- **排序方式**：複合排序（收貨日期降序 + 收貨項次代號 + 單據號碼）
- **選擇條件**：
  - IP07 EQ 'V' OR 'N' (確認標記等於V、N)
  - IP021 LT '0' (單據第四碼小於'0')

## 5. 欄位代號、名稱、位置、長度、屬性、檢核說明

### 共通欄位 (所有記錄格式)
| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|----------|----------|
| IP01 | 單據編號 | - | - | - | R | 對應各檔案的單據編號欄位 |
| IP02 | 單據號碼 | - | - | - | R,K | 對應各檔案的單據號碼欄位，索引欄位3 |
| IP021 | 單據第四碼 | - | 1 | A | I | 單據號碼第4碼，選擇條件欄位 |
| IP03 | 出貨項次代號 | - | - | - | R | 對應各檔案的出貨項次代號 |
| IP04 | 收貨項次代號 | - | - | - | R,K | 對應各檔案的收貨項次代號，索引欄位2 |
| IP05 | 收貨日期 | - | - | - | R,K | 對應各檔案的收貨日期，索引欄位1(降序) |
| IP06 | 已確認數量 | - | - | - | R,O | 對應各檔案的已確認數量，選擇條件欄位 |
| IP07 | 確認標記 | - | - | - | R,O | 對應各檔案的確認標記，選擇條件欄位 |

## 6. 主鍵欄位

| 主鍵順序 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | IP05 | 收貨日期 | DESC |
| 2 | IP04 | 收貨項次代號 | ASC |
| 3 | IP02 | 單據號碼 | ASC |

## 7. 索引資料

### 主要索引
- **索引鍵值**：IP05(DESC) + IP04 + IP02
- **索引類型**：複合索引
- **排序方式**：收貨日期降序，其他遞增排序
- **用途**：支援按照最新收貨日期優先的查詢

### 選擇條件
- **PF0記錄格式條件**：
  - IP06 NE 0 (已確認數量不等於0)
  - IP021 LT '0' (單據第四碼小於'0')
- **SN0記錄格式條件**：
  - IP07 EQ 'V' OR 'T' OR 'N' (確認標記等於V、T、N)
  - IP021 LT '0' (單據第四碼小於'0')
- **II0記錄格式條件**：
  - IP07 EQ 'V' OR 'N' (確認標記等於V、N)
  - IP021 LT '0' (單據第四碼小於'0')

## 8. 備註

1. 此檔案為聯結邏輯檔案，整合三個實體檔案
2. 採用收貨日期降序排列，最新記錄優先顯示
3. 具有多重選擇條件，限制已確認的單據
4. 支援不同檔案的不同確認標記組合
5. 適用於已確認進貨單據的時間序列查詢
6. 提供最新收貨記錄優先的存取功能
7. 便於進貨單據的時間管理和追蹤
8. 支援跨檔案的已確認單據整合分析 