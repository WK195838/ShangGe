# W2BDPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | W2BDPF |
| 檔案類型 | 實體檔 (PF) |
| 檔案描述 | 後台訂貨明細檔 |
| 主鍵 | BD01 + BD02 |
| 作業系統 | AS/400 |
| 資料庫 | DB2/400 |

## 2. 檔案功能說明

此檔案為後台訂貨系統的核心明細檔案，記錄每筆訂貨交易的詳細商品明細資訊。主要功能：
- 儲存後台訂貨的商品明細記錄
- 管理訂貨數量與確認數量
- 提供批準號碼的管理機制
- 追蹤訂貨明細的狀態管理
- 支援建立編號的關聯追蹤

## 3. 系統檔案清單

| 項目 | 檔案名稱 | 類型 | 說明 |
|------|----------|------|------|
| 主檔 | W2BDPF | PF | 後台訂貨明細檔 |
| 邏輯檔 | W2BDLF01 | LF | 訂貨編號+批準號碼+商品代號排序 |
| 主檔關聯 | W2BCPF | PF | 後台訂貨主檔 |

## 4. 紀錄格式

### 記錄格式：BD0

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 說明 |
|----------|----------|------|------|------|------|------|
| BD01 | 訂貨編號 | 1 | 12 | A | 主鍵 | 訂貨編號 |
| BD02 | 商品代號 | 13 | 9 | A | 主鍵 | 商品識別代號 |
| BD03 | 批準號碼 | 22 | 5 | A | 索引 | 批準號碼 |
| BD04 | 訂貨數量 | 27 | 8 | S | 必填 | 訂貨數量 |
| BD05 | 確認數量 | 35 | 8 | S | - | 確認數量 |
| BD06 | 狀態 | 43 | 1 | A | 索引 | 處理狀態代碼 |
| BD07 | 建立編號 | 44 | 12 | A | - | 建立編號 |
| BD08 | 備註 | 56 | 16 | O | - | 備註說明 |
| BDXX | 建立日期 | 72 | 8 | S | 系統 | 記錄建立日期 |
| BDYY | 建立時間 | 80 | 6 | S | 系統 | 記錄建立時間 |
| BDZZ | 建立人員 | 86 | 10 | A | 系統 | 記錄建立人員 |

## 5. 主鍵欄位

| 順序 | 欄位代號 | 欄位名稱 | 約束條件 |
|------|----------|----------|----------|
| 1 | BD01 | 訂貨編號 | NOT NULL |
| 2 | BD02 | 商品代號 | NOT NULL |

**唯一性約束：** UNIQUE (BD01, BD02)

## 6. 索引資料

### 主索引
- **索引名稱**：BD0_PRIMARY
- **索引欄位**：BD01 + BD02
- **索引類型**：PRIMARY KEY, UNIQUE
- **排序方式**：遞增

### 輔助索引
- **批準號碼索引**：BD03 (批準號碼)
- **狀態索引**：BD06 (處理狀態)
- **建立編號索引**：BD07 (建立編號)
- **建立日期索引**：BDXX (建立日期)

## 7. 使用說明

### 資料維護
- 新增：透過訂貨系統自動產生明細記錄
- 修改：支援數量及狀態欄位的異動
- 刪除：配合訂貨主檔刪除時同步刪除

### 數量控制
- **訂貨數量(BD04)**：原始訂購數量
- **確認數量(BD05)**：實際確認數量
- 支援數量差異的管理機制

### 批準管理
- **批準號碼(BD03)**：5位字元的批準識別碼
- 支援分批批準的管理機制
- 提供批準流程的追蹤功能

### 狀態管理
- 訂貨明細狀態代碼定義
- 支援明細層級的狀態追蹤
- 配合主檔狀態進行聯動管理

### 建立編號追蹤
- **建立編號(BD07)**：12位字元的建立追蹤碼
- 支援明細記錄的來源追蹤
- 提供資料稽核的參考依據

## 8. 備註

- 檔案採用雙重複合主鍵確保明細記錄唯一性
- 支援訂貨編號與商品代號的完整組合管理
- 提供批準號碼的彈性管理機制
- 系統自動記錄建立資訊便於追蹤
- 配合邏輯檔提供不同檢索需求
- 為後台訂貨系統的核心明細檔案
- 與主檔W2BCPF建立主從關聯 