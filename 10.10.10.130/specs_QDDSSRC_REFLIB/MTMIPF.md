# MTMIPF 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案名稱 | MTMIPF |
| 檔案描述 | 產品基本資料延伸檔 |
| 檔案類型 | PF (Physical File) |
| 記錄格式 | MI0 |
| 主鍵 | MI01 + MI02 (產品代號 + 延伸代號) |
| 檔案屬性 | 實體檔案，產品延伸資料主檔 |

## 2. 檔案功能說明

MTMIPF 為產品基本資料延伸檔的實體檔案，提供：
- 產品延伸資料儲存
- 動態欄位擴充功能
- 特殊屬性資料管理
- 客製化欄位支援

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 說明 |
|----------|----------|------|
| MTMIPF | 產品基本資料延伸實體檔 | 主檔 |
| MTMILF01 | 產品基本資料延伸邏輯檔 | 基本邏輯檔 |
| MTMAPF | 產品基本資料實體檔 | 關聯主檔 |
| RERF | 參考檔案 | 欄位定義參考 |

## 4. 紀錄格式

### 記錄格式：MI0

## 5. 欄位規格

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| MI01 | 產品代號 | 1-13 | 13 | A | R | 主鍵1，關聯MTMAPF.MA01 |
| MI02 | 延伸代號 | 14-16 | 3 | A | R | 主鍵2，延伸資料識別碼 |
| MI03 | 延伸名稱 | 17-56 | 40 | A | R | 延伸資料名稱 |
| MI04 | 延伸說明 | 57-156 | 100 | A | R | 延伸資料詳細說明 |
| MI05 | 資料類型 | 157 | 1 | A | R | 'T'-文字，'N'-數字，'D'-日期 |
| MI06 | 文字內容 | 158-357 | 200 | A | R | 文字型延伸內容 |
| MI07 | 數字內容 | 358-372 | 15 | N | R | 數字型延伸內容 (11位整數，4位小數) |
| MI08 | 日期內容 | 373-380 | 8 | N | R | 日期型延伸內容 YYYYMMDD |
| MI09 | 優先順序 | 381-383 | 3 | N | R | 顯示優先順序 001-999 |
| MI10 | 狀態標記 | 384 | 1 | A | R | 'A'-有效，'I'-無效，'D'-刪除 |
| MI11 | 分類標記 | 385-389 | 5 | A | R | 延伸資料分類 |
| MI12 | 版本號 | 390-394 | 5 | A | R | 延伸資料版本 |
| MI13 | 來源系統 | 395-399 | 5 | A | R | 資料來源系統 |
| MI14 | 更新頻率 | 400 | 1 | A | R | 'D'-每日，'W'-每週，'M'-每月 |
| MI15 | 檢核狀態 | 401 | 1 | A | R | 'Y'-已檢核，'N'-未檢核 |
| MI16 | 公開等級 | 402 | 1 | A | R | '1'-公開，'2'-內部，'3'-機密 |
| MI17 | 關聯檔案 | 403-407 | 5 | A | R | 關聯檔案代號 |
| MI18 | 關聯欄位 | 408-412 | 5 | A | R | 關聯欄位代號 |
| MI19 | 單位代號 | 413-417 | 5 | A | R | 數字內容單位 |
| MI20 | 格式代號 | 418-422 | 5 | A | R | 顯示格式代號 |
| MI21 | 驗證規則 | 423-437 | 15 | A | R | 資料驗證規則 |
| MI22 | 預設值 | 438-452 | 15 | A | R | 預設值設定 |
| MI23 | 最小值 | 453-467 | 15 | N | R | 數字型最小值 |
| MI24 | 最大值 | 468-482 | 15 | N | R | 數字型最大值 |
| MI25 | 小數位數 | 483-484 | 2 | N | R | 數字型小數位數 0-4 |
| MI26 | 必填標記 | 485 | 1 | A | R | 'Y'-必填，'N'-選填 |
| MI27 | 唯一標記 | 486 | 1 | A | R | 'Y'-唯一，'N'-可重複 |
| MI28 | 索引標記 | 487 | 1 | A | R | 'Y'-建立索引，'N'-不建索引 |
| MI29 | 附件路徑 | 488-537 | 50 | A | R | 相關附件檔案路徑 |
| MI30 | 列印順序 | 538-540 | 3 | N | R | 報表列印順序 |
| MI31 | 螢幕顯示 | 541 | 1 | A | R | 'Y'-螢幕顯示，'N'-不顯示 |
| MI32 | 報表顯示 | 542 | 1 | A | R | 'Y'-報表顯示，'N'-不顯示 |
| MI33 | 計算欄位 | 543 | 1 | A | R | 'Y'-計算欄位，'N'-一般欄位 |
| MI34 | 計算公式 | 544-593 | 50 | A | R | 計算欄位公式 |
| MI35 | 備註說明 | 594-693 | 100 | A | R | 特殊備註說明 |
| MI36 | 多語言1 | 694-733 | 40 | A | R | 多語言名稱1 |
| MI37 | 多語言2 | 734-773 | 40 | A | R | 多語言名稱2 |
| MI38 | 多語言3 | 774-813 | 40 | A | R | 多語言名稱3 |
| MI39 | 權限群組 | 814-818 | 5 | A | R | 存取權限群組 |
| MI40 | 修改權限 | 819-823 | 5 | A | R | 修改權限群組 |
| MI41 | 查詢權限 | 824-828 | 5 | A | R | 查詢權限群組 |
| MI42 | 列印權限 | 829-833 | 5 | A | R | 列印權限群組 |
| MI43 | 輸出權限 | 834-838 | 5 | A | R | 輸出權限群組 |
| MI44 | API存取 | 839 | 1 | A | R | 'Y'-允許API存取，'N'-不允許 |
| MI45 | 同步目標 | 840-844 | 5 | A | R | 資料同步目標系統 |
| MI46 | 同步狀態 | 845 | 1 | A | R | 'Y'-已同步，'N'-未同步，'E'-錯誤 |
| MI47 | 同步時間 | 846-851 | 6 | N | R | 最後同步時間 HHMMSS |
| MI48 | 同步日期 | 852-859 | 8 | N | R | 最後同步日期 YYYYMMDD |
| MI49 | 備用欄位1 | 860-874 | 15 | A | R | 備用欄位1 |
| MI50 | 備用欄位2 | 875-889 | 15 | A | R | 備用欄位2 |
| MIXX | 建立日期 | 890-897 | 8 | N | R | 建立日期 YYYYMMDD |
| MIYY | 建立時間 | 898-903 | 6 | N | R | 建立時間 HHMMSS |
| MIZZ | 建立者 | 904-913 | 10 | A | R | 建立人員 |
| MI51 | 異動日期 | 914-921 | 8 | N | R | 最後異動日期 YYYYMMDD |
| MI52 | 異動時間 | 922-927 | 6 | N | R | 最後異動時間 HHMMSS |
| MI53 | 異動者 | 928-937 | 10 | A | R | 最後異動人員 |

## 6. 主鍵欄位

| 鍵值序號 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | MI01 | 產品代號 | 升序 |
| 2 | MI02 | 延伸代號 | 升序 |

## 7. 索引資料

### 主要索引
- **索引名稱**：主鍵索引
- **索引欄位**：MI01 + MI02
- **索引類型**：PRIMARY
- **說明**：產品代號 + 延伸代號複合升序排序

### 輔助索引
1. **延伸代號索引**：MI02 + MI01 (延伸代號 + 產品代號)
2. **分類狀態索引**：MI11 + MI10 + MI01 + MI02 (分類 + 狀態 + 產品 + 延伸)
3. **優先順序索引**：MI09 + MI01 + MI02 (優先順序 + 產品 + 延伸代號)
4. **版本索引**：MI12 + MI01 + MI02 (版本 + 產品 + 延伸代號)
5. **來源系統索引**：MI13 + MI01 + MI02 (來源系統 + 產品 + 延伸代號)
6. **公開等級索引**：MI16 + MI01 + MI02 (公開等級 + 產品 + 延伸代號)
7. **關聯檔案索引**：MI17 + MI18 + MI01 + MI02 (關聯檔案 + 欄位 + 產品 + 延伸)
8. **資料類型索引**：MI05 + MI01 + MI02 (資料類型 + 產品 + 延伸代號)
9. **更新頻率索引**：MI14 + MI01 + MI02 (更新頻率 + 產品 + 延伸代號)
10. **同步狀態索引**：MI46 + MI48 + MI01 + MI02 (同步狀態 + 日期 + 產品 + 延伸)
11. **異動日期索引**：MI51 + MI52 + MI01 + MI02 (異動日期 + 時間 + 產品 + 延伸)
12. **權限群組索引**：MI39 + MI01 + MI02 (權限群組 + 產品 + 延伸代號)
13. **API存取索引**：MI44 + MI01 + MI02 (API存取 + 產品 + 延伸代號)
14. **螢幕顯示索引**：MI31 + MI01 + MI02 (螢幕顯示 + 產品 + 延伸代號)
15. **報表顯示索引**：MI32 + MI30 + MI01 + MI02 (報表顯示 + 列印順序 + 產品 + 延伸)

## 8. 備註

### 設計考量
1. 此檔案為產品延伸資料的主要實體檔案
2. 提供產品主檔無法滿足的延伸欄位需求
3. 支援動態欄位和客製化資料結構

### 延伸資料管理
- **多型態支援**：文字、數字、日期三種資料型態
- **動態擴充**：不修改主檔結構即可增加欄位
- **版本控制**：支援延伸資料版本管理
- **權限控制**：細緻的權限控制機制

### 資料類型處理
- **文字型 (T)**：使用 MI06 欄位 (200字元)
- **數字型 (N)**：使用 MI07 欄位 (15位數，4位小數)
- **日期型 (D)**：使用 MI08 欄位 (YYYYMMDD格式)

### 驗證機制
- **範圍驗證**：MI23、MI24 數值範圍檢查
- **格式驗證**：MI21 驗證規則檢查
- **必填驗證**：MI26 必填欄位檢查
- **唯一性驗證**：MI27 唯一值檢查

### 顯示控制
- **螢幕顯示**：MI31 控制是否在螢幕顯示
- **報表顯示**：MI32 控制是否在報表顯示
- **列印順序**：MI30 控制報表列印順序
- **優先順序**：MI09 控制一般顯示順序

### 計算功能
- **計算欄位**：MI33 標記計算欄位
- **計算公式**：MI34 儲存計算公式
- **動態計算**：支援執行期動態計算

### 多語言支援
- **多語言1**：MI36 第一語言名稱
- **多語言2**：MI37 第二語言名稱
- **多語言3**：MI38 第三語言名稱

### 權限管理
- **權限群組**：MI39 基礎存取權限
- **修改權限**：MI40 資料修改權限
- **查詢權限**：MI41 資料查詢權限
- **列印權限**：MI42 報表列印權限
- **輸出權限**：MI43 資料輸出權限
- **API存取**：MI44 API存取控制

### 同步機制
- **同步目標**：MI45 資料同步目標系統
- **同步狀態**：MI46 同步執行狀態
- **同步時間**：MI47、MI48 最後同步時間

### 資料完整性控制
1. **主鍵唯一性**：MI01 + MI02 複合主鍵唯一
2. **外鍵檢查**：MI01 必須存在於 MTMAPF.MA01
3. **資料類型一致性**：MI05 與內容欄位必須一致
4. **狀態有效性**：MI10 狀態標記有效性檢查
5. **數值合理性**：數值欄位範圍合理性檢查

### 業務規則
1. 產品代號必須存在於 MTMAPF 中
2. 延伸代號在同一產品下必須唯一
3. 資料類型決定使用哪個內容欄位
4. 狀態為 'A' 才能正常使用
5. 優先順序影響顯示排序

### 關聯檔案
- **產品主檔**：MTMAPF (MI01 = MA01)
- **分類檔案**：PA#分類檔 (MI11 = 分類代號)
- **來源系統檔**：系統檔 (MI13 = 系統代號)
- **格式檔案**：PA#格式檔 (MI20 = 格式代號)
- **權限檔案**：權限檔 (MI39-MI43 = 權限代號)

### 使用場景
1. **產品規格擴充**：主檔欄位不足時的擴充
2. **客製化需求**：特殊客戶的客製化欄位
3. **動態表單**：根據延伸資料產生動態表單
4. **多版本支援**：同一產品不同版本的資料

### 維護作業
- **新增作業**：新延伸資料建立
- **修改作業**：延伸資料內容維護
- **刪除作業**：延伸資料邏輯刪除
- **批次作業**：大量延伸資料處理
- **同步作業**：多系統間資料同步

### 效能考量
1. **索引最佳化**：多個輔助索引提升查詢效能
2. **資料分割**：可考慮按產品類別分割
3. **快取策略**：常用延伸資料快取
4. **查詢最佳化**：複合索引支援複雜查詢

### 安全控制
- **存取權限**：多層次權限控制
- **資料加密**：機密資料加密儲存
- **稽核記錄**：完整的異動記錄
- **API控制**：API存取權限控制

### 資料品質
1. **必填檢查**：關鍵欄位不可為空
2. **格式檢查**：日期、數字格式正確性
3. **範圍檢查**：數值欄位合理範圍
4. **關聯檢查**：外鍵關聯有效性
5. **邏輯檢查**：業務邏輯一致性

### 擴充性設計
- **備用欄位**：MI49、MI50 備用欄位預留
- **版本管理**：支援延伸資料版本升級
- **新增型態**：未來可擴充更多資料型態
- **客製化公式**：支援客製化計算公式

### 使用注意事項
1. 此為實體檔案，可直接進行 CRUD 操作
2. 異動時需更新 MI51、MI52、MI53 等異動資訊
3. 資料類型變更需檢查內容欄位一致性
4. 刪除建議使用邏輯刪除 (MI10='D')
5. 重要異動建議先備份 