# IMIILF1 檔案規格書

## 1. 基本資料

| 項目 | 內容 |
|------|------|
| 檔案代號 | IMIILF1 |
| 檔案名稱 | 存貨調撥主檔 |
| 檔案類型 | LF (邏輯檔案) |
| 資料庫 | REFLIB |
| 記錄格式 | II0 |
| 基礎實體檔案 | IMIIPF |

## 2. 檔案功能說明

此邏輯檔案基於 IMIIPF（存貨調撥主檔實體檔案），提供以調撥日期（降序）、產品代號為主鍵的排序存取路徑，並具有選擇條件限制。主要用於存貨調撥作業中需要按照最新調撥日期優先順序處理的業務場景，並且只處理特定產品類別（M1類別）的調撥記錄。

## 3. 系統檔案清單

| 檔案代號 | 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|----------|------|
| IMIILF1 | 存貨調撥主檔 | LF | 邏輯檔案 |
| IMIIPF | 存貨調撥主檔 | PF | 基礎實體檔案 |

## 4. 紀錄格式

### 記錄格式：II0
- **基於實體檔案**：IMIIPF
- **存取方式**：直接邏輯存取
- **選擇條件**：II02A EQ 'M1' (產品代號子字串等於'M1')

## 5. 欄位代號、名稱、位置、長度、屬性、檢核說明

| 欄位代號 | 欄位名稱 | 位置 | 長度 | 型態 | 屬性 | 檢核說明 |
|----------|----------|------|------|------|------|----------|
| II01 | 單據編號或出貨 | - | - | - | R | 參照 RERF，單據編號或出貨編號 |
| II02 | 產品代號 | - | - | - | R | 參照 RERF，產品代號 |
| II03 | 出貨產品項次代號 | - | - | - | R | 參照 RERF，出貨產品項次代號 |
| II04 | 入貨產品項次代號 | - | - | - | R | 參照 RERF，入貨產品項次代號 |
| II05 | 調撥日期 | - | 8 | 數值 | R | 調撥日期 (YYYYMMDD 格式) |
| II06 | 產品入庫日期 | - | 8 | 數值 | R | 產品入庫日期 (YYYYMMDD 格式) |
| II07 | 確認狀態 | - | - | - | R | 參照 RERF，確認狀態 |
| II08 | 庫存狀態 | - | - | - | R | 參照 RERF，庫存狀態 |
| II09 | 單據編號或收貨 | - | - | - | R | 參照 RERF，單據編號或收貨編號 |
| IIXX | 建立日期 | - | 8 | 數值 | R | 建立日期 (YYYYMMDD 格式) |
| IIYY | 建立時間 | - | - | - | R | 參照 RERF，建立時間 |
| IIZZ | 建立人員 | - | - | - | R | 參照 RERF，建立人員 |
| II02A | 產品代號子字串 | - | 2 | 字元 | I | 從 II02 第3位開始取2位字元，用於選擇條件 |

## 6. 主鍵欄位

| 主鍵順序 | 欄位代號 | 欄位名稱 | 排序 |
|----------|----------|----------|------|
| 1 | II05 | 調撥日期 | DESC |
| 2 | II02 | 產品代號 | ASC |

## 7. 索引資料

### 主要索引
- **索引鍵值**：II05(DESC)+II02 (調撥日期降序+產品代號)
- **索引類型**：複合索引
- **排序方式**：調撥日期降序，產品代號遞增
- **用途**：支援最新調撥記錄優先的查詢

### 選擇條件
- **選擇欄位**：II02A (產品代號子字串)
- **選擇條件**：EQ 'M1'
- **說明**：只選擇產品代號第3-4位為'M1'的記錄

## 8. 備註

1. 此檔案為邏輯檔案，基於 IMIIPF 實體檔案
2. 提供雙層主鍵排序：調撥日期(降序)→產品代號(遞增)
3. 所有欄位定義均繼承自基礎實體檔案 IMIIPF
4. 具有選擇條件，只處理特定產品類別(M1)的調撥記錄
5. 產品代號編碼格式：XX-XX-X-XX-XXXXX (單位-類別-系列人-規格異動-序號)
6. II02A 欄位為計算欄位，從產品代號中提取類別代碼
7. 主要用於需要按照最新調撥日期處理M1類別產品的調撥作業
8. 日期欄位採用 YYYYMMDD 格式儲存
9. 此檔案提供存貨調撥主檔的最新記錄優先且類別限制的存取路徑 