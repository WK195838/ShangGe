# SOSMLF2 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSMLF2
- **檔案類型**: LF (聯結邏輯檔案)
- **基底檔案**: SOSCPF (銷售訂單主檔), SOSEPF (送貨單主檔)
- **檔案說明**: 訂單送貨單聯結檔 - 日期降序客戶排序查詢
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此聯結邏輯檔案將銷售訂單主檔 (SOSCPF) 與送貨單主檔 (SOSEPF) 進行聯結，提供按日期降序+客戶代號+聯絡代號+單號的複合排序查詢。

### 主要功能
- 日期降序的訂單送貨查詢
- 客戶導向的訂單分析
- 銷售序號與銷貨數量管理

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSCPF | PF | 銷售訂單主檔 (主要檔案) |
| SOSEPF | PF | 送貨單主檔 (次要檔案) |
| SOSMLF2 | LF | 訂單送貨單聯結邏輯檔案 |

## 4. 紀錄格式

### 4.1 記錄格式 SC0 (基於 SOSCPF)
```
PFILE(SOSCPF)
KEY: SM06 DESCEND + SM04 + SM05 + SM02
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SM06 | 送貨日期 | N | 8,0 | DESC | 主要排序鍵(降序) |
| 2 | SM04 | 客戶代號 | A | - | ASC | 次要排序鍵 |
| 3 | SM05 | 聯絡代號 | A | - | ASC | 三級排序鍵 |
| 4 | SM02 | 訂單單號 | A | - | ASC | 四級排序鍵 |

#### 選擇條件 (SELECT/OMIT)
| 類型 | 欄位代號 | 條件 | 值 | 說明 |
|------|----------|------|----|----|
| OMIT | SM16 | COMP(NE) | ' ' | 排除送貨單號非空白 |
| SELECT | SM07 | COMP(EQ) | '*' | 選擇訂單狀態為待確認 |
| SELECT | SM07 | COMP(EQ) | ' ' | 或選擇訂單狀態為已確認 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 來源欄位 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|----------|------|------|------|----------|
| SM01 | 客戶編號 | SC01 | A | - | RENAME | 客戶基本資料 |
| SM02 | 訂單單號 | SC02 | A | - | Key,RENAME | 訂單唯一識別 |
| SM03 | 部門 | SC03 | A | - | RENAME | 業務部門 |
| SM04 | 客戶代號 | SC04 | A | - | Key,RENAME | 客戶代號 |
| SM05 | 聯絡代號 | SC05 | A | - | Key,RENAME | 聯絡人代號 |
| SM06 | 送貨日期 | SC08 | N | 8,0 | Key,RENAME | 送貨日期 |
| SM07 | 訂單狀態 | SC13 | A | 1 | RENAME | 訂單確認狀態 |
| SM08 | 總務確認狀態記號 | SC22 | A | 1 | RENAME | 總務確認 |
| SM09 | 處理確認狀態記號 | SC23 | A | 1 | RENAME | 處理確認 |
| SM10 | 保管確認狀態記號 | SC24 | A | 1 | RENAME | 保管確認 |
| SM11 | 倉庫確認狀態記號 | SC25 | A | 1 | RENAME | 倉庫確認 |
| SM12 | 應收確認狀態記號 | SC26 | A | 1 | RENAME | 應收確認 |
| SM14 | 客戶地區 | SC31 | A | - | RENAME | 地區代號 |
| SM15 | 溫層 | SC12 | A | - | RENAME | 溫度層級 |
| SM16 | 送貨單號 | SC29 | A | - | RENAME | 關聯送貨單號 |
| SM17 | 銷序 | SC33 | A | - | RENAME | 銷售序號 |
| SM19 | 發票計算 | SC09 | N | - | RENAME | 發票計算欄位 |

### 4.2 記錄格式 SE0 (基於 SOSEPF)
```
PFILE(SOSEPF)
KEY: SM06 DESCEND + SM04 + SM05 + SM02
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SM06 | 送貨日期 | N | 8,0 | DESC | 主要排序鍵(降序) |
| 2 | SM04 | 路線代碼 | A | - | ASC | 次要排序鍵 |
| 3 | SM05 | 銷貨代碼 | A | - | ASC | 三級排序鍵 |
| 4 | SM02 | 送貨單號 | A | - | ASC | 四級排序鍵 |

#### 選擇條件 (SELECT/OMIT)
| 類型 | 欄位代號 | 條件 | 值 | 說明 |
|------|----------|------|----|----|
| OMIT | SM18 | COMP(NE) | 0 | 排除印單數量非零 |
| SELECT | SM07 | COMP(EQ) | '*' | 選擇送貨狀態為待確認 |
| SELECT | SM07 | COMP(EQ) | ' ' | 或選擇送貨狀態為已確認 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 來源欄位 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|----------|------|------|------|----------|
| SM01 | 客戶編號 | SE01 | A | - | RENAME | 客戶基本資料 |
| SM02 | 送貨單號 | SE02 | A | - | Key,RENAME | 送貨單唯一識別 |
| SM03 | 部門 | SE03 | A | - | RENAME | 業務部門 |
| SM04 | 路線代碼 | SE04 | A | - | Key,RENAME | 配送路線 |
| SM05 | 銷貨代碼 | SE05 | A | - | Key,RENAME | 銷貨類型 |
| SM06 | 送貨日期 | SE06 | N | 8,0 | Key,RENAME | 送貨執行日期 |
| SM07 | 送貨狀態 | SE09 | A | 1 | RENAME | 送貨確認狀態 |
| SM08 | 價格確認狀態編號 | SE15 | A | 1 | RENAME | 價格確認 |
| SM09 | 處理確認狀態編號 | SE16 | A | 1 | RENAME | 處理確認 |
| SM10 | 保管確認狀態編號 | SE17 | A | 1 | RENAME | 保管確認 |
| SM11 | 倉庫確認狀態編號 | SE18 | A | 1 | RENAME | 倉庫確認 |
| SM13 | 列印確認狀態編號 | SE19 | A | 1 | RENAME | 列印確認 |
| SM14 | 地區 | SE34 | A | - | RENAME | 地區代號 |
| SM15 | 溫層折扣 | SE08 | A | - | RENAME | 溫度層級折扣 |
| SM17 | 銷序 | SE27 | A | - | RENAME | 銷售序號 |
| SM18 | 印單數量 | SE20 | N | - | RENAME | 印單數量統計 |

## 5. 主鍵欄位
- **SC0 記錄格式**: SM06 (送貨日期,DESC) + SM04 (客戶代號) + SM05 (聯絡代號) + SM02 (訂單單號)
- **SE0 記錄格式**: SM06 (送貨日期,DESC) + SM04 (路線代碼) + SM05 (銷貨代碼) + SM02 (送貨單號)

## 6. 索引資料
| 記錄格式 | 排序方式 | 索引類型 | 說明 |
|----------|----------|----------|------|
| SC0 | SM06(DESC)+SM04+SM05+SM02 | 四層複合索引 | 日期降序客戶排序 |
| SE0 | SM06(DESC)+SM04+SM05+SM02 | 四層複合索引 | 日期降序路線排序 |

## 7. 使用說明

### 7.1 檔案用途
- 日期降序的訂單送貨查詢
- 客戶導向的訂單分析
- 路線別送貨分析
- 銷售序號管理

### 7.2 程式存取方式
```rpg
// 查詢最新日期的客戶訂單記錄
SETLL (送貨日期:客戶代號:聯絡代號) SOSMLF2;
READE (送貨日期:客戶代號) SOSMLF2 %KDS SC0;
// 查詢最新日期的路線送貨記錄  
SETLL (送貨日期:路線代碼:銷貨代碼) SOSMLF2;
READE (送貨日期:路線代碼) SOSMLF2 %KDS SE0;
```

## 8. 備註
- 此檔案提供日期降序的複合排序查詢
- 適用於最新優先的訂單送貨分析
- 包含銷售序號與發票計算功能
- 支援客戶別和路線別的雙重分析維度
- 自動排除空白送貨單號和零印單數量
- 日期降序排列便於查看最新記錄 