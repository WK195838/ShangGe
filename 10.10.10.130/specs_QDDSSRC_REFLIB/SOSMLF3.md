# SOSMLF3 檔案規格書

## 1. 基本資料
- **檔案名稱**: SOSMLF3
- **檔案類型**: LF (聯結邏輯檔案)
- **基底檔案**: SOSCPF (銷售訂單主檔), SOSEPF (送貨單主檔)
- **檔案說明**: 訂單送貨單聯結檔 - 客戶編號銷序排序查詢
- **建立日期**: (依系統記錄)
- **最後異動日期**: (依系統記錄)

## 2. 檔案功能說明
此聯結邏輯檔案將銷售訂單主檔 (SOSCPF) 與送貨單主檔 (SOSEPF) 進行聯結，包含計算欄位處理，提供客戶編號導向的銷序分析查詢。

### 主要功能
- 客戶編號導向的訂單送貨查詢
- 銷序別排序分析
- 計算欄位支援進階資料處理

## 3. 系統檔案清單
| 檔案名稱 | 檔案類型 | 說明 |
|----------|----------|------|
| SOSCPF | PF | 銷售訂單主檔 (主要檔案) |
| SOSEPF | PF | 送貨單主檔 (次要檔案) |
| SOSMLF3 | LF | 訂單送貨單聯結邏輯檔案 |

## 4. 紀錄格式

### 4.1 記錄格式 SC0 (基於 SOSCPF)
```
PFILE(SOSCPF)
KEY: SM011 + SM17 + SM06 DESCEND + SM04 + SM05 + SM02
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SM011 | 客戶編號第二位 | A | 1 | ASC | 計算欄位排序鍵 |
| 2 | SM17 | 銷序 | A | - | ASC | 銷售序號排序鍵 |
| 3 | SM06 | 送貨日期 | N | 8,0 | DESC | 日期降序排序鍵 |
| 4 | SM04 | 客戶代號 | A | - | ASC | 客戶代號排序鍵 |
| 5 | SM05 | 聯絡代號 | A | - | ASC | 聯絡代號排序鍵 |
| 6 | SM02 | 訂單單號 | A | - | ASC | 訂單單號排序鍵 |

#### 選擇條件 (SELECT/OMIT)
| 類型 | 欄位代號 | 條件 | 值 | 說明 |
|------|----------|------|----|----|
| OMIT | SM16 | COMP(NE) | ' ' | 排除送貨單號非空白 |
| SELECT | SM07 | COMP(EQ) | '*' | 選擇訂單狀態為待確認 |
| SELECT | SM07 | COMP(EQ) | ' ' | 或選擇訂單狀態為已確認 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 來源欄位 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|----------|------|------|------|----------|
| SM01 | 客戶編號 | SC01 | A | - | RENAME | 客戶基本資料 |
| SM011 | 客戶編號第二位 | SST(SC01 2 1) | A | 1 | 計算欄位,Key | 客戶編號第二位元 |
| SM02 | 訂單單號 | SC02 | A | - | Key,RENAME | 訂單唯一識別 |
| SM03 | 部門 | SC03 | A | - | RENAME | 業務部門 |
| SM04 | 客戶代號 | SC04 | A | - | Key,RENAME | 客戶代號 |
| SM05 | 聯絡代號 | SC05 | A | - | Key,RENAME | 聯絡人代號 |
| SM06 | 送貨日期 | SC08 | N | 8,0 | Key,RENAME | 送貨日期 |
| SM07 | 訂單狀態 | SC13 | A | 1 | RENAME | 訂單確認狀態 |
| SM08 | 總務確認狀態記號 | SC22 | A | 1 | RENAME | 總務確認 |
| SM09 | 處理確認狀態記號 | SC23 | A | 1 | RENAME | 處理確認 |
| SM10 | 保管確認狀態記號 | SC24 | A | 1 | RENAME | 保管確認 |
| SM11 | 倉庫確認狀態記號 | SC25 | A | 1 | RENAME | 倉庫確認 |
| SM12 | 應收確認狀態記號 | SC26 | A | 1 | RENAME | 應收確認 |
| SM14 | 客戶地區 | SC31 | A | - | RENAME | 地區代號 |
| SM15 | 溫層 | SC12 | A | - | RENAME | 溫度層級 |
| SM16 | 送貨單號 | SC29 | A | - | RENAME | 關聯送貨單號 |
| SM17 | 銷序 | SC33 | A | - | Key,RENAME | 銷售序號 |

### 4.2 記錄格式 SE0 (基於 SOSEPF)
```
PFILE(SOSEPF)
KEY: SM011 + SM17 + SM06 DESCEND + SM04 + SM05 + SM02
```

#### 關鍵欄位
| 順序 | 欄位代號 | 欄位名稱 | 型態 | 長度 | 排序 | 說明 |
|------|----------|----------|------|------|------|------|
| 1 | SM011 | 客戶編號第二位 | A | 1 | ASC | 計算欄位排序鍵 |
| 2 | SM17 | 銷序 | A | - | ASC | 銷售序號排序鍵 |
| 3 | SM06 | 送貨日期 | N | 8,0 | DESC | 日期降序排序鍵 |
| 4 | SM04 | 路線代碼 | A | - | ASC | 路線代碼排序鍵 |
| 5 | SM05 | 銷貨代碼 | A | - | ASC | 銷貨代碼排序鍵 |
| 6 | SM02 | 送貨單號 | A | - | ASC | 送貨單號排序鍵 |

#### 選擇條件 (SELECT/OMIT)
| 類型 | 欄位代號 | 條件 | 值 | 說明 |
|------|----------|------|----|----|
| OMIT | SM18 | COMP(NE) | 0 | 排除印單數量非零 |
| SELECT | SM07 | COMP(EQ) | '*' | 選擇送貨狀態為待確認 |
| SELECT | SM07 | COMP(EQ) | ' ' | 或選擇送貨狀態為已確認 |

#### 欄位代號、名稱、位置、長度、屬性、檢核說明
| 欄位代號 | 欄位名稱 | 來源欄位 | 型態 | 長度 | 屬性 | 檢核說明 |
|----------|----------|----------|------|------|------|----------|
| SM01 | 客戶編號 | SE01 | A | - | RENAME | 客戶基本資料 |
| SM011 | 客戶編號第二位 | SST(SE01 2 1) | A | 1 | 計算欄位,Key | 客戶編號第二位元 |
| SM02 | 送貨單號 | SE02 | A | - | Key,RENAME | 送貨單唯一識別 |
| SM03 | 部門 | SE03 | A | - | RENAME | 業務部門 |
| SM04 | 路線代碼 | SE04 | A | - | Key,RENAME | 配送路線 |
| SM05 | 銷貨代碼 | SE05 | A | - | Key,RENAME | 銷貨類型 |
| SM06 | 送貨日期 | SE06 | N | 8,0 | Key,RENAME | 送貨執行日期 |
| SM07 | 送貨狀態 | SE09 | A | 1 | RENAME | 送貨確認狀態 |
| SM08 | 價格確認狀態編號 | SE15 | A | 1 | RENAME | 價格確認 |
| SM09 | 處理確認狀態編號 | SE16 | A | 1 | RENAME | 處理確認 |
| SM10 | 保管確認狀態編號 | SE17 | A | 1 | RENAME | 保管確認 |
| SM11 | 倉庫確認狀態編號 | SE18 | A | 1 | RENAME | 倉庫確認 |
| SM13 | 列印確認狀態編號 | SE19 | A | 1 | RENAME | 列印確認 |
| SM14 | 地區 | SE34 | A | - | RENAME | 地區代號 |
| SM15 | 溫層折扣 | SE08 | A | - | RENAME | 溫度層級折扣 |
| SM17 | 銷序 | SE27 | A | - | Key,RENAME | 銷售序號 |
| SM18 | 印單數量 | SE20 | N | - | RENAME | 印單數量統計 |

## 5. 主鍵欄位
- **SC0 記錄格式**: SM011 (客戶編號第二位) + SM17 (銷序) + SM06 (送貨日期,DESC) + SM04 (客戶代號) + SM05 (聯絡代號) + SM02 (訂單單號)
- **SE0 記錄格式**: SM011 (客戶編號第二位) + SM17 (銷序) + SM06 (送貨日期,DESC) + SM04 (路線代碼) + SM05 (銷貨代碼) + SM02 (送貨單號)

## 6. 索引資料
| 記錄格式 | 排序方式 | 索引類型 | 說明 |
|----------|----------|----------|------|
| SC0 | SM011+SM17+SM06(DESC)+SM04+SM05+SM02 | 六層複合索引 | 客戶編號銷序排序 |
| SE0 | SM011+SM17+SM06(DESC)+SM04+SM05+SM02 | 六層複合索引 | 客戶編號銷序排序 |

## 7. 使用說明

### 7.1 檔案用途
- 客戶編號導向的訂單送貨查詢
- 銷序別排序分析
- 客戶分類統計處理

### 7.2 程式存取方式
```rpg
// 查詢特定客戶第二位編號的銷序記錄
SETLL (客戶編號第二位:銷序) SOSMLF3;
READE (客戶編號第二位:銷序) SOSMLF3 %KDS SC0;
// 批次處理客戶分類資料
SETLL (*LOVAL) SOSMLF3;
READ SOSMLF3 %KDS SE0;
```

## 8. 備註
- 此檔案包含計算欄位SM011，用於客戶編號分類
- 計算欄位定義：SST(客戶編號 2 1) - 取客戶編號第二位字元
- 適用於客戶分類統計和銷序分析
- 支援六層複合排序，提供詳細的層級查詢
- 自動排除空白送貨單號和零印單數量
- 按客戶編號第二位分組，便於客戶分類管理 